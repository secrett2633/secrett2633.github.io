<!DOCTYPE html><html lang="ko" class="no-js"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/e975486d410ad4e9.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-15a70ff5b484f3df.js"/><script src="/_next/static/chunks/fd9d1056-4e1a26e2d413ba3c.js" async=""></script><script src="/_next/static/chunks/23-e8ded9e1e67d56dc.js" async=""></script><script src="/_next/static/chunks/main-app-6087bc228fd56b83.js" async=""></script><script src="/_next/static/chunks/231-c27e618569e042bc.js" async=""></script><script src="/_next/static/chunks/157-d79d6340e7770dba.js" async=""></script><script src="/_next/static/chunks/app/layout-b06e577e11976c7d.js" async=""></script><script src="/_next/static/chunks/app/%5B...slug%5D/page-9d772c571b4668c1.js" async=""></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NE2W3CFPNY"></script><title>secrett2633&#x27;s blog</title><meta name="description" content="기술 블로그 - Django, Python, DevOps, AI/ML 관련 포스트"/><meta name="author" content="secrett2633"/><meta name="keywords" content="Django, Python, DevOps, AI, ML, 블로그, 기술"/><meta name="creator" content="secrett2633"/><meta name="publisher" content="secrett2633"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://secrett2633.github.io/"/><meta name="format-detection" content="telephone=no, address=no, email=no"/><meta property="og:title" content="secrett2633&#x27;s blog"/><meta property="og:description" content="기술 블로그 - Django, Python, DevOps, AI/ML 관련 포스트"/><meta property="og:url" content="https://secrett2633.github.io/"/><meta property="og:site_name" content="secrett2633&#x27;s blog"/><meta property="og:locale" content="ko_KR"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="secrett2633&#x27;s blog"/><meta name="twitter:description" content="기술 블로그 - Django, Python, DevOps, AI/ML 관련 포스트"/><link rel="icon" href="/icon.ico?6d9f34d4948640b8" type="image/x-icon" sizes="16x16"/><meta name="next-size-adjust"/><meta name="msapplication-TileColor" content="#ffc40d"/><meta name="theme-color" content="#ffffff"/><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());
              gtag('config', 'G-NE2W3CFPNY');
            </script><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_f367f3 layout--default"><div class="min-h-screen bg-gray-50"><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav id="site-nav" class="greedy-nav"><a class="site-title" href="/">secrett2633&#x27;s blog</a><div class="flex items-center space-x-4"><ul class="visible-links"><li class="masthead__menu-item"><a href="https://github.com/secrett2633" target="_blank" rel="noopener noreferrer">GitHub</a></li></ul><button class="search__toggle" type="button"><svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16"><path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path></svg></button></div></nav></div></div></div><main class="initial-content"><!--$--><div class="flex flex-col lg:flex-row gap-8"><aside class="lg:w-64 xl:w-72 order-1 lg:order-none"><div class="sidebar sticky"><nav class="space-y-4"><div><h4 class="font-medium text-gray-900 mb-2">Backend</h4><ul class="space-y-1 ml-4"><li><a href="/backend/django/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Django<!-- --> (<!-- -->6<!-- -->)</a></li><li><a href="/backend/logging/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Logging<!-- --> (<!-- -->1<!-- -->)</a></li></ul></div><div><h4 class="font-medium text-gray-900 mb-2">Python</h4><ul class="space-y-1 ml-4"><li><a href="/python/pep/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">PEP<!-- --> (<!-- -->650<!-- -->)</a></li></ul></div><div><h4 class="font-medium text-gray-900 mb-2">AI/ML</h4><ul class="space-y-1 ml-4"><li><a href="/ai/llm/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">LLM<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/ai/review/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Review<!-- --> (<!-- -->1025<!-- -->)</a></li></ul></div><div><h4 class="font-medium text-gray-900 mb-2">DevOps</h4><ul class="space-y-1 ml-4"><li><a href="/devops/nginx/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Nginx<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/devops/docker/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Docker<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/devops/safeline/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">SafeLine<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/devops/jenkins/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Jenkins<!-- --> (<!-- -->3<!-- -->)</a></li><li><a href="/devops/github-actions/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">GitHub Actions<!-- --> (<!-- -->1<!-- -->)</a></li><li><a href="/devops/aws/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">AWS<!-- --> (<!-- -->1<!-- -->)</a></li></ul></div><div><h4 class="font-medium text-gray-900 mb-2">etc</h4><ul class="space-y-1 ml-4"><li><a href="/etc/me/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Me<!-- --> (<!-- -->3<!-- -->)</a></li><li><a href="/etc/chrome-extension/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Chrome Extension<!-- --> (<!-- -->1<!-- -->)</a></li></ul></div></nav></div></aside><main class="flex-1"><article class="page"><header class="mb-8"><h1 class="page__title">[Final] PEP 538 - Coercing the legacy C locale to a UTF-8 based locale</h1><div class="page__meta"><time dateTime="2025-09-26 23:28:03+0900">2025년 9월 26일</time><span class="ml-4">수정: <!-- -->2025년 9월 26일</span></div></header><div class="page__content"><div><blockquote>
<p><strong>원문 링크:</strong> <a href="https://peps.python.org/pep-0538/">PEP 538 - Coercing the legacy C locale to a UTF-8 based locale</a></p>
<p><strong>상태:</strong> Final | <strong>유형:</strong> Standards Track | <strong>작성일:</strong> 28-Dec-2016</p>
</blockquote>
<h1>PEP 538 – 레거시 C locale을 UTF-8 기반 locale로 강제 변환 (Coercing the legacy C locale to a UTF-8 based locale)</h1>
<h2>개요</h2>
<p>이 PEP는 Python 3.7부터 *nix 시스템에서 기본 C locale이 사용될 때, CPython이 UTF-8을 기본 텍스트 인코딩으로 가정하도록 변경하는 것을 제안합니다. 이는 멀티링구얼 환경에서 운영체제 인터페이스와의 통신 시 ASCII 인코딩으로 인해 발생하는 문제를 해결하고, 다른 locale 인식 구성 요소와의 호환성을 유지하기 위함입니다.</p>
<h2>목표</h2>
<p>Python 개발자들이 이 PEP의 제안 내용, 도입 배경, 그리고 실제 Python 사용에 미치는 영향을 명확하게 이해할 수 있도록 돕는 것입니다.</p>
<h2>주요 내용 요약</h2>
<h3>배경 (Background)</h3>
<ul>
<li>Python 3는 <code>char *</code>와 <code>wchar_t *</code> 같은 문자열 형식을 <code>PyUnicodeObject *</code>로 변환할 때 시스템의 locale 설정에 의존합니다.</li>
<li>Windows에서는 <code>mbcs</code> 형식의 한계 때문에 PEP 528과 PEP 529를 통해 UTF-8 사용을 강제했습니다.</li>
<li>macOS, iOS, Android에서는 이미 CPython을 포함한 많은 구성 요소가 UTF-8을 시스템 인코딩으로 가정합니다.</li>
<li>그 외의 *nix 시스템에서는 <code>glibc</code>의 C locale 시스템을 사용하는데, 기본적으로 ASCII를 사용하며 이는 다국어 텍스트 처리에는 부적합합니다.</li>
<li>특히 SSH 환경 포워딩이나 Linux 컨테이너 환경에서 명시적인 locale 설정이 없을 경우, CPython은 ASCII 기반 C locale에서 실행되어 Unicode 관련 문제가 발생할 수 있습니다.</li>
<li>이를 해결하는 가장 간단한 방법은 <code>LC_CTYPE=C.UTF-8 python3 ...</code>와 같이 명시적으로 UTF-8 기반 locale을 설정하는 것이었습니다. <code>C.UTF-8</code> locale은 <code>LC_CTYPE</code> 범주에 UTF-8을 사용하고 나머지 범주는 C locale과 동일하게 설정합니다.</li>
</ul>
<h3>PEP 540과의 관계 (Relationship with other PEPs)</h3>
<ul>
<li>이 PEP는 PEP 540과 함께 Python 3의 기본 C locale 동작을 개선하려는 공통적인 목표를 가집니다.</li>
<li><strong>PEP 540</strong>은 CPython의 기본 텍스트 인코딩을 C locale 시스템과 완전히 분리하여 CPython이 locale 독립적인 런타임처럼 동작하게 하려 합니다. 이는 locale 설정이 적절하지 않거나 "locale 인코딩" 개념이 없는 플랫폼에 유용합니다.</li>
<li>**PEP 538 (이 PEP)**은 레거시 C locale을 UTF-8을 기본 텍스트 인코딩으로 사용하는 <code>C.UTF-8</code>과 같은 locale로 강제 변환하는 것을 제안합니다. 이는 CPython뿐만 아니라 현재 프로세스에 로드된 다른 locale 인식 확장 모듈 및 하위 프로세스에도 적용되어 다른 구성 요소와의 호환성을 유지합니다.</li>
<li>두 PEP는 상호 보완적이며, PEP 540은 적합한 locale을 사용할 수 없는 경우에 더 나은 선택지를 제공하고, PEP 538은 다른 locale 인식 구성 요소와의 호환성을 개선합니다.</li>
</ul>
<h3>동기 (Motivation)</h3>
<ul>
<li>Docker, Kubernetes와 같은 Linux 컨테이너 환경에서 Python 3 애플리케이션 개발 시 텍스트 인코딩 관련 오류가 흔히 발생합니다. 이는 컨테이너의 기본 locale 설정이 <code>POSIX</code> (ASCII 기반 C locale의 별칭)로 되어 있기 때문입니다.</li>
<li>로컬 시스템에서는 <code>en_AU.UTF-8</code>과 같이 UTF-8 기반 locale이 설정되어 있어 문제가 없지만, 기본 Docker 이미지에서는 locale이 설정되지 않아 오류가 발생합니다.</li>
<li>이를 해결하기 위해 <code>LC_CTYPE=C.UTF-8</code>을 환경 변수로 설정하면 컨테이너 내에서도 Python 3가 올바르게 동작합니다.</li>
<li>CPython이 시스템 설정 변경에 의존하기보다 이 문제를 자동으로 처리하여 더 나은 사용자 경험을 제공하는 것이 목표입니다.</li>
</ul>
<h3>설계 원칙 (Design Principles)</h3>
<ul>
<li>명시적으로 다른 locale이 구성된 경우, 이를 존중합니다.</li>
<li>변경 사항은 기존 설정 옵션을 사용합니다.</li>
<li>locale 강제 변환으로 설정된 locale과 명시적으로 설정된 locale 간의 런타임 동작은 동일해야 합니다.</li>
<li>Python 3.7의 경우, 명시적 설정 없이 locale이 변경되면 <code>stderr</code>에 경고를 출력합니다 (초기 설계에서 기본적으로 비활성화됨).</li>
<li>Python 3.7의 경우, 변경된 기본값은 빌드 타임 또는 런타임에 명시적인 비활성화 스위치를 제공합니다.</li>
<li><code>LC_ALL</code>이나 <code>LANG</code>과 같은 <code>LC_CTYPE</code> 이외의 locale 범주 설정은 변경하지 않습니다.</li>
<li>Python 2.7을 포함하여 지원되는 CPython 버전과 호환되지 않는 Python 관련 환경 변수 변경은 피합니다.</li>
</ul>
<h3>명세 (Specification)</h3>
<h4>독립형 Python 인터프리터 바이너리에서의 레거시 C locale 강제 변환 (Legacy C locale coercion in the standalone Python interpreter binary)</h4>
<ul>
<li>독립형 애플리케이션으로 실행될 때, CPython은 locale 종속적인 작업이 실행되기 전에 C locale을 재구성할 수 있습니다.</li>
<li><code>setlocale(LC_ALL, "")</code> 호출 후, 현재 <code>LC_CTYPE</code> 설정이 "C" 또는 "POSIX"와 같이 C locale을 나타내면, CPython은 UTF-8 기반 locale로 강제 변환을 시도합니다.</li>
<li>시도되는 locale 목록: <code>C.UTF-8</code>, <code>C.utf8</code>, <code>UTF-8</code>.</li>
<li>강제 변환은 <code>LC_CTYPE</code> 환경 변수를 후보 locale 이름으로 설정하여 구현됩니다.</li>
<li>이 locale 강제 변환이 활성화되면 <code>stderr</code>에 경고가 출력됩니다 (나중에 기본적으로 비활성화됨).</li>
<li><code>PYTHONCOERCECLOCALE=0</code>을 명시적으로 설정하면 locale 강제 변환이 비활성화됩니다.</li>
</ul>
<h4>런타임 초기화 중 레거시 C locale 경고 (Legacy C locale warning during runtime initialization)</h4>
<ul>
<li><code>Py_Initialize</code>가 호출될 때 CPython이 여전히 기본 C locale에서 실행 중이고 <code>PYTHONCOERCECLOCALE=0</code>이 설정되지 않은 경우, Unicode 호환성 문제에 대한 경고가 발행됩니다 (나중에 기본적으로 비활성화됨).</li>
<li>이 경우 실제 locale 설정 변경은 없으며, 단순히 지원되지 않는 구성에서 Python 3를 실행 중임을 알립니다.</li>
</ul>
<h4>새로운 빌드 타임 설정 옵션 (New build-time configuration options)</h4>
<ul>
<li>locale 강제 변환 동작은 <code>--with[out]-c-locale-coercion</code> 플래그로 제어되며, <code>PY_COERCE_C_LOCALE</code> 전처리기 정의를 설정합니다.</li>
<li>locale 경고 동작은 <code>--with[out]-c-locale-warning</code> 플래그로 제어됩니다 (나중에 런타임 <code>PYTHONCOERCECLOCALE=warn</code> 옵션으로 대체됨).</li>
</ul>
<h4>표준 스트림의 기본 오류 처리 변경 (Changes to the default error handling on the standard streams)</h4>
<ul>
<li>Python 3.5부터 C locale에서는 <code>sys.stdin</code>, <code>sys.stdout</code>에 <code>surrogateescape</code> 오류 핸들러를 기본으로 사용했습니다. 다른 locale에서는 <code>strict</code>를 사용했습니다.</li>
<li>이 PEP에서는 <code>C.UTF-8</code>, <code>C.utf8</code>, <code>UTF-8</code>과 같은 강제 변환 대상 locale에서도 <code>surrogateescape</code>를 기본 오류 핸들러로 사용하도록 확장합니다.</li>
<li><code>sys.stderr</code>의 기본 오류 핸들러는 <code>backslashreplace</code>로 유지됩니다.</li>
</ul>
<h4>Android의 locale 설정 변경 (Changes to locale settings on Android)</h4>
<ul>
<li>Android 시스템에서는 <code>setlocale(LC_ALL, "C.UTF-8")</code> 및 <code>setlocale(LC_CTYPE, "C.UTF-8")</code>이 호출되도록 업데이트됩니다. 이는 Android에서 <code>""</code>를 <code>setlocale</code>에 전달하는 것이 <code>"C"</code>와 동일하게 취급되며, <code>C.UTF-8</code> locale이 항상 사용 가능하기 때문입니다.</li>
</ul>
<h3>근거 (Rationale)</h3>
<h4>C locale 처리 개선 (Improving the handling of the C locale)</h4>
<ul>
<li>C locale의 기본 ASCII 인코딩은 현대 네트워크 서비스 개발에 부적합하다는 것이 명확해졌습니다. Rust, Go, Node.js와 같은 최신 언어는 이미 UTF-8을 기본 텍스트 인코딩으로 가정합니다.</li>
<li>CPython은 임베디드 스크립팅 언어 및 데스크톱 애플리케이션 개발에도 사용되기 때문에 다른 locale 인식 구성 요소와의 일관성이 중요합니다.</li>
<li>이 PEP의 핵심 전제는 이러한 모든 사용 사례에서 기본 "C" locale이 암시하는 ASCII 가정이 잘못되었으며, 데스크톱 애플리케이션에서는 locale이 이미 올바르게 구성되어 있어야 하고, 네트워크 서비스 개발 (특히 Linux 컨테이너)에서는 구성 요소가 자체 기본 인코딩(예: UTF-8)을 부과해야 한다는 것입니다.</li>
</ul>
<h4>표준 IO 스트림에 "surrogateescape" 오류 처리 기본값 설정 (Defaulting to “surrogateescape” error handling on the standard IO streams)</h4>
<ul>
<li>locale을 레거시 C locale에서 벗어나게 함으로써, 이 PEP는 표준 IO 스트림에 <code>surrogateescape</code> 사용을 비활성화하는 대신, 강제 변환 대상 세 가지 locale에도 <code>surrogateescape</code> 기본값을 적용하도록 제안합니다.</li>
<li>이는 운영체제가 제공하는 텍스트 값이 UTF-8로 인코딩되었다는 가정이 틀렸더라도 Python 3 애플리케이션을 통해 투명하게 전달될 수 있도록 보장하는 것을 목표로 합니다.</li>
<li>특히 GB 18030, Shift-JIS, ISO-2022-JP와 같이 ASCII 및 UTF-8과 호환되지 않는 인코딩도 <code>surrogateescape</code>를 통해 처리될 수 있습니다.</li>
</ul>
<h4>UTF-8 locale 강제 변환 중 <code>PYTHONIOENCODING</code> 설정 방지 (Avoiding setting PYTHONIOENCODING during UTF-8 locale coercion)</h4>
<ul>
<li>이전 버전의 PEP는 <code>PYTHONIOENCODING</code>을 <code>utf-8:surrogateescape</code>로 설정하는 것을 제안했지만, 이는 Python 2.7 하위 프로세스와의 호환성 문제를 야기했습니다.</li>
<li>현재 설계는 이전 Python 버전이 기본 <code>strict</code> 오류 처리를 유지하고, Python 3.7+는 <code>surrogateescape</code>를 일관되게 사용하도록 합니다.</li>
</ul>
<h4>레거시 C locale에서의 ASCII 기반 텍스트 처리 공식 지원 중단 (Dropping official support for ASCII based text handling in the legacy C locale)</h4>
<ul>
<li>레거시 C locale에서 엄격한 바이트/텍스트 분리를 안정적으로 작동시키려는 시도는 10년 이상 실패했습니다.</li>
<li>이 PEP는 개발자가 필요하다면 여전히 레거시 C locale에서 Python 코드를 실행할 수 있도록 허용하지만 (<code>LC_ALL=C</code>, <code>PYTHONCOERCECLOCALE=0</code> 설정 또는 사용자 정의 빌드를 통해), Python 3의 Unicode 처리가 해당 구성에서 완전히 신뢰할 수 없을 것이며, 더 적절한 locale 설정을 사용할 것을 권장합니다.</li>
</ul>
<h4>독립형으로 실행될 때만 암시적 locale 강제 변환 제공 (Providing implicit locale coercion only when running standalone)</h4>
<ul>
<li>이 PEP의 주요 단점은 CPython 런타임이 독립형 애플리케이션으로 실행될 때와 더 큰 시스템에 임베딩된 구성 요소로 실행될 때 동작 불일치를 유발할 수 있다는 점입니다.</li>
<li>이 문제는 locale 강제 변환을 인터프리터 시작 시퀀스에서 가능한 한 일찍, 즉 C 수준의 <code>main()</code> 함수에서 <code>Py_Main()</code> 라이브러리 함수를 호출하기 전부터 처리함으로써 해결됩니다.</li>
<li><code>Py_Initialize</code> API는 C locale 사용을 감지할 때만 명시적인 경고를 발생시키고, 임베딩 애플리케이션이 더 합리적인 것을 지정하도록 의존합니다.</li>
</ul>
<h4>레거시 동작 복원 허용 (Allowing restoration of the legacy behaviour)</h4>
<ul>
<li><code>PYTHONCOERCECLOCALE=0</code> 환경 변수를 설정하여 locale 강제 변환 동작을 쉽게 켜고 끌 수 있습니다. 이는 디버깅 목적으로 다른 애플리케이션의 동작을 재현하거나 이전 Python 3.x 런타임의 동작을 재현하는 데 유용합니다.</li>
</ul>
<h4>C locale 감지를 위해 <code>LC_CTYPE</code> 쿼리 (Querying LC_CTYPE for C locale detection)</h4>
<ul>
<li><code>LC_CTYPE</code>은 환경 변수, 명령줄 인수 및 운영체제로부터 받은 다른 텍스트 값의 암시적 디코딩을 구동하는 실제 locale 범주입니다. 따라서 Unicode 처리 문제 발생 여부를 판단할 때 이를 특별히 확인하는 것이 합리적입니다.</li>
</ul>
<h4>UTF-8 locale 강제 변환을 위해 <code>LC_CTYPE</code> 명시적 설정 (Explicitly setting LC_CTYPE for UTF-8 locale coercion)</h4>
<ul>
<li><code>LC_CTYPE</code>을 <code>C.UTF-8</code>로 설정하는 것은 <code>LC_CTYPE=UTF-8</code>과 같은 설정이 UTF-8 locale이 정의되지 않은 시스템에서 제공될 때 발생하는 문제를 처리하는 데 중요합니다 (예: macOS SSH 클라이언트가 locale 설정을 전달하도록 구성되어 있고, 사용자가 Linux 서버에 로그인할 때).</li>
</ul>
<h4>UTF-8 locale 강제 변환 중 <code>LANG</code> 설정 방지 (Avoiding setting LANG for UTF-8 locale coercion)</h4>
<ul>
<li>이전 버전의 PEP는 <code>LC_CTYPE</code>과 함께 <code>LANG</code>을 설정하는 것을 제안했지만, <code>LC_CTYPE</code>만으로 PEP가 해결하려는 모든 문제가 처리 가능하며, <code>LANG</code>을 설정하면 <code>LC_TIME</code>과 같은 다른 locale 범주 설정이 의도치 않게 변경될 수 있어 제거되었습니다.</li>
</ul>
<h4>UTF-8 locale 강제 변환 중 <code>LC_ALL</code> 설정 방지 (Avoiding setting LC_ALL for UTF-8 locale coercion)</h4>
<ul>
<li>이전 버전의 PEP는 <code>LC_CTYPE</code>과 함께 <code>LC_ALL</code>을 설정하는 것을 제안했지만, <code>LC_ALL</code>을 설정하면 <code>LC_MONETARY</code>와 같은 다른 범주 설정에 문제가 발생할 수 있어 변경되었습니다.</li>
</ul>
<h4>현재 환경에 <code>LC_ALL</code>이 설정되어 있으면 locale 강제 변환 건너뛰기 (Skipping locale coercion if LC_ALL is set in the current environment)</h4>
<ul>
<li><code>LC_ALL</code>이 설정된 경우 locale 강제 변환은 효과가 없으므로, 불필요한 경고를 피하기 위해 강제 변환을 완전히 건너뜁니다.</li>
</ul>
<h4>"UTF-8 모드"와 독립적으로 locale 강제 변환 고려 (Considering locale coercion independently of “UTF-8 mode”)</h4>
<ul>
<li>PEP 540의 UTF-8 모드는 현재 구성할 수 없는 기본 동작을 변경할 수 있다는 점에서 흥미롭지만, 검증되지 않은 접근 방식입니다. 반면 이 PEP의 접근 방식은 기존의 C locale 시스템 설정(<code>LC_CTYPE</code>, <code>LANG</code>)과 Python의 표준 스트림 설정(<code>PYTHONIOENCODING</code>)을 기반으로 합니다.</li>
<li>또한, 이 PEP의 locale 강제 변환은 CPython 자체뿐만 아니라 GNU readline과 같이 표준 스트림과 상호 작용하는 확장 모듈의 문제도 해결할 수 있습니다.</li>
</ul>
<h4>macOS, iOS 및 Android에서 C locale 강제 변환 및 경고 활성화 (Enabling C locale coercion and warnings on Mac OS X, iOS and Android)</h4>
<ul>
<li>이전에는 이들 플랫폼에서 locale 강제 변환 및 경고를 빌드 타임에 비활성화할 것을 제안했지만, <code>LANG=C</code>를 명시적으로 설정할 경우 GNU readline과 같은 확장 모듈이 오작동하는 것으로 밝혀져, 모든 CPython의 autotools 기반 빌드 툴체인을 사용하는 플랫폼(Windows 제외)에서 기본적으로 활성화됩니다.</li>
</ul>
<h3>구현 (Implementation)</h3>
<ul>
<li>참고 구현은 Alyssa Coghlan의 CPython 저장소의 <code>pep538-coerce-c-locale</code> 기능 브랜치에서 개발 중입니다.</li>
</ul>
<h3>이전 Python 3 릴리스로의 백포팅 (Backporting to earlier Python 3 releases)</h3>
<ul>
<li>Python 3.7에서 이 PEP가 채택되면, 재배포자는 Python 3.6.x 릴리스로 변경 사항을 백포팅할 수 있으며 권장됩니다. 다만, 적절한 locale을 기본으로 제공하는 변경 사항과 함께 이루어져야 합니다.</li>
<li>다른 Python 3.x 릴리스로의 백포팅은 일반적인 관행으로는 권장되지 않지만, 일부 재배포자는 사용자 기반의 필요에 따라 백포팅을 선택할 수 있습니다.</li>
</ul>
<hr>
<blockquote>
<p>⚠️ <strong>알림:</strong> 이 문서는 AI를 활용하여 번역되었으며, 기술적 정확성을 보장하지 않습니다. 정확한 내용은 반드시 원문을 확인하시기 바랍니다.</p>
</blockquote>
</div></div><footer class="page__meta mt-8"><div class="page__taxonomy"><h4 class="text-sm font-medium text-gray-900 mb-2">태그</h4><span class="page__taxonomy-item">#<!-- -->Python</span><span class="page__taxonomy-item">#<!-- -->PEP</span><span class="page__taxonomy-item">#<!-- -->Translation</span></div></footer></article></main></div><!--/$--></main><div id="footer" class="page__footer"><footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><div class="text-center text-gray-500 text-sm"><p>© 2025 secrett2633. All rights reserved.</p></div></footer></div></div><script src="/_next/static/chunks/webpack-15a70ff5b484f3df.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/e975486d410ad4e9.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5751,[],\"\"]\n6:I[9275,[],\"\"]\n8:I[1343,[],\"\"]\n9:I[9157,[\"231\",\"static/chunks/231-c27e618569e042bc.js\",\"157\",\"static/chunks/157-d79d6340e7770dba.js\",\"185\",\"static/chunks/app/layout-b06e577e11976c7d.js\"],\"default\"]\na:I[231,[\"231\",\"static/chunks/231-c27e618569e042bc.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-9d772c571b4668c1.js\"],\"\"]\nc:I[6130,[],\"\"]\n7:[\"slug\",\"python/pep/538\",\"c\"]\nd:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/e975486d410ad4e9.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"jf5MDuRUbMNVvRN9tv5rq\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/python/pep/538/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"python/pep/538\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"python\\\",\\\"pep\\\",\\\"538\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"python/pep/538\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",\"$L5\"],null],null]},[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$7\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"ko\",\"className\":\"no-js\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#ffc40d\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"#ffffff\"}],[\"$\",\"script\",null,{\"async\":true,\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-NE2W3CFPNY\"}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\n              window.dataLayer = window.dataLayer || [];\\n              function gtag(){dataLayer.push(arguments);}\\n              gtag('js', new Date());\\n              gtag('config', 'G-NE2W3CFPNY');\\n            \"}}]]}],[\"$\",\"body\",null,{\"className\":\"__className_f367f3 layout--default\",\"children\":[\"$\",\"div\",null,{\"className\":\"min-h-screen bg-gray-50\",\"children\":[[\"$\",\"$L9\",null,{}],[\"$\",\"main\",null,{\"className\":\"initial-content\",\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"min-h-screen flex items-center justify-center bg-gray-50\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-md w-full bg-white rounded-lg shadow-md p-8 text-center\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-6xl font-bold text-primary-600 mb-4\",\"children\":\"404\"}],[\"$\",\"h2\",null,{\"className\":\"text-2xl font-semibold text-gray-900 mb-4\",\"children\":\"페이지를 찾을 수 없습니다\"}],[\"$\",\"p\",null,{\"className\":\"text-gray-600 mb-8\",\"children\":\"요청하신 페이지가 존재하지 않거나 이동되었을 수 있습니다.\"}],[\"$\",\"$La\",null,{\"href\":\"/\",\"className\":\"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors\",\"children\":\"홈으로 돌아가기\"}]]}]}],\"notFoundStyles\":[],\"styles\":null}]}],[\"$\",\"div\",null,{\"id\":\"footer\",\"className\":\"page__footer\",\"children\":[\"$\",\"footer\",null,{\"className\":\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"text-center text-gray-500 text-sm\",\"children\":[\"$\",\"p\",null,{\"children\":\"© 2025 secrett2633. All rights reserved.\"}]}]}]}]]}]}]]}],null],[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-center min-h-screen\",\"children\":[\"$\",\"div\",null,{\"className\":\"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600\"}]}],[],[]]],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Lb\"],\"globalErrorComponent\":\"$c\",\"missingSlots\":\"$Wd\"}]]\n"])</script><script>self.__next_f.push([1,"e:T44e8,"])</script><script>self.__next_f.push([1,"\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e원문 링크:\u003c/strong\u003e \u003ca href=\"https://peps.python.org/pep-0538/\"\u003ePEP 538 - Coercing the legacy C locale to a UTF-8 based locale\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e상태:\u003c/strong\u003e Final | \u003cstrong\u003e유형:\u003c/strong\u003e Standards Track | \u003cstrong\u003e작성일:\u003c/strong\u003e 28-Dec-2016\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1\u003ePEP 538 – 레거시 C locale을 UTF-8 기반 locale로 강제 변환 (Coercing the legacy C locale to a UTF-8 based locale)\u003c/h1\u003e\n\u003ch2\u003e개요\u003c/h2\u003e\n\u003cp\u003e이 PEP는 Python 3.7부터 *nix 시스템에서 기본 C locale이 사용될 때, CPython이 UTF-8을 기본 텍스트 인코딩으로 가정하도록 변경하는 것을 제안합니다. 이는 멀티링구얼 환경에서 운영체제 인터페이스와의 통신 시 ASCII 인코딩으로 인해 발생하는 문제를 해결하고, 다른 locale 인식 구성 요소와의 호환성을 유지하기 위함입니다.\u003c/p\u003e\n\u003ch2\u003e목표\u003c/h2\u003e\n\u003cp\u003ePython 개발자들이 이 PEP의 제안 내용, 도입 배경, 그리고 실제 Python 사용에 미치는 영향을 명확하게 이해할 수 있도록 돕는 것입니다.\u003c/p\u003e\n\u003ch2\u003e주요 내용 요약\u003c/h2\u003e\n\u003ch3\u003e배경 (Background)\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003ePython 3는 \u003ccode\u003echar *\u003c/code\u003e와 \u003ccode\u003ewchar_t *\u003c/code\u003e 같은 문자열 형식을 \u003ccode\u003ePyUnicodeObject *\u003c/code\u003e로 변환할 때 시스템의 locale 설정에 의존합니다.\u003c/li\u003e\n\u003cli\u003eWindows에서는 \u003ccode\u003embcs\u003c/code\u003e 형식의 한계 때문에 PEP 528과 PEP 529를 통해 UTF-8 사용을 강제했습니다.\u003c/li\u003e\n\u003cli\u003emacOS, iOS, Android에서는 이미 CPython을 포함한 많은 구성 요소가 UTF-8을 시스템 인코딩으로 가정합니다.\u003c/li\u003e\n\u003cli\u003e그 외의 *nix 시스템에서는 \u003ccode\u003eglibc\u003c/code\u003e의 C locale 시스템을 사용하는데, 기본적으로 ASCII를 사용하며 이는 다국어 텍스트 처리에는 부적합합니다.\u003c/li\u003e\n\u003cli\u003e특히 SSH 환경 포워딩이나 Linux 컨테이너 환경에서 명시적인 locale 설정이 없을 경우, CPython은 ASCII 기반 C locale에서 실행되어 Unicode 관련 문제가 발생할 수 있습니다.\u003c/li\u003e\n\u003cli\u003e이를 해결하는 가장 간단한 방법은 \u003ccode\u003eLC_CTYPE=C.UTF-8 python3 ...\u003c/code\u003e와 같이 명시적으로 UTF-8 기반 locale을 설정하는 것이었습니다. \u003ccode\u003eC.UTF-8\u003c/code\u003e locale은 \u003ccode\u003eLC_CTYPE\u003c/code\u003e 범주에 UTF-8을 사용하고 나머지 범주는 C locale과 동일하게 설정합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003ePEP 540과의 관계 (Relationship with other PEPs)\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e이 PEP는 PEP 540과 함께 Python 3의 기본 C locale 동작을 개선하려는 공통적인 목표를 가집니다.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ePEP 540\u003c/strong\u003e은 CPython의 기본 텍스트 인코딩을 C locale 시스템과 완전히 분리하여 CPython이 locale 독립적인 런타임처럼 동작하게 하려 합니다. 이는 locale 설정이 적절하지 않거나 \"locale 인코딩\" 개념이 없는 플랫폼에 유용합니다.\u003c/li\u003e\n\u003cli\u003e**PEP 538 (이 PEP)**은 레거시 C locale을 UTF-8을 기본 텍스트 인코딩으로 사용하는 \u003ccode\u003eC.UTF-8\u003c/code\u003e과 같은 locale로 강제 변환하는 것을 제안합니다. 이는 CPython뿐만 아니라 현재 프로세스에 로드된 다른 locale 인식 확장 모듈 및 하위 프로세스에도 적용되어 다른 구성 요소와의 호환성을 유지합니다.\u003c/li\u003e\n\u003cli\u003e두 PEP는 상호 보완적이며, PEP 540은 적합한 locale을 사용할 수 없는 경우에 더 나은 선택지를 제공하고, PEP 538은 다른 locale 인식 구성 요소와의 호환성을 개선합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e동기 (Motivation)\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eDocker, Kubernetes와 같은 Linux 컨테이너 환경에서 Python 3 애플리케이션 개발 시 텍스트 인코딩 관련 오류가 흔히 발생합니다. 이는 컨테이너의 기본 locale 설정이 \u003ccode\u003ePOSIX\u003c/code\u003e (ASCII 기반 C locale의 별칭)로 되어 있기 때문입니다.\u003c/li\u003e\n\u003cli\u003e로컬 시스템에서는 \u003ccode\u003een_AU.UTF-8\u003c/code\u003e과 같이 UTF-8 기반 locale이 설정되어 있어 문제가 없지만, 기본 Docker 이미지에서는 locale이 설정되지 않아 오류가 발생합니다.\u003c/li\u003e\n\u003cli\u003e이를 해결하기 위해 \u003ccode\u003eLC_CTYPE=C.UTF-8\u003c/code\u003e을 환경 변수로 설정하면 컨테이너 내에서도 Python 3가 올바르게 동작합니다.\u003c/li\u003e\n\u003cli\u003eCPython이 시스템 설정 변경에 의존하기보다 이 문제를 자동으로 처리하여 더 나은 사용자 경험을 제공하는 것이 목표입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e설계 원칙 (Design Principles)\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e명시적으로 다른 locale이 구성된 경우, 이를 존중합니다.\u003c/li\u003e\n\u003cli\u003e변경 사항은 기존 설정 옵션을 사용합니다.\u003c/li\u003e\n\u003cli\u003elocale 강제 변환으로 설정된 locale과 명시적으로 설정된 locale 간의 런타임 동작은 동일해야 합니다.\u003c/li\u003e\n\u003cli\u003ePython 3.7의 경우, 명시적 설정 없이 locale이 변경되면 \u003ccode\u003estderr\u003c/code\u003e에 경고를 출력합니다 (초기 설계에서 기본적으로 비활성화됨).\u003c/li\u003e\n\u003cli\u003ePython 3.7의 경우, 변경된 기본값은 빌드 타임 또는 런타임에 명시적인 비활성화 스위치를 제공합니다.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eLC_ALL\u003c/code\u003e이나 \u003ccode\u003eLANG\u003c/code\u003e과 같은 \u003ccode\u003eLC_CTYPE\u003c/code\u003e 이외의 locale 범주 설정은 변경하지 않습니다.\u003c/li\u003e\n\u003cli\u003ePython 2.7을 포함하여 지원되는 CPython 버전과 호환되지 않는 Python 관련 환경 변수 변경은 피합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e명세 (Specification)\u003c/h3\u003e\n\u003ch4\u003e독립형 Python 인터프리터 바이너리에서의 레거시 C locale 강제 변환 (Legacy C locale coercion in the standalone Python interpreter binary)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e독립형 애플리케이션으로 실행될 때, CPython은 locale 종속적인 작업이 실행되기 전에 C locale을 재구성할 수 있습니다.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esetlocale(LC_ALL, \"\")\u003c/code\u003e 호출 후, 현재 \u003ccode\u003eLC_CTYPE\u003c/code\u003e 설정이 \"C\" 또는 \"POSIX\"와 같이 C locale을 나타내면, CPython은 UTF-8 기반 locale로 강제 변환을 시도합니다.\u003c/li\u003e\n\u003cli\u003e시도되는 locale 목록: \u003ccode\u003eC.UTF-8\u003c/code\u003e, \u003ccode\u003eC.utf8\u003c/code\u003e, \u003ccode\u003eUTF-8\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e강제 변환은 \u003ccode\u003eLC_CTYPE\u003c/code\u003e 환경 변수를 후보 locale 이름으로 설정하여 구현됩니다.\u003c/li\u003e\n\u003cli\u003e이 locale 강제 변환이 활성화되면 \u003ccode\u003estderr\u003c/code\u003e에 경고가 출력됩니다 (나중에 기본적으로 비활성화됨).\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ePYTHONCOERCECLOCALE=0\u003c/code\u003e을 명시적으로 설정하면 locale 강제 변환이 비활성화됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e런타임 초기화 중 레거시 C locale 경고 (Legacy C locale warning during runtime initialization)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ePy_Initialize\u003c/code\u003e가 호출될 때 CPython이 여전히 기본 C locale에서 실행 중이고 \u003ccode\u003ePYTHONCOERCECLOCALE=0\u003c/code\u003e이 설정되지 않은 경우, Unicode 호환성 문제에 대한 경고가 발행됩니다 (나중에 기본적으로 비활성화됨).\u003c/li\u003e\n\u003cli\u003e이 경우 실제 locale 설정 변경은 없으며, 단순히 지원되지 않는 구성에서 Python 3를 실행 중임을 알립니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e새로운 빌드 타임 설정 옵션 (New build-time configuration options)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003elocale 강제 변환 동작은 \u003ccode\u003e--with[out]-c-locale-coercion\u003c/code\u003e 플래그로 제어되며, \u003ccode\u003ePY_COERCE_C_LOCALE\u003c/code\u003e 전처리기 정의를 설정합니다.\u003c/li\u003e\n\u003cli\u003elocale 경고 동작은 \u003ccode\u003e--with[out]-c-locale-warning\u003c/code\u003e 플래그로 제어됩니다 (나중에 런타임 \u003ccode\u003ePYTHONCOERCECLOCALE=warn\u003c/code\u003e 옵션으로 대체됨).\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e표준 스트림의 기본 오류 처리 변경 (Changes to the default error handling on the standard streams)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003ePython 3.5부터 C locale에서는 \u003ccode\u003esys.stdin\u003c/code\u003e, \u003ccode\u003esys.stdout\u003c/code\u003e에 \u003ccode\u003esurrogateescape\u003c/code\u003e 오류 핸들러를 기본으로 사용했습니다. 다른 locale에서는 \u003ccode\u003estrict\u003c/code\u003e를 사용했습니다.\u003c/li\u003e\n\u003cli\u003e이 PEP에서는 \u003ccode\u003eC.UTF-8\u003c/code\u003e, \u003ccode\u003eC.utf8\u003c/code\u003e, \u003ccode\u003eUTF-8\u003c/code\u003e과 같은 강제 변환 대상 locale에서도 \u003ccode\u003esurrogateescape\u003c/code\u003e를 기본 오류 핸들러로 사용하도록 확장합니다.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esys.stderr\u003c/code\u003e의 기본 오류 핸들러는 \u003ccode\u003ebackslashreplace\u003c/code\u003e로 유지됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003eAndroid의 locale 설정 변경 (Changes to locale settings on Android)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003eAndroid 시스템에서는 \u003ccode\u003esetlocale(LC_ALL, \"C.UTF-8\")\u003c/code\u003e 및 \u003ccode\u003esetlocale(LC_CTYPE, \"C.UTF-8\")\u003c/code\u003e이 호출되도록 업데이트됩니다. 이는 Android에서 \u003ccode\u003e\"\"\u003c/code\u003e를 \u003ccode\u003esetlocale\u003c/code\u003e에 전달하는 것이 \u003ccode\u003e\"C\"\u003c/code\u003e와 동일하게 취급되며, \u003ccode\u003eC.UTF-8\u003c/code\u003e locale이 항상 사용 가능하기 때문입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e근거 (Rationale)\u003c/h3\u003e\n\u003ch4\u003eC locale 처리 개선 (Improving the handling of the C locale)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003eC locale의 기본 ASCII 인코딩은 현대 네트워크 서비스 개발에 부적합하다는 것이 명확해졌습니다. Rust, Go, Node.js와 같은 최신 언어는 이미 UTF-8을 기본 텍스트 인코딩으로 가정합니다.\u003c/li\u003e\n\u003cli\u003eCPython은 임베디드 스크립팅 언어 및 데스크톱 애플리케이션 개발에도 사용되기 때문에 다른 locale 인식 구성 요소와의 일관성이 중요합니다.\u003c/li\u003e\n\u003cli\u003e이 PEP의 핵심 전제는 이러한 모든 사용 사례에서 기본 \"C\" locale이 암시하는 ASCII 가정이 잘못되었으며, 데스크톱 애플리케이션에서는 locale이 이미 올바르게 구성되어 있어야 하고, 네트워크 서비스 개발 (특히 Linux 컨테이너)에서는 구성 요소가 자체 기본 인코딩(예: UTF-8)을 부과해야 한다는 것입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e표준 IO 스트림에 \"surrogateescape\" 오류 처리 기본값 설정 (Defaulting to “surrogateescape” error handling on the standard IO streams)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003elocale을 레거시 C locale에서 벗어나게 함으로써, 이 PEP는 표준 IO 스트림에 \u003ccode\u003esurrogateescape\u003c/code\u003e 사용을 비활성화하는 대신, 강제 변환 대상 세 가지 locale에도 \u003ccode\u003esurrogateescape\u003c/code\u003e 기본값을 적용하도록 제안합니다.\u003c/li\u003e\n\u003cli\u003e이는 운영체제가 제공하는 텍스트 값이 UTF-8로 인코딩되었다는 가정이 틀렸더라도 Python 3 애플리케이션을 통해 투명하게 전달될 수 있도록 보장하는 것을 목표로 합니다.\u003c/li\u003e\n\u003cli\u003e특히 GB 18030, Shift-JIS, ISO-2022-JP와 같이 ASCII 및 UTF-8과 호환되지 않는 인코딩도 \u003ccode\u003esurrogateescape\u003c/code\u003e를 통해 처리될 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003eUTF-8 locale 강제 변환 중 \u003ccode\u003ePYTHONIOENCODING\u003c/code\u003e 설정 방지 (Avoiding setting PYTHONIOENCODING during UTF-8 locale coercion)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e이전 버전의 PEP는 \u003ccode\u003ePYTHONIOENCODING\u003c/code\u003e을 \u003ccode\u003eutf-8:surrogateescape\u003c/code\u003e로 설정하는 것을 제안했지만, 이는 Python 2.7 하위 프로세스와의 호환성 문제를 야기했습니다.\u003c/li\u003e\n\u003cli\u003e현재 설계는 이전 Python 버전이 기본 \u003ccode\u003estrict\u003c/code\u003e 오류 처리를 유지하고, Python 3.7+는 \u003ccode\u003esurrogateescape\u003c/code\u003e를 일관되게 사용하도록 합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e레거시 C locale에서의 ASCII 기반 텍스트 처리 공식 지원 중단 (Dropping official support for ASCII based text handling in the legacy C locale)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e레거시 C locale에서 엄격한 바이트/텍스트 분리를 안정적으로 작동시키려는 시도는 10년 이상 실패했습니다.\u003c/li\u003e\n\u003cli\u003e이 PEP는 개발자가 필요하다면 여전히 레거시 C locale에서 Python 코드를 실행할 수 있도록 허용하지만 (\u003ccode\u003eLC_ALL=C\u003c/code\u003e, \u003ccode\u003ePYTHONCOERCECLOCALE=0\u003c/code\u003e 설정 또는 사용자 정의 빌드를 통해), Python 3의 Unicode 처리가 해당 구성에서 완전히 신뢰할 수 없을 것이며, 더 적절한 locale 설정을 사용할 것을 권장합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e독립형으로 실행될 때만 암시적 locale 강제 변환 제공 (Providing implicit locale coercion only when running standalone)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e이 PEP의 주요 단점은 CPython 런타임이 독립형 애플리케이션으로 실행될 때와 더 큰 시스템에 임베딩된 구성 요소로 실행될 때 동작 불일치를 유발할 수 있다는 점입니다.\u003c/li\u003e\n\u003cli\u003e이 문제는 locale 강제 변환을 인터프리터 시작 시퀀스에서 가능한 한 일찍, 즉 C 수준의 \u003ccode\u003emain()\u003c/code\u003e 함수에서 \u003ccode\u003ePy_Main()\u003c/code\u003e 라이브러리 함수를 호출하기 전부터 처리함으로써 해결됩니다.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ePy_Initialize\u003c/code\u003e API는 C locale 사용을 감지할 때만 명시적인 경고를 발생시키고, 임베딩 애플리케이션이 더 합리적인 것을 지정하도록 의존합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e레거시 동작 복원 허용 (Allowing restoration of the legacy behaviour)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ePYTHONCOERCECLOCALE=0\u003c/code\u003e 환경 변수를 설정하여 locale 강제 변환 동작을 쉽게 켜고 끌 수 있습니다. 이는 디버깅 목적으로 다른 애플리케이션의 동작을 재현하거나 이전 Python 3.x 런타임의 동작을 재현하는 데 유용합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003eC locale 감지를 위해 \u003ccode\u003eLC_CTYPE\u003c/code\u003e 쿼리 (Querying LC_CTYPE for C locale detection)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eLC_CTYPE\u003c/code\u003e은 환경 변수, 명령줄 인수 및 운영체제로부터 받은 다른 텍스트 값의 암시적 디코딩을 구동하는 실제 locale 범주입니다. 따라서 Unicode 처리 문제 발생 여부를 판단할 때 이를 특별히 확인하는 것이 합리적입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003eUTF-8 locale 강제 변환을 위해 \u003ccode\u003eLC_CTYPE\u003c/code\u003e 명시적 설정 (Explicitly setting LC_CTYPE for UTF-8 locale coercion)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eLC_CTYPE\u003c/code\u003e을 \u003ccode\u003eC.UTF-8\u003c/code\u003e로 설정하는 것은 \u003ccode\u003eLC_CTYPE=UTF-8\u003c/code\u003e과 같은 설정이 UTF-8 locale이 정의되지 않은 시스템에서 제공될 때 발생하는 문제를 처리하는 데 중요합니다 (예: macOS SSH 클라이언트가 locale 설정을 전달하도록 구성되어 있고, 사용자가 Linux 서버에 로그인할 때).\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003eUTF-8 locale 강제 변환 중 \u003ccode\u003eLANG\u003c/code\u003e 설정 방지 (Avoiding setting LANG for UTF-8 locale coercion)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e이전 버전의 PEP는 \u003ccode\u003eLC_CTYPE\u003c/code\u003e과 함께 \u003ccode\u003eLANG\u003c/code\u003e을 설정하는 것을 제안했지만, \u003ccode\u003eLC_CTYPE\u003c/code\u003e만으로 PEP가 해결하려는 모든 문제가 처리 가능하며, \u003ccode\u003eLANG\u003c/code\u003e을 설정하면 \u003ccode\u003eLC_TIME\u003c/code\u003e과 같은 다른 locale 범주 설정이 의도치 않게 변경될 수 있어 제거되었습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003eUTF-8 locale 강제 변환 중 \u003ccode\u003eLC_ALL\u003c/code\u003e 설정 방지 (Avoiding setting LC_ALL for UTF-8 locale coercion)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e이전 버전의 PEP는 \u003ccode\u003eLC_CTYPE\u003c/code\u003e과 함께 \u003ccode\u003eLC_ALL\u003c/code\u003e을 설정하는 것을 제안했지만, \u003ccode\u003eLC_ALL\u003c/code\u003e을 설정하면 \u003ccode\u003eLC_MONETARY\u003c/code\u003e와 같은 다른 범주 설정에 문제가 발생할 수 있어 변경되었습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e현재 환경에 \u003ccode\u003eLC_ALL\u003c/code\u003e이 설정되어 있으면 locale 강제 변환 건너뛰기 (Skipping locale coercion if LC_ALL is set in the current environment)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eLC_ALL\u003c/code\u003e이 설정된 경우 locale 강제 변환은 효과가 없으므로, 불필요한 경고를 피하기 위해 강제 변환을 완전히 건너뜁니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e\"UTF-8 모드\"와 독립적으로 locale 강제 변환 고려 (Considering locale coercion independently of “UTF-8 mode”)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003ePEP 540의 UTF-8 모드는 현재 구성할 수 없는 기본 동작을 변경할 수 있다는 점에서 흥미롭지만, 검증되지 않은 접근 방식입니다. 반면 이 PEP의 접근 방식은 기존의 C locale 시스템 설정(\u003ccode\u003eLC_CTYPE\u003c/code\u003e, \u003ccode\u003eLANG\u003c/code\u003e)과 Python의 표준 스트림 설정(\u003ccode\u003ePYTHONIOENCODING\u003c/code\u003e)을 기반으로 합니다.\u003c/li\u003e\n\u003cli\u003e또한, 이 PEP의 locale 강제 변환은 CPython 자체뿐만 아니라 GNU readline과 같이 표준 스트림과 상호 작용하는 확장 모듈의 문제도 해결할 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003emacOS, iOS 및 Android에서 C locale 강제 변환 및 경고 활성화 (Enabling C locale coercion and warnings on Mac OS X, iOS and Android)\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e이전에는 이들 플랫폼에서 locale 강제 변환 및 경고를 빌드 타임에 비활성화할 것을 제안했지만, \u003ccode\u003eLANG=C\u003c/code\u003e를 명시적으로 설정할 경우 GNU readline과 같은 확장 모듈이 오작동하는 것으로 밝혀져, 모든 CPython의 autotools 기반 빌드 툴체인을 사용하는 플랫폼(Windows 제외)에서 기본적으로 활성화됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e구현 (Implementation)\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e참고 구현은 Alyssa Coghlan의 CPython 저장소의 \u003ccode\u003epep538-coerce-c-locale\u003c/code\u003e 기능 브랜치에서 개발 중입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e이전 Python 3 릴리스로의 백포팅 (Backporting to earlier Python 3 releases)\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003ePython 3.7에서 이 PEP가 채택되면, 재배포자는 Python 3.6.x 릴리스로 변경 사항을 백포팅할 수 있으며 권장됩니다. 다만, 적절한 locale을 기본으로 제공하는 변경 사항과 함께 이루어져야 합니다.\u003c/li\u003e\n\u003cli\u003e다른 Python 3.x 릴리스로의 백포팅은 일반적인 관행으로는 권장되지 않지만, 일부 재배포자는 사용자 기반의 필요에 따라 백포팅을 선택할 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cblockquote\u003e\n\u003cp\u003e⚠️ \u003cstrong\u003e알림:\u003c/strong\u003e 이 문서는 AI를 활용하여 번역되었으며, 기술적 정확성을 보장하지 않습니다. 정확한 내용은 반드시 원문을 확인하시기 바랍니다.\u003c/p\u003e\n\u003c/blockquote\u003e\n"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"flex flex-col lg:flex-row gap-8\",\"children\":[[\"$\",\"aside\",null,{\"className\":\"lg:w-64 xl:w-72 order-1 lg:order-none\",\"children\":[\"$\",\"div\",null,{\"className\":\"sidebar sticky\",\"children\":[\"$\",\"nav\",null,{\"className\":\"space-y-4\",\"children\":[[\"$\",\"div\",\"Backend\",{\"children\":[[\"$\",\"h4\",null,{\"className\":\"font-medium text-gray-900 mb-2\",\"children\":\"Backend\"}],[\"$\",\"ul\",null,{\"className\":\"space-y-1 ml-4\",\"children\":[[\"$\",\"li\",\"Django\",{\"children\":[\"$\",\"a\",null,{\"href\":\"/backend/django/\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Django\",\" (\",6,\")\"]}]}],[\"$\",\"li\",\"Logging\",{\"children\":[\"$\",\"a\",null,{\"href\":\"/backend/logging/\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Logging\",\" (\",1,\")\"]}]}]]}]]}],[\"$\",\"div\",\"Python\",{\"children\":[[\"$\",\"h4\",null,{\"className\":\"font-medium text-gray-900 mb-2\",\"children\":\"Python\"}],[\"$\",\"ul\",null,{\"className\":\"space-y-1 ml-4\",\"children\":[[\"$\",\"li\",\"PEP\",{\"children\":[\"$\",\"a\",null,{\"href\":\"/python/pep/\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"PEP\",\" (\",650,\")\"]}]}]]}]]}],[\"$\",\"div\",\"AI/ML\",{\"children\":[[\"$\",\"h4\",null,{\"className\":\"font-medium text-gray-900 mb-2\",\"children\":\"AI/ML\"}],[\"$\",\"ul\",null,{\"className\":\"space-y-1 ml-4\",\"children\":[[\"$\",\"li\",\"LLM\",{\"children\":[\"$\",\"a\",null,{\"href\":\"/ai/llm/\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"LLM\",\" (\",1,\")\"]}]}],[\"$\",\"li\",\"Review\",{\"children\":[\"$\",\"a\",null,{\"href\":\"/ai/review/\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Review\",\" (\",1025,\")\"]}]}]]}]]}],[\"$\",\"div\",\"DevOps\",{\"children\":[[\"$\",\"h4\",null,{\"className\":\"font-medium text-gray-900 mb-2\",\"children\":\"DevOps\"}],[\"$\",\"ul\",null,{\"className\":\"space-y-1 ml-4\",\"children\":[[\"$\",\"li\",\"Nginx\",{\"children\":[\"$\",\"a\",null,{\"href\":\"/devops/nginx/\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Nginx\",\" (\",1,\")\"]}]}],[\"$\",\"li\",\"Docker\",{\"children\":[\"$\",\"a\",null,{\"href\":\"/devops/docker/\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Docker\",\" (\",1,\")\"]}]}],[\"$\",\"li\",\"SafeLine\",{\"children\":[\"$\",\"a\",null,{\"href\":\"/devops/safeline/\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"SafeLine\",\" (\",1,\")\"]}]}],[\"$\",\"li\",\"Jenkins\",{\"children\":[\"$\",\"a\",null,{\"href\":\"/devops/jenkins/\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Jenkins\",\" (\",3,\")\"]}]}],[\"$\",\"li\",\"GitHub Actions\",{\"children\":[\"$\",\"a\",null,{\"href\":\"/devops/github-actions/\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"GitHub Actions\",\" (\",1,\")\"]}]}],[\"$\",\"li\",\"AWS\",{\"children\":[\"$\",\"a\",null,{\"href\":\"/devops/aws/\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"AWS\",\" (\",1,\")\"]}]}]]}]]}],[\"$\",\"div\",\"etc\",{\"children\":[[\"$\",\"h4\",null,{\"className\":\"font-medium text-gray-900 mb-2\",\"children\":\"etc\"}],[\"$\",\"ul\",null,{\"className\":\"space-y-1 ml-4\",\"children\":[[\"$\",\"li\",\"Me\",{\"children\":[\"$\",\"a\",null,{\"href\":\"/etc/me/\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Me\",\" (\",3,\")\"]}]}],[\"$\",\"li\",\"Chrome Extension\",{\"children\":[\"$\",\"a\",null,{\"href\":\"/etc/chrome-extension/\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Chrome Extension\",\" (\",1,\")\"]}]}]]}]]}]]}]}]}],[\"$\",\"main\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"article\",null,{\"className\":\"page\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"page__title\",\"children\":\"[Final] PEP 538 - Coercing the legacy C locale to a UTF-8 based locale\"}],[\"$\",\"div\",null,{\"className\":\"page__meta\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2025-09-26 23:28:03+0900\",\"children\":\"2025년 9월 26일\"}],[\"$\",\"span\",null,{\"className\":\"ml-4\",\"children\":[\"수정: \",\"2025년 9월 26일\"]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"page__content\",\"children\":[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$e\"}}]}],[\"$\",\"footer\",null,{\"className\":\"page__meta mt-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"page__taxonomy\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"text-sm font-medium text-gray-900 mb-2\",\"children\":\"태그\"}],[[\"$\",\"span\",\"Python\",{\"className\":\"page__taxonomy-item\",\"children\":[\"#\",\"Python\"]}],[\"$\",\"span\",\"PEP\",{\"className\":\"page__taxonomy-item\",\"children\":[\"#\",\"PEP\"]}],[\"$\",\"span\",\"Translation\",{\"className\":\"page__taxonomy-item\",\"children\":[\"#\",\"Translation\"]}]]]}]}]]}]}]]}]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"secrett2633's blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"기술 블로그 - Django, Python, DevOps, AI/ML 관련 포스트\"}],[\"$\",\"meta\",\"4\",{\"name\":\"author\",\"content\":\"secrett2633\"}],[\"$\",\"meta\",\"5\",{\"name\":\"keywords\",\"content\":\"Django, Python, DevOps, AI, ML, 블로그, 기술\"}],[\"$\",\"meta\",\"6\",{\"name\":\"creator\",\"content\":\"secrett2633\"}],[\"$\",\"meta\",\"7\",{\"name\":\"publisher\",\"content\":\"secrett2633\"}],[\"$\",\"meta\",\"8\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"9\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"10\",{\"rel\":\"canonical\",\"href\":\"https://secrett2633.github.io/\"}],[\"$\",\"meta\",\"11\",{\"name\":\"format-detection\",\"content\":\"telephone=no, address=no, email=no\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:title\",\"content\":\"secrett2633's blog\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:description\",\"content\":\"기술 블로그 - Django, Python, DevOps, AI/ML 관련 포스트\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:url\",\"content\":\"https://secrett2633.github.io/\"}],[\"$\",\"meta\",\"15\",{\"property\":\"og:site_name\",\"content\":\"secrett2633's blog\"}],[\"$\",\"meta\",\"16\",{\"property\":\"og:locale\",\"content\":\"ko_KR\"}],[\"$\",\"meta\",\"17\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:title\",\"content\":\"secrett2633's blog\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:description\",\"content\":\"기술 블로그 - Django, Python, DevOps, AI/ML 관련 포스트\"}],[\"$\",\"link\",\"21\",{\"rel\":\"icon\",\"href\":\"/icon.ico?6d9f34d4948640b8\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"meta\",\"22\",{\"name\":\"next-size-adjust\"}]]\n4:null\n"])</script></body></html>