<!DOCTYPE html><html lang="ko" class="no-js"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/ddc331716d5e47a2.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-90b03762f46d1ba4.js"/><script src="/_next/static/chunks/fd9d1056-0395f68b8cc78a20.js" async=""></script><script src="/_next/static/chunks/23-7d3f7f0b78aa2fd3.js" async=""></script><script src="/_next/static/chunks/main-app-6087bc228fd56b83.js" async=""></script><script src="/_next/static/chunks/231-467e37449c5a68fc.js" async=""></script><script src="/_next/static/chunks/app/layout-b0a450f8e4964582.js" async=""></script><script src="/_next/static/chunks/app/%5B...slug%5D/page-1f60377561abdb46.js" async=""></script><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-NE2W3CFPNY" as="script"/><title>[Deferred] PEP 674 - Disallow using macros as l-values - secrett2633&#x27;s blog</title><meta name="description" content="Python Enhancement Proposal 674: &#x27;Disallow using macros as l-values&#x27;에 대한 한국어 번역입니다."/><meta name="author" content="secrett2633"/><link rel="manifest" href="/manifest.json" crossorigin="use-credentials"/><meta name="keywords" content="Django, Python, DevOps, AI, ML, 블로그, 기술"/><meta name="creator" content="secrett2633"/><meta name="publisher" content="secrett2633"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://blog.secrett2633.cloud/python/pep/674"/><meta name="format-detection" content="telephone=no, address=no, email=no"/><meta property="og:title" content="[Deferred] PEP 674 - Disallow using macros as l-values"/><meta property="og:description" content="Python Enhancement Proposal 674: &#x27;Disallow using macros as l-values&#x27;에 대한 한국어 번역입니다."/><meta property="og:url" content="https://blog.secrett2633.cloud/python/pep/674"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2025-09-27T01:07:42.000Z"/><meta property="article:modified_time" content="2025-09-27T01:07:42.000Z"/><meta property="article:author" content="secrett2633"/><meta property="article:section" content="Python"/><meta property="article:tag" content="Python"/><meta property="article:tag" content="PEP"/><meta property="article:tag" content="Translation"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="@secrett2633"/><meta name="twitter:title" content="[Deferred] PEP 674 - Disallow using macros as l-values"/><meta name="twitter:description" content="Python Enhancement Proposal 674: &#x27;Disallow using macros as l-values&#x27;에 대한 한국어 번역입니다."/><link rel="icon" href="/icon.ico?6d9f34d4948640b8" type="image/x-icon" sizes="16x16"/><meta name="next-size-adjust"/><meta name="msapplication-TileColor" content="#ffc40d"/><meta name="theme-color" content="#ffffff"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"/><link rel="dns-prefetch" href="https://giscus.app"/><link rel="preconnect" href="https://giscus.app" crossorigin="anonymous"/><meta http-equiv="X-Content-Type-Options" content="nosniff"/><meta name="referrer" content="strict-origin-when-cross-origin"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"secrett2633's blog","url":"https://blog.secrett2633.cloud","description":"기술 블로그 - Django, Python, DevOps, AI/ML 관련 포스트","inLanguage":"ko","publisher":{"@type":"Person","name":"secrett2633","url":"https://blog.secrett2633.cloud"}}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Person","name":"secrett2633","url":"https://blog.secrett2633.cloud","sameAs":["https://github.com/secrett2633"]}</script><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_f367f3 layout--default"><a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:z-50 focus:p-4 focus:bg-white focus:text-blue-600">본문으로 건너뛰기</a><div class="min-h-screen bg-gray-50"><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav id="site-nav" class="greedy-nav" aria-label="메인 네비게이션"><a class="site-title" href="/">secrett2633&#x27;s blog</a><div class="flex items-center space-x-4"><ul class="visible-links"><li class="masthead__menu-item"><a href="https://github.com/secrett2633" target="_blank" rel="noopener noreferrer">GitHub</a></li></ul><button class="search__toggle" type="button" aria-label="검색"><svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16"><path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path></svg></button></div></nav></div></div></div><main id="main-content" class="initial-content"><!--$--><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Deferred] PEP 674 - Disallow using macros as l-values","description":"Python Enhancement Proposal 674: 'Disallow using macros as l-values'에 대한 한국어 번역입니다.","url":"https://blog.secrett2633.cloud/python/pep/674","datePublished":"2025-09-27T01:07:42.000Z","dateModified":"2025-09-27T01:07:42.000Z","author":{"@type":"Person","name":"secrett2633","url":"https://blog.secrett2633.cloud"},"publisher":{"@type":"Person","name":"secrett2633","url":"https://blog.secrett2633.cloud"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.secrett2633.cloud/python/pep/674"},"image":"https://blog.secrett2633.cloud/og-default.png","isAccessibleForFree":true,"inLanguage":"ko","wordCount":1505,"articleSection":"Python","keywords":"Python, PEP, Translation"}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"홈","item":"https://blog.secrett2633.cloud/"},{"@type":"ListItem","position":2,"name":"[Deferred] PEP 674 - Disallow using macros as l-values","item":"https://blog.secrett2633.cloud/python/pep/674"}]}</script><div class="flex flex-col lg:flex-row gap-8"><aside class="lg:w-64 xl:w-72 order-1 lg:order-none"><div class="sidebar sticky"><nav class="space-y-4" aria-label="카테고리 네비게이션"><div><p class="font-medium text-gray-900 mb-2">Backend</p><ul class="space-y-1 ml-4"><li><a class="text-sm text-gray-600 hover:text-primary-600 block py-1" href="/backend/django">Django<!-- --> (<!-- -->6<!-- -->)</a></li><li><a class="text-sm text-gray-600 hover:text-primary-600 block py-1" href="/backend/logging">Logging<!-- --> (<!-- -->1<!-- -->)</a></li></ul></div><div><p class="font-medium text-gray-900 mb-2">Python</p><ul class="space-y-1 ml-4"><li><a class="text-sm text-gray-600 hover:text-primary-600 block py-1" href="/python/pep">PEP<!-- --> (<!-- -->650<!-- -->)</a></li></ul></div><div><p class="font-medium text-gray-900 mb-2">AI/ML</p><ul class="space-y-1 ml-4"><li><a class="text-sm text-gray-600 hover:text-primary-600 block py-1" href="/ai/llm">LLM<!-- --> (<!-- -->1<!-- -->)</a></li><li><a class="text-sm text-gray-600 hover:text-primary-600 block py-1" href="/ai/review">Review<!-- --> (<!-- -->2728<!-- -->)</a></li></ul></div><div><p class="font-medium text-gray-900 mb-2">DevOps</p><ul class="space-y-1 ml-4"><li><a class="text-sm text-gray-600 hover:text-primary-600 block py-1" href="/devops/nginx">Nginx<!-- --> (<!-- -->1<!-- -->)</a></li><li><a class="text-sm text-gray-600 hover:text-primary-600 block py-1" href="/devops/docker">Docker<!-- --> (<!-- -->1<!-- -->)</a></li><li><a class="text-sm text-gray-600 hover:text-primary-600 block py-1" href="/devops/safeline">SafeLine<!-- --> (<!-- -->1<!-- -->)</a></li><li><a class="text-sm text-gray-600 hover:text-primary-600 block py-1" href="/devops/jenkins">Jenkins<!-- --> (<!-- -->3<!-- -->)</a></li><li><a class="text-sm text-gray-600 hover:text-primary-600 block py-1" href="/devops/github-actions">GitHub Actions<!-- --> (<!-- -->1<!-- -->)</a></li><li><a class="text-sm text-gray-600 hover:text-primary-600 block py-1" href="/devops/aws">AWS<!-- --> (<!-- -->1<!-- -->)</a></li></ul></div><div><p class="font-medium text-gray-900 mb-2">etc</p><ul class="space-y-1 ml-4"><li><a class="text-sm text-gray-600 hover:text-primary-600 block py-1" href="/etc/me">Me<!-- --> (<!-- -->3<!-- -->)</a></li><li><a class="text-sm text-gray-600 hover:text-primary-600 block py-1" href="/etc/chrome-extension">Chrome Extension<!-- --> (<!-- -->1<!-- -->)</a></li></ul></div></nav></div></aside><div class="flex-1"><nav aria-label="breadcrumb" class="text-sm text-gray-500 mb-4"><ol class="flex flex-wrap items-center gap-1"><li><a class="hover:text-gray-700" href="/">홈</a></li><li class="flex items-center gap-1"><span aria-hidden="true">/</span><span class="text-gray-900" aria-current="page">[Deferred] PEP 674 - Disallow using macros as l-values</span></li></ol></nav><article class="page"><header class="mb-8"><h1 class="page__title">[Deferred] PEP 674 - Disallow using macros as l-values</h1><div class="page__meta"><time dateTime="2025-09-27 10:07:42+0900">2025년 9월 27일</time><time class="ml-4" dateTime="2025-09-27T01:07:42.000Z">수정: <!-- -->2025년 9월 27일</time></div></header><div class="page__content"><div><blockquote>
<p><strong>원문 링크:</strong> <a href="https://peps.python.org/pep-0674/" target="_blank" rel="noopener noreferrer">PEP 674 - Disallow using macros as l-values</a></p>
<p><strong>상태:</strong> Deferred | <strong>유형:</strong> Standards Track | <strong>작성일:</strong> 30-Nov-2021</p>
</blockquote>
<h2 id="pep-674-매크로를-좌변값l-value으로-사용하는-것을-금지"><a href="#pep-674-매크로를-좌변값l-value으로-사용하는-것을-금지">PEP 674 – 매크로를 좌변값(l-value)으로 사용하는 것을 금지</a></h2>
<h3 id="초록-abstract"><a href="#초록-abstract">초록 (Abstract)</a></h3>
<p>이 PEP는 C API에서 매크로를 좌변값(l-value)으로 사용하는 것을 금지하는 것을 제안합니다. 예를 들어, <code>Py_TYPE(obj) = new_type</code>과 같은 코드는 이제 컴파일러 오류를 발생시킵니다.</p>
<p>실제로는 대부분의 영향을 받는 프로젝트에서 단 두 가지만 변경하면 됩니다.</p>
<ul>
<li><code>Py_TYPE(obj) = new_type</code>을 <code>Py_SET_TYPE(obj, new_type)</code>으로 교체합니다.</li>
<li><code>Py_SIZE(obj) = new_size</code>를 <code>Py_SET_SIZE(obj, new_size)</code>로 교체합니다.</li>
</ul>
<h3 id="pep-연기-pep-deferral"><a href="#pep-연기-pep-deferral">PEP 연기 (PEP Deferral)</a></h3>
<p>이 PEP는 2022년 2월에 스티어링 카운실(Steering Council)의 결정에 따라 연기되었습니다.</p>
<h3 id="도입-배경-rationale"><a href="#도입-배경-rationale">도입 배경 (Rationale)</a></h3>
<h4 id="매크로를-좌변값으로-사용하기-using-a-macro-as-an-l-value"><a href="#매크로를-좌변값으로-사용하기-using-a-macro-as-an-l-value">매크로를 좌변값으로 사용하기 (Using a macro as an l-value)</a></h4>
<p>Python C API에서 일부 함수는 일반 함수보다 매크로로 작성하는 것이 더 간단하기 때문에 매크로로 구현됩니다. 매크로가 구조체 멤버를 직접 노출하는 경우, 기술적으로 이 매크로를 사용하여 구조체 멤버를 가져올 뿐만 아니라 설정하는 것도 가능합니다.</p>
<p>예를 들어, Python 3.10의 <code>Py_TYPE()</code> 매크로는 다음과 같습니다.</p>
<pre><code class="language-c">#define Py_TYPE(ob) (((PyObject *)(ob))->ob_type)
</code></pre>
<p>이 매크로는 객체의 타입을 얻기 위한 우변값(r-value)으로 사용될 수 있습니다:</p>
<pre><code class="language-c">type = Py_TYPE(object);
</code></pre>
<p>또한, 객체의 타입을 설정하기 위한 좌변값(l-value)으로도 사용될 수 있습니다:</p>
<pre><code class="language-c">Py_TYPE(object) = new_type;
</code></pre>
<p><code>Py_REFCNT()</code> 및 <code>Py_SIZE()</code> 매크로를 사용하여 객체의 참조 카운트와 객체 크기를 설정하는 것도 가능합니다.</p>
<p>객체 속성을 직접 설정하는 것은 현재의 정확한 CPython 구현에 의존합니다. 이 기능을 다른 Python 구현에서 구현하면 C API 구현의 효율성이 떨어질 수 있습니다.</p>
<h4 id="cpython-nogil-포크-cpython-nogil-fork"><a href="#cpython-nogil-포크-cpython-nogil-fork">CPython nogil 포크 (CPython nogil fork)</a></h4>
<p>Sam Gross는 GIL(Global Interpreter Lock)을 제거하기 위해 Python 3.9를 포크(fork)하여 <code>nogil</code> 브랜치를 만들었습니다. 이 포크에는 <code>PyObject.ob_refcnt</code> 멤버가 없지만, 참조 카운팅을 위한 더 정교한 구현이 있어서 <code>Py_REFCNT(obj) = new_refcnt;</code> 코드는 컴파일러 오류를 발생시킵니다.</p>
<p><code>nogil</code> 포크를 CPython 메인 브랜치에 병합하려면 먼저 이 C API 호환성 문제를 해결해야 합니다. 이는 C API로 인해 간접적으로 차단된 Python 최적화의 구체적인 예입니다.
<code>Py_REFCNT()</code> 매크로는 이미 Python 3.10에서 좌변값으로 사용되지 않도록 수정되었습니다.</p>
<h4 id="hpy-프로젝트-hpy-project"><a href="#hpy-프로젝트-hpy-project">HPy 프로젝트 (HPy project)</a></h4>
<p>HPy 프로젝트는 핸들과 함수 호출만 사용하는 새로운 Python용 C API입니다. 핸들은 불투명하며, 구조체 멤버에 직접 접근할 수 없고, 포인터를 역참조할 수 없습니다.</p>
<p><code>Py_SIZE()</code>와 같은 매크로의 이상한 사용법을 찾아 바꾸는 것보다 <code>Py_SET_SIZE()</code>를 찾아 바꾸는 것이 더 쉽고 안전합니다. <code>Py_SIZE()</code>는 <code>HPy_Length()</code>로 반자동으로 교체될 수 있지만, <code>Py_SET_SIZE()</code>를 보면 코드를 HPy로 포팅하기 위해 더 큰 변경(예: <code>HPyTupleBuilder</code> 또는 <code>HPyListBuilder</code> 사용)이 필요하다는 것을 즉시 알 수 있습니다.
매크로를 통해 노출되는 내부 세부 사항이 적을수록 HPy가 직접적인 동등물을 제공하기 쉬워집니다. "비공개" 인터페이스를 참조하는 모든 매크로는 해당 인터페이스를 사실상 공개적으로 노출합니다.</p>
<h4 id="graalvm-python"><a href="#graalvm-python">GraalVM Python</a></h4>
<p>GraalVM에서 Python 객체가 Python C API에 의해 접근될 때, C API 에뮬레이션 계층은 GraalVM 객체를 CPython 구조체(PyObject, PyLongObject, PyTypeObject 등)의 내부 구조를 노출하는 래퍼(wrapper)로 감싸야 합니다. 이는 C 코드가 직접 또는 매크로를 통해 접근할 때, GraalVM이 가로챌 수 있는 것은 구조체 오프셋에서의 읽기뿐이며, 이를 GraalVM의 표현으로 다시 매핑해야 하기 때문입니다. 매크로를 함수로 대체하여 노출되는 구조체 멤버의 "실제" 수가 적을수록 GraalVM 래퍼가 더 간단해질 수 있습니다.
이 PEP만으로는 GraalVM의 래퍼를 제거하기에 충분하지 않지만, 장기적인 목표를 향한 한 걸음입니다. GraalVM은 이미 장기적으로 더 나은 솔루션인 HPy를 지원합니다.</p>
<h3 id="명세-specification"><a href="#명세-specification">명세 (Specification)</a></h3>
<h4 id="매크로를-좌변값으로-사용하는-것을-금지-disallow-using-macros-as-l-values"><a href="#매크로를-좌변값으로-사용하는-것을-금지-disallow-using-macros-as-l-values">매크로를 좌변값으로 사용하는 것을 금지 (Disallow using macros as l-values)</a></h4>
<p>다음 65개 매크로는 좌변값으로 사용하는 것을 금지하도록 수정됩니다.</p>
<ul>
<li>
<p><strong><code>PyObject</code> 및 <code>PyVarObject</code> 매크로:</strong></p>
<ul>
<li><code>Py_TYPE()</code>: 대신 <code>Py_SET_TYPE()</code>을 사용해야 합니다.</li>
<li><code>Py_SIZE()</code>: 대신 <code>Py_SET_SIZE()</code>를 사용해야 합니다.</li>
</ul>
</li>
<li>
<p><strong><code>GET</code> 매크로:</strong> <code>PyByteArray_GET_SIZE()</code>, <code>PyBytes_GET_SIZE()</code>, <code>PyCFunction_GET_CLASS()</code> 등 다수의 <code>GET</code> 매크로가 포함됩니다.</p>
</li>
<li>
<p><strong><code>AS</code> 매크로:</strong> <code>PyByteArray_AS_STRING()</code>, <code>PyBytes_AS_STRING()</code>, <code>PyFloat_AS_DOUBLE()</code> 등.</p>
</li>
<li>
<p><strong><code>PyUnicode</code> 매크로:</strong> <code>PyUnicode_1BYTE_DATA()</code>, <code>PyUnicode_2BYTE_DATA()</code>, <code>PyUnicode_4BYTE_DATA()</code> 등.</p>
</li>
<li>
<p><strong><code>PyDateTime GET</code> 매크로:</strong> <code>PyDateTime_DATE_GET_FOLD()</code>, <code>PyDateTime_DATE_GET_HOUR()</code> 등 다수의 <code>GET</code> 매크로가 포함됩니다.</p>
</li>
</ul>
<h4 id="c-확장-모듈을-python-311로-포팅-port-c-extensions-to-python-311"><a href="#c-확장-모듈을-python-311로-포팅-port-c-extensions-to-python-311">C 확장 모듈을 Python 3.11로 포팅 (Port C extensions to Python 3.11)</a></h4>
<p>실제로 이 PEP의 영향을 받는 대부분의 프로젝트는 단 두 가지만 변경하면 됩니다.</p>
<ul>
<li><code>Py_TYPE(obj) = new_type</code>을 <code>Py_SET_TYPE(obj, new_type)</code>으로 교체합니다.</li>
<li><code>Py_SIZE(obj) = new_size</code>를 <code>Py_SET_SIZE(obj, new_size)</code>로 교체합니다.</li>
</ul>
<p><code>pythoncapi_compat</code> 프로젝트를 사용하여 C 확장 모듈을 자동으로 업데이트할 수 있습니다. 이 프로젝트는 Python 3.8 이하 버전을 지원하면서 Python 3.11 지원을 추가할 수 있도록 <code>Py_SET_REFCNT()</code>, <code>Py_SET_TYPE()</code>, <code>Py_SET_SIZE()</code> 함수를 제공하는 헤더 파일을 제공합니다.</p>
<h4 id="pytuple_get_item-및-pylist_get_item은-변경되지-않음-pytuple_get_item-and-pylist_get_item-are-left-unchanged"><a href="#pytuple_get_item-및-pylist_get_item은-변경되지-않음-pytuple_get_item-and-pylist_get_item-are-left-unchanged"><code>PyTuple_GET_ITEM()</code> 및 <code>PyList_GET_ITEM()</code>은 변경되지 않음 (PyTuple_GET_ITEM() and PyList_GET_ITEM() are left unchanged)</a></h4>
<p><code>PyTuple_GET_ITEM()</code> 및 <code>PyList_GET_ITEM()</code> 매크로는 변경되지 않습니다. <code>&#x26;PyTuple_GET_ITEM(tuple, 0)</code> 및 <code>&#x26;PyList_GET_ITEM(list, 0)</code> 코드 패턴은 여전히 내부 <code>PyObject**</code> 배열에 접근하기 위해 일반적으로 사용됩니다. 이 매크로들을 변경하는 것은 이 PEP의 범위를 벗어납니다.</p>
<h4 id="pydescr_name-및-pydescr_type은-변경되지-않음-pydescr_name-and-pydescr_type-are-left-unchanged"><a href="#pydescr_name-및-pydescr_type은-변경되지-않음-pydescr_name-and-pydescr_type-are-left-unchanged"><code>PyDescr_NAME()</code> 및 <code>PyDescr_TYPE()</code>은 변경되지 않음 (PyDescr_NAME() and PyDescr_TYPE() are left unchanged)</a></h4>
<p><code>PyDescr_NAME()</code> 및 <code>PyDescr_TYPE()</code> 매크로는 변경되지 않습니다. 이 매크로들은 <code>PyDescrObject.d_name</code> 및 <code>PyDescrObject.d_type</code> 멤버에 접근을 제공하며, 이 멤버들을 설정하기 위한 좌변값으로 사용될 수 있습니다.
SWIG 프로젝트는 이 매크로들을 좌변값으로 사용하여 이 멤버들을 설정합니다. <code>PyDescrObject</code> 구조체는 성능에 중요하지 않고 곧 변경될 가능성이 적으므로 SWIG를 수정하여 <code>PyDescrObject</code> 구조체 멤버를 직접 설정하는 것을 방지하는 것은 그리 가치 있는 일이 아닙니다.</p>
<h3 id="구현-implementation"><a href="#구현-implementation">구현 (Implementation)</a></h3>
<p>구현은 bpo-45476: [C API] PEP 674: Disallow using macros as l-values에서 추적됩니다.</p>
<h4 id="py_type-및-py_size-매크로-py_type-and-py_size-macros"><a href="#py_type-및-py_size-매크로-py_type-and-py_size-macros"><code>Py_TYPE()</code> 및 <code>Py_SIZE()</code> 매크로 (Py_TYPE() and Py_SIZE() macros)</a></h4>
<p>2020년 5월, <code>Py_TYPE()</code> 및 <code>Py_SIZE()</code> 매크로는 좌변값으로 사용하는 것을 금지하도록 수정되었습니다.
2020년 11월, 너무 많은 서드파티 프로젝트를 깨뜨렸기 때문에 변경 사항이 되돌려졌습니다.
2021년 6월, 대부분의 서드파티 프로젝트가 업데이트된 후 두 번째 시도가 있었으나, Windows에서 <code>test_exceptions</code>를 깨뜨렸기 때문에 다시 되돌려져야 했습니다.
2021년 9월, <code>test_exceptions</code>가 수정된 후 <code>Py_TYPE()</code> 및 <code>Py_SIZE()</code>가 최종적으로 변경되었습니다.
2021년 11월, 이 하위 호환성 없는 변경은 스티어링 카운실 예외를 얻었습니다.
2022년 10월, Python 3.11은 <code>Py_TYPE()</code> 및 <code>Py_SIZE()</code>의 비호환성 변경 사항과 함께 출시되었습니다.</p>
<h3 id="하위-호환성-backwards-compatibility"><a href="#하위-호환성-backwards-compatibility">하위 호환성 (Backwards Compatibility)</a></h3>
<p>제안된 C API 변경 사항은 의도적으로 하위 호환성이 없습니다.
실제로 <code>Py_TYPE()</code> 및 <code>Py_SIZE()</code> 매크로만 좌변값으로 사용됩니다.
이 변경 사항은 PEP 387의 비권장(deprecation) 프로세스를 따르지 않습니다. 매크로가 좌변값으로 사용될 때만 비권장 경고를 발행하고 다른 방식으로 사용될 때는 경고를 발행하지 않는 알려진 방법이 없기 때문입니다.</p>
<p><code>PyDescr_NAME()</code>, <code>PyDescr_TYPE()</code>, <code>PyList_GET_ITEM()</code>, <code>PyTuple_GET_ITEM()</code>의 4개 매크로는 영향을 받는 프로젝트의 수를 줄이기 위해 변경되지 않습니다.</p>
<h3 id="통계-statistics"><a href="#통계-statistics">통계 (Statistics)</a></h3>
<p>총 34개의 프로젝트(PyPI 및 PyPI 외)가 이 PEP의 영향을 받는 것으로 알려져 있습니다.</p>
<ul>
<li>16개 프로젝트(47%)는 이미 수정되었습니다.</li>
<li>18개 프로젝트(53%)는 아직 수정되지 않았습니다 (수정 대기 중이거나 Cython 코드를 재생성해야 함).</li>
</ul>
<p>2022년 9월 1일 기준으로, 이 PEP는 PyPI 상위 5000개 프로젝트 중 18개 프로젝트(0.4%)에 영향을 미칩니다.</p>
<ul>
<li>15개 프로젝트(0.3%)는 Cython 코드를 재생성해야 합니다.</li>
<li>3개 프로젝트(0.1%)는 수정 대기 중입니다.</li>
</ul>
<h4 id="pypi-상위-5000개-top-5000-pypi"><a href="#pypi-상위-5000개-top-5000-pypi">PyPI 상위 5000개 (Top 5000 PyPI)</a></h4>
<p>수정 대기 중인 프로젝트 (3개): <code>datatable</code>, <code>guppy3</code>, <code>scipy</code>.
수정 사항이 릴리스된 프로젝트 (12개): <code>bitarray</code>, <code>Cython</code>, <code>immutables</code>, <code>mercurial</code>, <code>mypy</code>, <code>numpy</code>, <code>pycurl</code>, <code>PyGObject</code>, <code>pyside2</code>, <code>python-snappy</code>, <code>recordclass</code>, <code>zstd</code>.</p>
<p>이 PEP의 영향을 받는 두 개의 백포트(backport) 프로젝트도 있습니다: <code>pickle5</code>, <code>pysha3</code>. 이들은 Python 3.11에서는 사용하면 안 됩니다.</p>
<h4 id="기타-영향-받는-프로젝트-other-affected-projects"><a href="#기타-영향-받는-프로젝트-other-affected-projects">기타 영향 받는 프로젝트 (Other affected projects)</a></h4>
<p>수정 사항이 릴리스된 기타 프로젝트 (4개): <code>boost</code>, <code>breezy</code>, <code>duplicity</code>, <code>gobject-introspection</code>.</p>
<h3 id="hpy-프로젝트와의-관계-relationship-with-the-hpy-project"><a href="#hpy-프로젝트와의-관계-relationship-with-the-hpy-project">HPy 프로젝트와의 관계 (Relationship with the HPy project)</a></h3>
<h4 id="hpy-프로젝트-the-hpy-project"><a href="#hpy-프로젝트-the-hpy-project">HPy 프로젝트 (The HPy project)</a></h4>
<p>HPy 프로젝트는 포팅을 쉽게 하고 기존 API만큼 성능을 내기 위해 원래 API와 유사한 C API를 제공하는 것을 목표로 합니다. 동시에 HPy는 구현 세부 사항을 노출하지 않는 "C 확장 API"로서 충분히 분리되어 있습니다. 이 속성을 보장하기 위해 HPy 프로젝트는 CPython, PyPy, GraalVM Python을 위해 모든 것을 병렬로 개발하려고 노력합니다.</p>
<p>HPy는 아직 빠르게 발전하고 있습니다. NumPy를 마이그레이션하는 동안에도 문제가 해결되고 있으며, Cython에 HPy 지원을 추가하는 작업이 시작되었습니다. <code>pybind11</code>에 대한 작업도 곧 시작될 예정입니다.</p>
<p>장기적으로 HPy 프로젝트는 Python C 확장 모듈을 작성하기 위한 권장 API가 되기를 원합니다. HPy 프로젝트는 장기적으로 좋은 솔루션이며, Python 외부에서 개발되며 C API 변경이 필요 없다는 장점이 있습니다.</p>
<h4 id="c-api는-몇-년-더-유지될-것입니다-the-c-api-is-here-to-stay-for-a-few-more-years"><a href="#c-api는-몇-년-더-유지될-것입니다-the-c-api-is-here-to-stay-for-a-few-more-years">C API는 몇 년 더 유지될 것입니다 (The C API is here to stay for a few more years)</a></h4>
<p>HPy에 대한 첫 번째 우려는 현재 HPy가 성숙하지 않고 널리 사용되지 않으며, CPython은 HPy로 곧 포팅될 것 같지 않은 많은 C 확장 모듈을 계속 지원해야 한다는 것입니다.
두 번째 우려는 새로운 최적화를 구현하기 위해 CPython 내부를 발전시킬 수 없다는 점과 PyPy, GraalPython 등에서 현재 C API의 비효율적인 구현입니다. 안타깝게도 HPy는 대부분의 C 확장 모듈이 HPy로 완전히 포팅되어 "레거시" Python C API를 버리는 것을 고려하는 것이 합리적일 때만 이러한 문제를 해결할 것입니다.</p>
<p>C 확장 모듈을 HPy로 포팅하는 것은 CPython에서 점진적으로 수행할 수 있지만, 많은 코드를 수정해야 하고 시간이 걸립니다. 대부분의 C 확장 모듈을 HPy로 포팅하는 데는 몇 년이 걸릴 것으로 예상됩니다.
이 PEP는 실제 문제를 야기하는 것으로 명확하게 식별된 문제, 즉 좌변값으로 사용되는 매크로를 수정하여 C API를 "덜 나쁘게" 만드는 것을 제안합니다. 이 PEP는 소수의 C 확장 모듈만 업데이트하면 되며, 일반적으로 영향을 받는 확장 모듈에서는 몇 줄만 변경하면 됩니다.</p>
<p>예를 들어, NumPy 1.22는 307,300줄의 C 코드로 구성되어 있으며, 이 PEP에 NumPy를 적용하는 데 단 11줄만 수정(Py_SET_TYPE 및 Py_SET_SIZE 사용)하고 4줄을 추가(Python 3.8 이하 버전을 위해 Py_SET_TYPE 및 Py_SET_SIZE 정의)했습니다. HPy로 NumPy를 포팅하는 초기 단계에서는 이미 이보다 더 많은 줄을 수정해야 했습니다.
현재로서는 어떤 접근 방식이 최선인지 예측하기 어렵습니다. 현재 C API를 수정하는 것인지, 아니면 HPy에 집중하는 것인지 말입니다. HPy에만 집중하는 것은 위험할 수 있습니다.</p>
<h3 id="거부된-아이디어-매크로를-그대로-두기-rejected-idea-leave-the-macros-as-they-are"><a href="#거부된-아이디어-매크로를-그대로-두기-rejected-idea-leave-the-macros-as-they-are">거부된 아이디어: 매크로를 그대로 두기 (Rejected Idea: Leave the macros as they are)</a></h3>
<p>각 함수의 문서는 개발자들이 Python 객체를 수정하기 위해 매크로를 사용하는 것을 막을 수 있습니다.
만약 할당이 필요하다면, setter 함수를 추가하고 매크로 문서에서 setter 함수를 사용하도록 요구할 수 있습니다. 예를 들어, <code>Py_SET_TYPE()</code> 함수는 Python 3.9에 추가되었고 <code>Py_TYPE()</code> 문서는 이제 객체 타입을 설정하기 위해 <code>Py_SET_TYPE()</code> 함수를 사용하도록 요구합니다.
개발자가 매크로를 좌변값으로 사용하고 코드가 깨지면 이는 개발자의 책임이지 Python의 책임이 아닙니다. 우리는 '동의하는 성인' 원칙(consenting adults principle)에 따라 작동합니다. Python C API 사용자는 문서에 따라 이를 사용하고, 그렇지 않을 경우 문제가 발생하면 그 결과에 대한 책임을 져야 한다고 예상합니다.</p>
<p>이 아이디어는 소수의 개발자만이 문서를 읽고, 소수만이 Python C API 문서의 변경 사항을 추적하기 때문에 거부되었습니다. 대부분의 개발자는 CPython만 사용하므로 다른 Python 구현과의 호환성 문제를 알지 못합니다.
게다가, 매크로를 좌변값으로 계속 사용하는 것을 허용하는 것은 HPy 프로젝트에 도움이 되지 않으며, GraalVM의 Python 구현에 매크로를 에뮬레이션하는 부담을 남깁니다.</p>
<h4 id="이미-수정된-매크로-macros-already-modified"><a href="#이미-수정된-매크로-macros-already-modified">이미 수정된 매크로 (Macros already modified)</a></h4>
<p>다음 C API 매크로들은 이미 좌변값으로 사용하는 것을 금지하도록 수정되었습니다.
<code>PyCell_SET()</code>, <code>PyList_SET_ITEM()</code>, <code>PyTuple_SET_ITEM()</code>, <code>Py_REFCNT()</code> (Python 3.10), <code>_PyGCHead_SET_FINALIZED()</code>, <code>_PyGCHead_SET_NEXT()</code>, <code>asdl_seq_GET()</code>, <code>asdl_seq_GET_UNTYPED()</code>, <code>asdl_seq_LEN()</code>, <code>asdl_seq_SET()</code>, <code>asdl_seq_SET_UNTYPED()</code>.
예를 들어, <code>PyList_SET_ITEM(list, 0, item) &#x3C; 0</code>은 예상대로 컴파일러 오류를 발생시킵니다.</p>
<blockquote>
<p>⚠️ <strong>알림:</strong> 이 문서는 AI를 활용하여 번역되었으며, 기술적 정확성을 보장하지 않습니다. 정확한 내용은 반드시 원문을 확인하시기 바랍니다.</p>
</blockquote>
</div></div><footer class="page__meta mt-8"><div class="page__taxonomy"><span class="text-sm font-medium text-gray-900 mb-2 block">태그</span><a class="page__taxonomy-item" href="/tags/Python">#<!-- -->Python</a><a class="page__taxonomy-item" href="/tags/PEP">#<!-- -->PEP</a><a class="page__taxonomy-item" href="/tags/Translation">#<!-- -->Translation</a></div></footer><section class="comments-section mt-12 pt-8 border-t border-gray-200"></section><section class="mt-12 border-t border-gray-200 pt-8"><h3 class="text-base font-semibold text-gray-900 mb-4">Python<!-- --> 의 다른글</h3><ul class="space-y-2 text-sm"><li class="text-gray-500">이전글<!-- --> <a class="text-gray-500 hover:text-gray-700 underline decoration-dotted underline-offset-4" href="/python/pep/673">[Final] PEP 673 - Self Type</a></li><li class="text-gray-900 font-semibold">현재글 : <!-- -->[Deferred] PEP 674 - Disallow using macros as l-values</li><li class="text-gray-500">다음글<!-- --> <a class="text-gray-500 hover:text-gray-700 underline decoration-dotted underline-offset-4" href="/python/pep/675">[Final] PEP 675 - Arbitrary Literal String Type</a></li></ul></section></article></div></div><!--/$--></main><div id="footer" class="page__footer"><footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><div class="text-center text-gray-500 text-sm"><p>© <!-- -->2026<!-- --> secrett2633. All rights reserved.</p></div></footer></div></div><script src="/_next/static/chunks/webpack-90b03762f46d1ba4.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/ddc331716d5e47a2.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[5751,[],\"\"]\n6:I[9275,[],\"\"]\n8:I[1343,[],\"\"]\n9:I[9157,[\"231\",\"static/chunks/231-467e37449c5a68fc.js\",\"185\",\"static/chunks/app/layout-b0a450f8e4964582.js\"],\"default\"]\na:I[231,[\"231\",\"static/chunks/231-467e37449c5a68fc.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-1f60377561abdb46.js\"],\"\"]\nb:I[4080,[\"231\",\"static/chunks/231-467e37449c5a68fc.js\",\"185\",\"static/chunks/app/layout-b0a450f8e4964582.js\"],\"\"]\nd:I[6130,[],\"\"]\n7:[\"slug\",\"python/pep/674\",\"c\"]\ne:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/ddc331716d5e47a2.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"WcxaIiCPz9cbpnkGvOjOK\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/python/pep/674\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"python/pep/674\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"python\\\",\\\"pep\\\",\\\"674\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"python/pep/674\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L4\",\"$L5\"],null],null]},[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$7\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"ko\",\"className\":\"no-js\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#ffc40d\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"#ffffff\"}],[\"$\",\"link\",null,{\"rel\":\"dns-prefetch\",\"href\":\"https://www.googletagmanager.com\"}],[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://www.googletagmanager.com\",\"crossOrigin\":\"anonymous\"}],[\"$\",\"link\",null,{\"rel\":\"dns-prefetch\",\"href\":\"https://giscus.app\"}],[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://giscus.app\",\"crossOrigin\":\"anonymous\"}],[\"$\",\"meta\",null,{\"httpEquiv\":\"X-Content-Type-Options\",\"content\":\"nosniff\"}],[\"$\",\"meta\",null,{\"name\":\"referrer\",\"content\":\"strict-origin-when-cross-origin\"}],[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"WebSite\\\",\\\"name\\\":\\\"secrett2633's blog\\\",\\\"url\\\":\\\"https://blog.secrett2633.cloud\\\",\\\"description\\\":\\\"기술 블로그 - Django, Python, DevOps, AI/ML 관련 포스트\\\",\\\"inLanguage\\\":\\\"ko\\\",\\\"publisher\\\":{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"secrett2633\\\",\\\"url\\\":\\\"https://blog.secrett2633.cloud\\\"}}\"}}],[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"secrett2633\\\",\\\"url\\\":\\\"https://blog.secrett2633.cloud\\\",\\\"sameAs\\\":[\\\"https://github.com/secrett2633\\\"]}\"}}]]}],[\"$\",\"body\",null,{\"className\":\"__className_f367f3 layout--default\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#main-content\",\"className\":\"sr-only focus:not-sr-only focus:absolute focus:z-50 focus:p-4 focus:bg-white focus:text-blue-600\",\"children\":\"본문으로 건너뛰기\"}],[\"$\",\"div\",null,{\"className\":\"min-h-screen bg-gray-50\",\"children\":[[\"$\",\"$L9\",null,{}],[\"$\",\"main\",null,{\"id\":\"main-content\",\"className\":\"initial-content\",\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"min-h-screen flex items-center justify-center bg-gray-50\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-md w-full bg-white rounded-lg shadow-md p-8 text-center\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-6xl font-bold text-primary-600 mb-4\",\"children\":\"404\"}],[\"$\",\"h2\",null,{\"className\":\"text-2xl font-semibold text-gray-900 mb-4\",\"children\":\"페이지를 찾을 수 없습니다\"}],[\"$\",\"p\",null,{\"className\":\"text-gray-600 mb-8\",\"children\":\"요청하신 페이지가 존재하지 않거나 이동되었을 수 있습니다.\"}],[\"$\",\"$La\",null,{\"href\":\"/\",\"className\":\"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors\",\"children\":\"홈으로 돌아가기\"}]]}]}],\"notFoundStyles\":[],\"styles\":null}]}],[\"$\",\"div\",null,{\"id\":\"footer\",\"className\":\"page__footer\",\"children\":[\"$\",\"footer\",null,{\"className\":\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"text-center text-gray-500 text-sm\",\"children\":[\"$\",\"p\",null,{\"children\":[\"© \",2026,\" secrett2633. All rights reserved.\"]}]}]}]}]]}],[\"$\",\"$Lb\",null,{\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-NE2W3CFPNY\",\"strategy\":\"afterInteractive\"}],[\"$\",\"$Lb\",null,{\"id\":\"gtag-init\",\"strategy\":\"afterInteractive\",\"children\":\"window.dataLayer = window.dataLayer || [];\\n            function gtag(){dataLayer.push(arguments);}\\n            gtag('js', new Date());\\n            gtag('config', 'G-NE2W3CFPNY');\"}]]}]]}],null],[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-center min-h-screen\",\"role\":\"status\",\"aria-label\":\"로딩 중\",\"children\":[[\"$\",\"div\",null,{\"className\":\"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600\"}],[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"로딩 중...\"}]]}],[],[]]],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Lc\"],\"globalErrorComponent\":\"$d\",\"missingSlots\":\"$We\"}]]\n"])</script><script>self.__next_f.push([1,"10:I[646,[\"231\",\"static/chunks/231-467e37449c5a68fc.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-1f60377561abdb46.js\"],\"default\"]\nf:T519b,"])</script><script>self.__next_f.push([1,"\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e원문 링크:\u003c/strong\u003e \u003ca href=\"https://peps.python.org/pep-0674/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ePEP 674 - Disallow using macros as l-values\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e상태:\u003c/strong\u003e Deferred | \u003cstrong\u003e유형:\u003c/strong\u003e Standards Track | \u003cstrong\u003e작성일:\u003c/strong\u003e 30-Nov-2021\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"pep-674-매크로를-좌변값l-value으로-사용하는-것을-금지\"\u003e\u003ca href=\"#pep-674-매크로를-좌변값l-value으로-사용하는-것을-금지\"\u003ePEP 674 – 매크로를 좌변값(l-value)으로 사용하는 것을 금지\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"초록-abstract\"\u003e\u003ca href=\"#초록-abstract\"\u003e초록 (Abstract)\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e이 PEP는 C API에서 매크로를 좌변값(l-value)으로 사용하는 것을 금지하는 것을 제안합니다. 예를 들어, \u003ccode\u003ePy_TYPE(obj) = new_type\u003c/code\u003e과 같은 코드는 이제 컴파일러 오류를 발생시킵니다.\u003c/p\u003e\n\u003cp\u003e실제로는 대부분의 영향을 받는 프로젝트에서 단 두 가지만 변경하면 됩니다.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ePy_TYPE(obj) = new_type\u003c/code\u003e을 \u003ccode\u003ePy_SET_TYPE(obj, new_type)\u003c/code\u003e으로 교체합니다.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ePy_SIZE(obj) = new_size\u003c/code\u003e를 \u003ccode\u003ePy_SET_SIZE(obj, new_size)\u003c/code\u003e로 교체합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"pep-연기-pep-deferral\"\u003e\u003ca href=\"#pep-연기-pep-deferral\"\u003ePEP 연기 (PEP Deferral)\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e이 PEP는 2022년 2월에 스티어링 카운실(Steering Council)의 결정에 따라 연기되었습니다.\u003c/p\u003e\n\u003ch3 id=\"도입-배경-rationale\"\u003e\u003ca href=\"#도입-배경-rationale\"\u003e도입 배경 (Rationale)\u003c/a\u003e\u003c/h3\u003e\n\u003ch4 id=\"매크로를-좌변값으로-사용하기-using-a-macro-as-an-l-value\"\u003e\u003ca href=\"#매크로를-좌변값으로-사용하기-using-a-macro-as-an-l-value\"\u003e매크로를 좌변값으로 사용하기 (Using a macro as an l-value)\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003ePython C API에서 일부 함수는 일반 함수보다 매크로로 작성하는 것이 더 간단하기 때문에 매크로로 구현됩니다. 매크로가 구조체 멤버를 직접 노출하는 경우, 기술적으로 이 매크로를 사용하여 구조체 멤버를 가져올 뿐만 아니라 설정하는 것도 가능합니다.\u003c/p\u003e\n\u003cp\u003e예를 들어, Python 3.10의 \u003ccode\u003ePy_TYPE()\u003c/code\u003e 매크로는 다음과 같습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-c\"\u003e#define Py_TYPE(ob) (((PyObject *)(ob))-\u003eob_type)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 매크로는 객체의 타입을 얻기 위한 우변값(r-value)으로 사용될 수 있습니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-c\"\u003etype = Py_TYPE(object);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e또한, 객체의 타입을 설정하기 위한 좌변값(l-value)으로도 사용될 수 있습니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-c\"\u003ePy_TYPE(object) = new_type;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ePy_REFCNT()\u003c/code\u003e 및 \u003ccode\u003ePy_SIZE()\u003c/code\u003e 매크로를 사용하여 객체의 참조 카운트와 객체 크기를 설정하는 것도 가능합니다.\u003c/p\u003e\n\u003cp\u003e객체 속성을 직접 설정하는 것은 현재의 정확한 CPython 구현에 의존합니다. 이 기능을 다른 Python 구현에서 구현하면 C API 구현의 효율성이 떨어질 수 있습니다.\u003c/p\u003e\n\u003ch4 id=\"cpython-nogil-포크-cpython-nogil-fork\"\u003e\u003ca href=\"#cpython-nogil-포크-cpython-nogil-fork\"\u003eCPython nogil 포크 (CPython nogil fork)\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eSam Gross는 GIL(Global Interpreter Lock)을 제거하기 위해 Python 3.9를 포크(fork)하여 \u003ccode\u003enogil\u003c/code\u003e 브랜치를 만들었습니다. 이 포크에는 \u003ccode\u003ePyObject.ob_refcnt\u003c/code\u003e 멤버가 없지만, 참조 카운팅을 위한 더 정교한 구현이 있어서 \u003ccode\u003ePy_REFCNT(obj) = new_refcnt;\u003c/code\u003e 코드는 컴파일러 오류를 발생시킵니다.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003enogil\u003c/code\u003e 포크를 CPython 메인 브랜치에 병합하려면 먼저 이 C API 호환성 문제를 해결해야 합니다. 이는 C API로 인해 간접적으로 차단된 Python 최적화의 구체적인 예입니다.\n\u003ccode\u003ePy_REFCNT()\u003c/code\u003e 매크로는 이미 Python 3.10에서 좌변값으로 사용되지 않도록 수정되었습니다.\u003c/p\u003e\n\u003ch4 id=\"hpy-프로젝트-hpy-project\"\u003e\u003ca href=\"#hpy-프로젝트-hpy-project\"\u003eHPy 프로젝트 (HPy project)\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eHPy 프로젝트는 핸들과 함수 호출만 사용하는 새로운 Python용 C API입니다. 핸들은 불투명하며, 구조체 멤버에 직접 접근할 수 없고, 포인터를 역참조할 수 없습니다.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ePy_SIZE()\u003c/code\u003e와 같은 매크로의 이상한 사용법을 찾아 바꾸는 것보다 \u003ccode\u003ePy_SET_SIZE()\u003c/code\u003e를 찾아 바꾸는 것이 더 쉽고 안전합니다. \u003ccode\u003ePy_SIZE()\u003c/code\u003e는 \u003ccode\u003eHPy_Length()\u003c/code\u003e로 반자동으로 교체될 수 있지만, \u003ccode\u003ePy_SET_SIZE()\u003c/code\u003e를 보면 코드를 HPy로 포팅하기 위해 더 큰 변경(예: \u003ccode\u003eHPyTupleBuilder\u003c/code\u003e 또는 \u003ccode\u003eHPyListBuilder\u003c/code\u003e 사용)이 필요하다는 것을 즉시 알 수 있습니다.\n매크로를 통해 노출되는 내부 세부 사항이 적을수록 HPy가 직접적인 동등물을 제공하기 쉬워집니다. \"비공개\" 인터페이스를 참조하는 모든 매크로는 해당 인터페이스를 사실상 공개적으로 노출합니다.\u003c/p\u003e\n\u003ch4 id=\"graalvm-python\"\u003e\u003ca href=\"#graalvm-python\"\u003eGraalVM Python\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eGraalVM에서 Python 객체가 Python C API에 의해 접근될 때, C API 에뮬레이션 계층은 GraalVM 객체를 CPython 구조체(PyObject, PyLongObject, PyTypeObject 등)의 내부 구조를 노출하는 래퍼(wrapper)로 감싸야 합니다. 이는 C 코드가 직접 또는 매크로를 통해 접근할 때, GraalVM이 가로챌 수 있는 것은 구조체 오프셋에서의 읽기뿐이며, 이를 GraalVM의 표현으로 다시 매핑해야 하기 때문입니다. 매크로를 함수로 대체하여 노출되는 구조체 멤버의 \"실제\" 수가 적을수록 GraalVM 래퍼가 더 간단해질 수 있습니다.\n이 PEP만으로는 GraalVM의 래퍼를 제거하기에 충분하지 않지만, 장기적인 목표를 향한 한 걸음입니다. GraalVM은 이미 장기적으로 더 나은 솔루션인 HPy를 지원합니다.\u003c/p\u003e\n\u003ch3 id=\"명세-specification\"\u003e\u003ca href=\"#명세-specification\"\u003e명세 (Specification)\u003c/a\u003e\u003c/h3\u003e\n\u003ch4 id=\"매크로를-좌변값으로-사용하는-것을-금지-disallow-using-macros-as-l-values\"\u003e\u003ca href=\"#매크로를-좌변값으로-사용하는-것을-금지-disallow-using-macros-as-l-values\"\u003e매크로를 좌변값으로 사용하는 것을 금지 (Disallow using macros as l-values)\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e다음 65개 매크로는 좌변값으로 사용하는 것을 금지하도록 수정됩니다.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ePyObject\u003c/code\u003e 및 \u003ccode\u003ePyVarObject\u003c/code\u003e 매크로:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ePy_TYPE()\u003c/code\u003e: 대신 \u003ccode\u003ePy_SET_TYPE()\u003c/code\u003e을 사용해야 합니다.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ePy_SIZE()\u003c/code\u003e: 대신 \u003ccode\u003ePy_SET_SIZE()\u003c/code\u003e를 사용해야 합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eGET\u003c/code\u003e 매크로:\u003c/strong\u003e \u003ccode\u003ePyByteArray_GET_SIZE()\u003c/code\u003e, \u003ccode\u003ePyBytes_GET_SIZE()\u003c/code\u003e, \u003ccode\u003ePyCFunction_GET_CLASS()\u003c/code\u003e 등 다수의 \u003ccode\u003eGET\u003c/code\u003e 매크로가 포함됩니다.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eAS\u003c/code\u003e 매크로:\u003c/strong\u003e \u003ccode\u003ePyByteArray_AS_STRING()\u003c/code\u003e, \u003ccode\u003ePyBytes_AS_STRING()\u003c/code\u003e, \u003ccode\u003ePyFloat_AS_DOUBLE()\u003c/code\u003e 등.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ePyUnicode\u003c/code\u003e 매크로:\u003c/strong\u003e \u003ccode\u003ePyUnicode_1BYTE_DATA()\u003c/code\u003e, \u003ccode\u003ePyUnicode_2BYTE_DATA()\u003c/code\u003e, \u003ccode\u003ePyUnicode_4BYTE_DATA()\u003c/code\u003e 등.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ePyDateTime GET\u003c/code\u003e 매크로:\u003c/strong\u003e \u003ccode\u003ePyDateTime_DATE_GET_FOLD()\u003c/code\u003e, \u003ccode\u003ePyDateTime_DATE_GET_HOUR()\u003c/code\u003e 등 다수의 \u003ccode\u003eGET\u003c/code\u003e 매크로가 포함됩니다.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"c-확장-모듈을-python-311로-포팅-port-c-extensions-to-python-311\"\u003e\u003ca href=\"#c-확장-모듈을-python-311로-포팅-port-c-extensions-to-python-311\"\u003eC 확장 모듈을 Python 3.11로 포팅 (Port C extensions to Python 3.11)\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e실제로 이 PEP의 영향을 받는 대부분의 프로젝트는 단 두 가지만 변경하면 됩니다.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ePy_TYPE(obj) = new_type\u003c/code\u003e을 \u003ccode\u003ePy_SET_TYPE(obj, new_type)\u003c/code\u003e으로 교체합니다.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ePy_SIZE(obj) = new_size\u003c/code\u003e를 \u003ccode\u003ePy_SET_SIZE(obj, new_size)\u003c/code\u003e로 교체합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ccode\u003epythoncapi_compat\u003c/code\u003e 프로젝트를 사용하여 C 확장 모듈을 자동으로 업데이트할 수 있습니다. 이 프로젝트는 Python 3.8 이하 버전을 지원하면서 Python 3.11 지원을 추가할 수 있도록 \u003ccode\u003ePy_SET_REFCNT()\u003c/code\u003e, \u003ccode\u003ePy_SET_TYPE()\u003c/code\u003e, \u003ccode\u003ePy_SET_SIZE()\u003c/code\u003e 함수를 제공하는 헤더 파일을 제공합니다.\u003c/p\u003e\n\u003ch4 id=\"pytuple_get_item-및-pylist_get_item은-변경되지-않음-pytuple_get_item-and-pylist_get_item-are-left-unchanged\"\u003e\u003ca href=\"#pytuple_get_item-및-pylist_get_item은-변경되지-않음-pytuple_get_item-and-pylist_get_item-are-left-unchanged\"\u003e\u003ccode\u003ePyTuple_GET_ITEM()\u003c/code\u003e 및 \u003ccode\u003ePyList_GET_ITEM()\u003c/code\u003e은 변경되지 않음 (PyTuple_GET_ITEM() and PyList_GET_ITEM() are left unchanged)\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003ePyTuple_GET_ITEM()\u003c/code\u003e 및 \u003ccode\u003ePyList_GET_ITEM()\u003c/code\u003e 매크로는 변경되지 않습니다. \u003ccode\u003e\u0026#x26;PyTuple_GET_ITEM(tuple, 0)\u003c/code\u003e 및 \u003ccode\u003e\u0026#x26;PyList_GET_ITEM(list, 0)\u003c/code\u003e 코드 패턴은 여전히 내부 \u003ccode\u003ePyObject**\u003c/code\u003e 배열에 접근하기 위해 일반적으로 사용됩니다. 이 매크로들을 변경하는 것은 이 PEP의 범위를 벗어납니다.\u003c/p\u003e\n\u003ch4 id=\"pydescr_name-및-pydescr_type은-변경되지-않음-pydescr_name-and-pydescr_type-are-left-unchanged\"\u003e\u003ca href=\"#pydescr_name-및-pydescr_type은-변경되지-않음-pydescr_name-and-pydescr_type-are-left-unchanged\"\u003e\u003ccode\u003ePyDescr_NAME()\u003c/code\u003e 및 \u003ccode\u003ePyDescr_TYPE()\u003c/code\u003e은 변경되지 않음 (PyDescr_NAME() and PyDescr_TYPE() are left unchanged)\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003ePyDescr_NAME()\u003c/code\u003e 및 \u003ccode\u003ePyDescr_TYPE()\u003c/code\u003e 매크로는 변경되지 않습니다. 이 매크로들은 \u003ccode\u003ePyDescrObject.d_name\u003c/code\u003e 및 \u003ccode\u003ePyDescrObject.d_type\u003c/code\u003e 멤버에 접근을 제공하며, 이 멤버들을 설정하기 위한 좌변값으로 사용될 수 있습니다.\nSWIG 프로젝트는 이 매크로들을 좌변값으로 사용하여 이 멤버들을 설정합니다. \u003ccode\u003ePyDescrObject\u003c/code\u003e 구조체는 성능에 중요하지 않고 곧 변경될 가능성이 적으므로 SWIG를 수정하여 \u003ccode\u003ePyDescrObject\u003c/code\u003e 구조체 멤버를 직접 설정하는 것을 방지하는 것은 그리 가치 있는 일이 아닙니다.\u003c/p\u003e\n\u003ch3 id=\"구현-implementation\"\u003e\u003ca href=\"#구현-implementation\"\u003e구현 (Implementation)\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e구현은 bpo-45476: [C API] PEP 674: Disallow using macros as l-values에서 추적됩니다.\u003c/p\u003e\n\u003ch4 id=\"py_type-및-py_size-매크로-py_type-and-py_size-macros\"\u003e\u003ca href=\"#py_type-및-py_size-매크로-py_type-and-py_size-macros\"\u003e\u003ccode\u003ePy_TYPE()\u003c/code\u003e 및 \u003ccode\u003ePy_SIZE()\u003c/code\u003e 매크로 (Py_TYPE() and Py_SIZE() macros)\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e2020년 5월, \u003ccode\u003ePy_TYPE()\u003c/code\u003e 및 \u003ccode\u003ePy_SIZE()\u003c/code\u003e 매크로는 좌변값으로 사용하는 것을 금지하도록 수정되었습니다.\n2020년 11월, 너무 많은 서드파티 프로젝트를 깨뜨렸기 때문에 변경 사항이 되돌려졌습니다.\n2021년 6월, 대부분의 서드파티 프로젝트가 업데이트된 후 두 번째 시도가 있었으나, Windows에서 \u003ccode\u003etest_exceptions\u003c/code\u003e를 깨뜨렸기 때문에 다시 되돌려져야 했습니다.\n2021년 9월, \u003ccode\u003etest_exceptions\u003c/code\u003e가 수정된 후 \u003ccode\u003ePy_TYPE()\u003c/code\u003e 및 \u003ccode\u003ePy_SIZE()\u003c/code\u003e가 최종적으로 변경되었습니다.\n2021년 11월, 이 하위 호환성 없는 변경은 스티어링 카운실 예외를 얻었습니다.\n2022년 10월, Python 3.11은 \u003ccode\u003ePy_TYPE()\u003c/code\u003e 및 \u003ccode\u003ePy_SIZE()\u003c/code\u003e의 비호환성 변경 사항과 함께 출시되었습니다.\u003c/p\u003e\n\u003ch3 id=\"하위-호환성-backwards-compatibility\"\u003e\u003ca href=\"#하위-호환성-backwards-compatibility\"\u003e하위 호환성 (Backwards Compatibility)\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e제안된 C API 변경 사항은 의도적으로 하위 호환성이 없습니다.\n실제로 \u003ccode\u003ePy_TYPE()\u003c/code\u003e 및 \u003ccode\u003ePy_SIZE()\u003c/code\u003e 매크로만 좌변값으로 사용됩니다.\n이 변경 사항은 PEP 387의 비권장(deprecation) 프로세스를 따르지 않습니다. 매크로가 좌변값으로 사용될 때만 비권장 경고를 발행하고 다른 방식으로 사용될 때는 경고를 발행하지 않는 알려진 방법이 없기 때문입니다.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ePyDescr_NAME()\u003c/code\u003e, \u003ccode\u003ePyDescr_TYPE()\u003c/code\u003e, \u003ccode\u003ePyList_GET_ITEM()\u003c/code\u003e, \u003ccode\u003ePyTuple_GET_ITEM()\u003c/code\u003e의 4개 매크로는 영향을 받는 프로젝트의 수를 줄이기 위해 변경되지 않습니다.\u003c/p\u003e\n\u003ch3 id=\"통계-statistics\"\u003e\u003ca href=\"#통계-statistics\"\u003e통계 (Statistics)\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e총 34개의 프로젝트(PyPI 및 PyPI 외)가 이 PEP의 영향을 받는 것으로 알려져 있습니다.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e16개 프로젝트(47%)는 이미 수정되었습니다.\u003c/li\u003e\n\u003cli\u003e18개 프로젝트(53%)는 아직 수정되지 않았습니다 (수정 대기 중이거나 Cython 코드를 재생성해야 함).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e2022년 9월 1일 기준으로, 이 PEP는 PyPI 상위 5000개 프로젝트 중 18개 프로젝트(0.4%)에 영향을 미칩니다.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e15개 프로젝트(0.3%)는 Cython 코드를 재생성해야 합니다.\u003c/li\u003e\n\u003cli\u003e3개 프로젝트(0.1%)는 수정 대기 중입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"pypi-상위-5000개-top-5000-pypi\"\u003e\u003ca href=\"#pypi-상위-5000개-top-5000-pypi\"\u003ePyPI 상위 5000개 (Top 5000 PyPI)\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e수정 대기 중인 프로젝트 (3개): \u003ccode\u003edatatable\u003c/code\u003e, \u003ccode\u003eguppy3\u003c/code\u003e, \u003ccode\u003escipy\u003c/code\u003e.\n수정 사항이 릴리스된 프로젝트 (12개): \u003ccode\u003ebitarray\u003c/code\u003e, \u003ccode\u003eCython\u003c/code\u003e, \u003ccode\u003eimmutables\u003c/code\u003e, \u003ccode\u003emercurial\u003c/code\u003e, \u003ccode\u003emypy\u003c/code\u003e, \u003ccode\u003enumpy\u003c/code\u003e, \u003ccode\u003epycurl\u003c/code\u003e, \u003ccode\u003ePyGObject\u003c/code\u003e, \u003ccode\u003epyside2\u003c/code\u003e, \u003ccode\u003epython-snappy\u003c/code\u003e, \u003ccode\u003erecordclass\u003c/code\u003e, \u003ccode\u003ezstd\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003e이 PEP의 영향을 받는 두 개의 백포트(backport) 프로젝트도 있습니다: \u003ccode\u003epickle5\u003c/code\u003e, \u003ccode\u003epysha3\u003c/code\u003e. 이들은 Python 3.11에서는 사용하면 안 됩니다.\u003c/p\u003e\n\u003ch4 id=\"기타-영향-받는-프로젝트-other-affected-projects\"\u003e\u003ca href=\"#기타-영향-받는-프로젝트-other-affected-projects\"\u003e기타 영향 받는 프로젝트 (Other affected projects)\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e수정 사항이 릴리스된 기타 프로젝트 (4개): \u003ccode\u003eboost\u003c/code\u003e, \u003ccode\u003ebreezy\u003c/code\u003e, \u003ccode\u003eduplicity\u003c/code\u003e, \u003ccode\u003egobject-introspection\u003c/code\u003e.\u003c/p\u003e\n\u003ch3 id=\"hpy-프로젝트와의-관계-relationship-with-the-hpy-project\"\u003e\u003ca href=\"#hpy-프로젝트와의-관계-relationship-with-the-hpy-project\"\u003eHPy 프로젝트와의 관계 (Relationship with the HPy project)\u003c/a\u003e\u003c/h3\u003e\n\u003ch4 id=\"hpy-프로젝트-the-hpy-project\"\u003e\u003ca href=\"#hpy-프로젝트-the-hpy-project\"\u003eHPy 프로젝트 (The HPy project)\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eHPy 프로젝트는 포팅을 쉽게 하고 기존 API만큼 성능을 내기 위해 원래 API와 유사한 C API를 제공하는 것을 목표로 합니다. 동시에 HPy는 구현 세부 사항을 노출하지 않는 \"C 확장 API\"로서 충분히 분리되어 있습니다. 이 속성을 보장하기 위해 HPy 프로젝트는 CPython, PyPy, GraalVM Python을 위해 모든 것을 병렬로 개발하려고 노력합니다.\u003c/p\u003e\n\u003cp\u003eHPy는 아직 빠르게 발전하고 있습니다. NumPy를 마이그레이션하는 동안에도 문제가 해결되고 있으며, Cython에 HPy 지원을 추가하는 작업이 시작되었습니다. \u003ccode\u003epybind11\u003c/code\u003e에 대한 작업도 곧 시작될 예정입니다.\u003c/p\u003e\n\u003cp\u003e장기적으로 HPy 프로젝트는 Python C 확장 모듈을 작성하기 위한 권장 API가 되기를 원합니다. HPy 프로젝트는 장기적으로 좋은 솔루션이며, Python 외부에서 개발되며 C API 변경이 필요 없다는 장점이 있습니다.\u003c/p\u003e\n\u003ch4 id=\"c-api는-몇-년-더-유지될-것입니다-the-c-api-is-here-to-stay-for-a-few-more-years\"\u003e\u003ca href=\"#c-api는-몇-년-더-유지될-것입니다-the-c-api-is-here-to-stay-for-a-few-more-years\"\u003eC API는 몇 년 더 유지될 것입니다 (The C API is here to stay for a few more years)\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eHPy에 대한 첫 번째 우려는 현재 HPy가 성숙하지 않고 널리 사용되지 않으며, CPython은 HPy로 곧 포팅될 것 같지 않은 많은 C 확장 모듈을 계속 지원해야 한다는 것입니다.\n두 번째 우려는 새로운 최적화를 구현하기 위해 CPython 내부를 발전시킬 수 없다는 점과 PyPy, GraalPython 등에서 현재 C API의 비효율적인 구현입니다. 안타깝게도 HPy는 대부분의 C 확장 모듈이 HPy로 완전히 포팅되어 \"레거시\" Python C API를 버리는 것을 고려하는 것이 합리적일 때만 이러한 문제를 해결할 것입니다.\u003c/p\u003e\n\u003cp\u003eC 확장 모듈을 HPy로 포팅하는 것은 CPython에서 점진적으로 수행할 수 있지만, 많은 코드를 수정해야 하고 시간이 걸립니다. 대부분의 C 확장 모듈을 HPy로 포팅하는 데는 몇 년이 걸릴 것으로 예상됩니다.\n이 PEP는 실제 문제를 야기하는 것으로 명확하게 식별된 문제, 즉 좌변값으로 사용되는 매크로를 수정하여 C API를 \"덜 나쁘게\" 만드는 것을 제안합니다. 이 PEP는 소수의 C 확장 모듈만 업데이트하면 되며, 일반적으로 영향을 받는 확장 모듈에서는 몇 줄만 변경하면 됩니다.\u003c/p\u003e\n\u003cp\u003e예를 들어, NumPy 1.22는 307,300줄의 C 코드로 구성되어 있으며, 이 PEP에 NumPy를 적용하는 데 단 11줄만 수정(Py_SET_TYPE 및 Py_SET_SIZE 사용)하고 4줄을 추가(Python 3.8 이하 버전을 위해 Py_SET_TYPE 및 Py_SET_SIZE 정의)했습니다. HPy로 NumPy를 포팅하는 초기 단계에서는 이미 이보다 더 많은 줄을 수정해야 했습니다.\n현재로서는 어떤 접근 방식이 최선인지 예측하기 어렵습니다. 현재 C API를 수정하는 것인지, 아니면 HPy에 집중하는 것인지 말입니다. HPy에만 집중하는 것은 위험할 수 있습니다.\u003c/p\u003e\n\u003ch3 id=\"거부된-아이디어-매크로를-그대로-두기-rejected-idea-leave-the-macros-as-they-are\"\u003e\u003ca href=\"#거부된-아이디어-매크로를-그대로-두기-rejected-idea-leave-the-macros-as-they-are\"\u003e거부된 아이디어: 매크로를 그대로 두기 (Rejected Idea: Leave the macros as they are)\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e각 함수의 문서는 개발자들이 Python 객체를 수정하기 위해 매크로를 사용하는 것을 막을 수 있습니다.\n만약 할당이 필요하다면, setter 함수를 추가하고 매크로 문서에서 setter 함수를 사용하도록 요구할 수 있습니다. 예를 들어, \u003ccode\u003ePy_SET_TYPE()\u003c/code\u003e 함수는 Python 3.9에 추가되었고 \u003ccode\u003ePy_TYPE()\u003c/code\u003e 문서는 이제 객체 타입을 설정하기 위해 \u003ccode\u003ePy_SET_TYPE()\u003c/code\u003e 함수를 사용하도록 요구합니다.\n개발자가 매크로를 좌변값으로 사용하고 코드가 깨지면 이는 개발자의 책임이지 Python의 책임이 아닙니다. 우리는 '동의하는 성인' 원칙(consenting adults principle)에 따라 작동합니다. Python C API 사용자는 문서에 따라 이를 사용하고, 그렇지 않을 경우 문제가 발생하면 그 결과에 대한 책임을 져야 한다고 예상합니다.\u003c/p\u003e\n\u003cp\u003e이 아이디어는 소수의 개발자만이 문서를 읽고, 소수만이 Python C API 문서의 변경 사항을 추적하기 때문에 거부되었습니다. 대부분의 개발자는 CPython만 사용하므로 다른 Python 구현과의 호환성 문제를 알지 못합니다.\n게다가, 매크로를 좌변값으로 계속 사용하는 것을 허용하는 것은 HPy 프로젝트에 도움이 되지 않으며, GraalVM의 Python 구현에 매크로를 에뮬레이션하는 부담을 남깁니다.\u003c/p\u003e\n\u003ch4 id=\"이미-수정된-매크로-macros-already-modified\"\u003e\u003ca href=\"#이미-수정된-매크로-macros-already-modified\"\u003e이미 수정된 매크로 (Macros already modified)\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e다음 C API 매크로들은 이미 좌변값으로 사용하는 것을 금지하도록 수정되었습니다.\n\u003ccode\u003ePyCell_SET()\u003c/code\u003e, \u003ccode\u003ePyList_SET_ITEM()\u003c/code\u003e, \u003ccode\u003ePyTuple_SET_ITEM()\u003c/code\u003e, \u003ccode\u003ePy_REFCNT()\u003c/code\u003e (Python 3.10), \u003ccode\u003e_PyGCHead_SET_FINALIZED()\u003c/code\u003e, \u003ccode\u003e_PyGCHead_SET_NEXT()\u003c/code\u003e, \u003ccode\u003easdl_seq_GET()\u003c/code\u003e, \u003ccode\u003easdl_seq_GET_UNTYPED()\u003c/code\u003e, \u003ccode\u003easdl_seq_LEN()\u003c/code\u003e, \u003ccode\u003easdl_seq_SET()\u003c/code\u003e, \u003ccode\u003easdl_seq_SET_UNTYPED()\u003c/code\u003e.\n예를 들어, \u003ccode\u003ePyList_SET_ITEM(list, 0, item) \u0026#x3C; 0\u003c/code\u003e은 예상대로 컴파일러 오류를 발생시킵니다.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e⚠️ \u003cstrong\u003e알림:\u003c/strong\u003e 이 문서는 AI를 활용하여 번역되었으며, 기술적 정확성을 보장하지 않습니다. 정확한 내용은 반드시 원문을 확인하시기 바랍니다.\u003c/p\u003e\n\u003c/blockquote\u003e\n"])</script><script>self.__next_f.push([1,"5:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"[Deferred] PEP 674 - Disallow using macros as l-values\\\",\\\"description\\\":\\\"Python Enhancement Proposal 674: 'Disallow using macros as l-values'에 대한 한국어 번역입니다.\\\",\\\"url\\\":\\\"https://blog.secrett2633.cloud/python/pep/674\\\",\\\"datePublished\\\":\\\"2025-09-27T01:07:42.000Z\\\",\\\"dateModified\\\":\\\"2025-09-27T01:07:42.000Z\\\",\\\"author\\\":{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"secrett2633\\\",\\\"url\\\":\\\"https://blog.secrett2633.cloud\\\"},\\\"publisher\\\":{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"secrett2633\\\",\\\"url\\\":\\\"https://blog.secrett2633.cloud\\\"},\\\"mainEntityOfPage\\\":{\\\"@type\\\":\\\"WebPage\\\",\\\"@id\\\":\\\"https://blog.secrett2633.cloud/python/pep/674\\\"},\\\"image\\\":\\\"https://blog.secrett2633.cloud/og-default.png\\\",\\\"isAccessibleForFree\\\":true,\\\"inLanguage\\\":\\\"ko\\\",\\\"wordCount\\\":1505,\\\"articleSection\\\":\\\"Python\\\",\\\"keywords\\\":\\\"Python, PEP, Translation\\\"}\"}}],[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BreadcrumbList\\\",\\\"itemListElement\\\":[{\\\"@type\\\":\\\"ListItem\\\",\\\"position\\\":1,\\\"name\\\":\\\"홈\\\",\\\"item\\\":\\\"https://blog.secrett2633.cloud/\\\"},{\\\"@type\\\":\\\"ListItem\\\",\\\"position\\\":2,\\\"name\\\":\\\"[Deferred] PEP 674 - Disallow using macros as l-values\\\",\\\"item\\\":\\\"https://blog.secrett2633.cloud/python/pep/674\\\"}]}\"}}],[\"$\",\"div\",null,{\"className\":\"flex flex-col lg:flex-row gap-8\",\"children\":[[\"$\",\"aside\",null,{\"className\":\"lg:w-64 xl:w-72 order-1 lg:order-none\",\"children\":[\"$\",\"div\",null,{\"className\":\"sidebar sticky\",\"children\":[\"$\",\"nav\",null,{\"className\":\"space-y-4\",\"aria-label\":\"카테고리 네비게이션\",\"children\":[[\"$\",\"div\",\"Backend\",{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-medium text-gray-900 mb-2\",\"children\":\"Backend\"}],[\"$\",\"ul\",null,{\"className\":\"space-y-1 ml-4\",\"children\":[[\"$\",\"li\",\"Django\",{\"children\":[\"$\",\"$La\",null,{\"href\":\"/backend/django\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Django\",\" (\",6,\")\"]}]}],[\"$\",\"li\",\"Logging\",{\"children\":[\"$\",\"$La\",null,{\"href\":\"/backend/logging\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Logging\",\" (\",1,\")\"]}]}]]}]]}],[\"$\",\"div\",\"Python\",{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-medium text-gray-900 mb-2\",\"children\":\"Python\"}],[\"$\",\"ul\",null,{\"className\":\"space-y-1 ml-4\",\"children\":[[\"$\",\"li\",\"PEP\",{\"children\":[\"$\",\"$La\",null,{\"href\":\"/python/pep\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"PEP\",\" (\",650,\")\"]}]}]]}]]}],[\"$\",\"div\",\"AI/ML\",{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-medium text-gray-900 mb-2\",\"children\":\"AI/ML\"}],[\"$\",\"ul\",null,{\"className\":\"space-y-1 ml-4\",\"children\":[[\"$\",\"li\",\"LLM\",{\"children\":[\"$\",\"$La\",null,{\"href\":\"/ai/llm\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"LLM\",\" (\",1,\")\"]}]}],[\"$\",\"li\",\"Review\",{\"children\":[\"$\",\"$La\",null,{\"href\":\"/ai/review\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Review\",\" (\",2728,\")\"]}]}]]}]]}],[\"$\",\"div\",\"DevOps\",{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-medium text-gray-900 mb-2\",\"children\":\"DevOps\"}],[\"$\",\"ul\",null,{\"className\":\"space-y-1 ml-4\",\"children\":[[\"$\",\"li\",\"Nginx\",{\"children\":[\"$\",\"$La\",null,{\"href\":\"/devops/nginx\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Nginx\",\" (\",1,\")\"]}]}],[\"$\",\"li\",\"Docker\",{\"children\":[\"$\",\"$La\",null,{\"href\":\"/devops/docker\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Docker\",\" (\",1,\")\"]}]}],[\"$\",\"li\",\"SafeLine\",{\"children\":[\"$\",\"$La\",null,{\"href\":\"/devops/safeline\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"SafeLine\",\" (\",1,\")\"]}]}],[\"$\",\"li\",\"Jenkins\",{\"children\":[\"$\",\"$La\",null,{\"href\":\"/devops/jenkins\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Jenkins\",\" (\",3,\")\"]}]}],[\"$\",\"li\",\"GitHub Actions\",{\"children\":[\"$\",\"$La\",null,{\"href\":\"/devops/github-actions\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"GitHub Actions\",\" (\",1,\")\"]}]}],[\"$\",\"li\",\"AWS\",{\"children\":[\"$\",\"$La\",null,{\"href\":\"/devops/aws\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"AWS\",\" (\",1,\")\"]}]}]]}]]}],[\"$\",\"div\",\"etc\",{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-medium text-gray-900 mb-2\",\"children\":\"etc\"}],[\"$\",\"ul\",null,{\"className\":\"space-y-1 ml-4\",\"children\":[[\"$\",\"li\",\"Me\",{\"children\":[\"$\",\"$La\",null,{\"href\":\"/etc/me\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Me\",\" (\",3,\")\"]}]}],[\"$\",\"li\",\"Chrome Extension\",{\"children\":[\"$\",\"$La\",null,{\"href\":\"/etc/chrome-extension\",\"className\":\"text-sm text-gray-600 hover:text-primary-600 block py-1\",\"children\":[\"Chrome Extension\",\" (\",1,\")\"]}]}]]}]]}]]}]}]}],[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[[\"$\",\"nav\",null,{\"aria-label\":\"breadcrumb\",\"className\":\"text-sm text-gray-500 mb-4\",\"children\":[\"$\",\"ol\",null,{\"className\":\"flex flex-wrap items-center gap-1\",\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/\",\"className\":\"hover:text-gray-700\",\"children\":\"홈\"}]}],[[\"$\",\"li\",\"/python/pep/674\",{\"className\":\"flex items-center gap-1\",\"children\":[[\"$\",\"span\",null,{\"aria-hidden\":\"true\",\"children\":\"/\"}],[\"$\",\"span\",null,{\"className\":\"text-gray-900\",\"aria-current\":\"page\",\"children\":\"[Deferred] PEP 674 - Disallow using macros as l-values\"}]]}]]]}]}],[\"$\",\"article\",null,{\"className\":\"page\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"page__title\",\"children\":\"[Deferred] PEP 674 - Disallow using macros as l-values\"}],[\"$\",\"div\",null,{\"className\":\"page__meta\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2025-09-27 10:07:42+0900\",\"children\":\"2025년 9월 27일\"}],[\"$\",\"time\",null,{\"className\":\"ml-4\",\"dateTime\":\"2025-09-27T01:07:42.000Z\",\"children\":[\"수정: \",\"2025년 9월 27일\"]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"page__content\",\"children\":[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$f\"}}]}],[\"$\",\"footer\",null,{\"className\":\"page__meta mt-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"page__taxonomy\",\"children\":[[\"$\",\"span\",null,{\"className\":\"text-sm font-medium text-gray-900 mb-2 block\",\"children\":\"태그\"}],[[\"$\",\"$La\",\"Python\",{\"href\":\"/tags/Python\",\"className\":\"page__taxonomy-item\",\"children\":[\"#\",\"Python\"]}],[\"$\",\"$La\",\"PEP\",{\"href\":\"/tags/PEP\",\"className\":\"page__taxonomy-item\",\"children\":[\"#\",\"PEP\"]}],[\"$\",\"$La\",\"Translation\",{\"href\":\"/tags/Translation\",\"className\":\"page__taxonomy-item\",\"children\":[\"#\",\"Translation\"]}]]]}]}],[\"$\",\"$L10\",null,{\"postPermalink\":\"/python/pep/674\",\"postId\":\"2025-09-27-pep-0674-disallow-using-macros-as-l-values\"}],[\"$\",\"section\",null,{\"className\":\"mt-12 border-t border-gray-200 pt-8\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"text-base font-semibold text-gray-900 mb-4\",\"children\":[\"Python\",\" 의 다른글\"]}],[\"$\",\"ul\",null,{\"className\":\"space-y-2 text-sm\",\"children\":[[\"$\",\"li\",null,{\"className\":\"text-gray-500\",\"children\":[\"이전글\",\" \",[\"$\",\"$La\",null,{\"href\":\"/python/pep/673\",\"className\":\"text-gray-500 hover:text-gray-700 underline decoration-dotted underline-offset-4\",\"children\":\"[Final] PEP 673 - Self Type\"}]]}],[\"$\",\"li\",null,{\"className\":\"text-gray-900 font-semibold\",\"children\":[\"현재글 : \",\"[Deferred] PEP 674 - Disallow using macros as l-values\"]}],[\"$\",\"li\",null,{\"className\":\"text-gray-500\",\"children\":[\"다음글\",\" \",[\"$\",\"$La\",null,{\"href\":\"/python/pep/675\",\"className\":\"text-gray-500 hover:text-gray-700 underline decoration-dotted underline-offset-4\",\"children\":\"[Final] PEP 675 - Arbitrary Literal String Type\"}]]}]]}]]}]]}]]}]]}]]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"[Deferred] PEP 674 - Disallow using macros as l-values - secrett2633's blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Python Enhancement Proposal 674: 'Disallow using macros as l-values'에 대한 한국어 번역입니다.\"}],[\"$\",\"meta\",\"4\",{\"name\":\"author\",\"content\":\"secrett2633\"}],[\"$\",\"link\",\"5\",{\"rel\":\"manifest\",\"href\":\"/manifest.json\",\"crossOrigin\":\"use-credentials\"}],[\"$\",\"meta\",\"6\",{\"name\":\"keywords\",\"content\":\"Django, Python, DevOps, AI, ML, 블로그, 기술\"}],[\"$\",\"meta\",\"7\",{\"name\":\"creator\",\"content\":\"secrett2633\"}],[\"$\",\"meta\",\"8\",{\"name\":\"publisher\",\"content\":\"secrett2633\"}],[\"$\",\"meta\",\"9\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"10\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"11\",{\"rel\":\"canonical\",\"href\":\"https://blog.secrett2633.cloud/python/pep/674\"}],[\"$\",\"meta\",\"12\",{\"name\":\"format-detection\",\"content\":\"telephone=no, address=no, email=no\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:title\",\"content\":\"[Deferred] PEP 674 - Disallow using macros as l-values\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:description\",\"content\":\"Python Enhancement Proposal 674: 'Disallow using macros as l-values'에 대한 한국어 번역입니다.\"}],[\"$\",\"meta\",\"15\",{\"property\":\"og:url\",\"content\":\"https://blog.secrett2633.cloud/python/pep/674\"}],[\"$\",\"meta\",\"16\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"17\",{\"property\":\"article:published_time\",\"content\":\"2025-09-27T01:07:42.000Z\"}],[\"$\",\"meta\",\"18\",{\"property\":\"article:modified_time\",\"content\":\"2025-09-27T01:07:42.000Z\"}],[\"$\",\"meta\",\"19\",{\"property\":\"article:author\",\"content\":\"secrett2633\"}],[\"$\",\"meta\",\"20\",{\"property\":\"article:section\",\"content\":\"Python\"}],[\"$\",\"meta\",\"21\",{\"property\":\"article:tag\",\"content\":\"Python\"}],[\"$\",\"meta\",\"22\",{\"property\":\"article:tag\",\"content\":\"PEP\"}],[\"$\",\"meta\",\"23\",{\"property\":\"article:tag\",\"content\":\"Translation\"}],[\"$\",\"meta\",\"24\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"25\",{\"name\":\"twitter:creator\",\"content\":\"@secrett2633\"}],[\"$\",\"meta\",\"26\",{\"name\":\"twitter:title\",\"content\":\"[Deferred] PEP 674 - Disallow using macros as l-values\"}],[\"$\",\"meta\",\"27\",{\"name\":\"twitter:description\",\"content\":\"Python Enhancement Proposal 674: 'Disallow using macros as l-values'에 대한 한국어 번역입니다.\"}],[\"$\",\"link\",\"28\",{\"rel\":\"icon\",\"href\":\"/icon.ico?6d9f34d4948640b8\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"meta\",\"29\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"4:null\n"])</script></body></html>