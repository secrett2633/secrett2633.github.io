<!DOCTYPE html><html lang="ko" class="no-js"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/fd3b6909b9405577.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-4bcb99d26e8ec64d.js"/><script src="/_next/static/chunks/fd9d1056-62aaf4b921c84028.js" async=""></script><script src="/_next/static/chunks/23-83259811f348ae3a.js" async=""></script><script src="/_next/static/chunks/main-app-6d0231ce06c8f62f.js" async=""></script><script src="/_next/static/chunks/231-87925b9c7247c60f.js" async=""></script><script src="/_next/static/chunks/app/%5B...slug%5D/page-b477922462c615bf.js" async=""></script><title>secrett2633&#x27;s blog</title><meta name="description" content="기술 블로그"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><meta name="msapplication-TileColor" content="#ffc40d"/><meta name="theme-color" content="#ffffff"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_f367f3 layout--default"><div class="min-h-screen bg-gray-50"><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav id="site-nav" class="greedy-nav"><a class="site-title" href="/">secrett2633&#x27;s blog</a><div class="flex items-center space-x-4"><ul class="visible-links"><li class="masthead__menu-item"><a href="https://github.com/secrett2633" target="_blank" rel="noopener noreferrer">GitHub</a></li></ul><button class="search__toggle" type="button"><svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16"><path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path></svg></button><button class="greedy-nav__toggle" type="button"><div class="navicon"></div></button></div><ul class="hidden-links hidden md:hidden"><li><a href="https://github.com/secrett2633" target="_blank" rel="noopener noreferrer" class="block py-2">GitHub</a></li></ul></nav></div></div></div><main class="initial-content"><!--$--><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav id="site-nav" class="greedy-nav"><a class="site-title" href="/">secrett2633&#x27;s blog</a><div class="flex items-center space-x-4"><ul class="visible-links"><li class="masthead__menu-item"><a href="https://github.com/secrett2633" target="_blank" rel="noopener noreferrer">GitHub</a></li></ul><button class="search__toggle" type="button"><svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16"><path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path></svg></button><button class="greedy-nav__toggle" type="button"><div class="navicon"></div></button></div><ul class="hidden-links hidden md:hidden"><li><a href="https://github.com/secrett2633" target="_blank" rel="noopener noreferrer" class="block py-2">GitHub</a></li></ul></nav></div></div></div><div class="initial-content"><div class="flex flex-col lg:flex-row gap-8"><main class="flex-1"><article class="page"><header class="mb-8"><h1 class="page__title">[Django] prefetch_related</h1><div class="page__meta"><time dateTime="2025-02-14 00:00:00+0900">2025년 2월 14일</time><span class="ml-4">수정: <!-- -->2025년 2월 14일</span></div></header><div class="page__content"><div><p>Django ORM에서 N+1 쿼리 문제를 해결하기 위한 <code>prefetch_related</code>에 대해 알아보겠습니다.</p>
<h2>prefetch_related란?</h2>
<p><code>prefetch_related</code>는 역참조 관계나 ManyToMany 관계에서 발생하는 N+1 쿼리 문제를 해결하는 Django ORM의 최적화 기능입니다.</p>
<h2>기본 사용법</h2>
<h3>1. 모델 정의</h3>
<pre><code class="language-python">from django.db import models

class Author(models.Model):
    name = models.CharField(max_length=100)
    
    def __str__(self):
        return self.name

class Book(models.Model):
    title = models.CharField(max_length=200)
    author = models.ForeignKey(Author, on_delete=models.CASCADE)
    published_date = models.DateField()
    
    def __str__(self):
        return self.title

class Category(models.Model):
    name = models.CharField(max_length=50)
    books = models.ManyToManyField(Book)
    
    def __str__(self):
        return self.name
</code></pre>
<h3>2. N+1 문제 발생</h3>
<pre><code class="language-python"># N+1 문제가 발생하는 코드
authors = Author.objects.all()
for author in authors:
    print(f"{author.name}: {author.book_set.count()}권의 책")
    # 각 author마다 추가 쿼리가 실행됨
</code></pre>
<h3>3. prefetch_related로 해결</h3>
<pre><code class="language-python"># prefetch_related로 최적화
authors = Author.objects.prefetch_related('book_set').all()
for author in authors:
    print(f"{author.name}: {author.book_set.count()}권의 책")
    # 추가 쿼리 없이 실행됨
</code></pre>
<h2>다양한 사용법</h2>
<h3>1. 중첩된 관계 prefetch</h3>
<pre><code class="language-python"># 중첩된 관계도 prefetch 가능
authors = Author.objects.prefetch_related(
    'book_set__category_set'
).all()

for author in authors:
    for book in author.book_set.all():
        for category in book.category_set.all():
            print(f"{author.name} - {book.title} - {category.name}")
</code></pre>
<h3>2. Prefetch 객체 사용</h3>
<pre><code class="language-python">from django.db.models import Prefetch

# 특정 조건으로 prefetch
authors = Author.objects.prefetch_related(
    Prefetch(
        'book_set',
        queryset=Book.objects.filter(published_date__year=2024)
    )
).all()
</code></pre>
<h3>3. select_related와 함께 사용</h3>
<pre><code class="language-python"># ForeignKey는 select_related, 역참조는 prefetch_related
books = Book.objects.select_related('author').prefetch_related('category_set').all()

for book in books:
    print(f"{book.title} by {book.author.name}")
    for category in book.category_set.all():
        print(f"  - {category.name}")
</code></pre>
<h2>성능 비교</h2>
<h3>Before (N+1 문제)</h3>
<pre><code class="language-python"># 쿼리 수: 1 + N (N은 author 수)
authors = Author.objects.all()
for author in authors:
    books = author.book_set.all()  # 각각 추가 쿼리
</code></pre>
<h3>After (prefetch_related 사용)</h3>
<pre><code class="language-python"># 쿼리 수: 2 (고정)
authors = Author.objects.prefetch_related('book_set').all()
for author in authors:
    books = author.book_set.all()  # 추가 쿼리 없음
</code></pre>
<h2>실제 사용 예제</h2>
<h3>1. 블로그 포스트와 댓글</h3>
<pre><code class="language-python">class Post(models.Model):
    title = models.CharField(max_length=200)
    content = models.TextField()
    author = models.ForeignKey(User, on_delete=models.CASCADE)

class Comment(models.Model):
    post = models.ForeignKey(Post, on_delete=models.CASCADE)
    content = models.TextField()
    author = models.ForeignKey(User, on_delete=models.CASCADE)

# 최적화된 쿼리
posts = Post.objects.select_related('author').prefetch_related('comment_set').all()
</code></pre>
<h3>2. 쇼핑몰 상품과 리뷰</h3>
<pre><code class="language-python">class Product(models.Model):
    name = models.CharField(max_length=200)
    price = models.DecimalField(max_digits=10, decimal_places=2)

class Review(models.Model):
    product = models.ForeignKey(Product, on_delete=models.CASCADE)
    rating = models.IntegerField()
    comment = models.TextField()

# 최적화된 쿼리
products = Product.objects.prefetch_related('review_set').all()
</code></pre>
<h2>주의사항</h2>
<ol>
<li><strong>메모리 사용량 증가</strong>: 모든 관련 객체를 메모리에 로드</li>
<li><strong>적절한 사용</strong>: 실제로 사용하는 관계만 prefetch</li>
<li><strong>쿼리 분석</strong>: Django Debug Toolbar로 쿼리 수 확인</li>
</ol>
<p><code>prefetch_related</code>를 적절히 사용하면 Django 애플리케이션의 성능을 크게 향상시킬 수 있습니다!</p>
</div></div><footer class="page__meta mt-8"><div class="page__taxonomy mb-4"><h4 class="text-sm font-medium text-gray-900 mb-2">카테고리</h4><span class="page__taxonomy-item">Django</span></div><div class="page__taxonomy"><h4 class="text-sm font-medium text-gray-900 mb-2">태그</h4><span class="page__taxonomy-item">#<!-- -->Django</span><span class="page__taxonomy-item">#<!-- -->ORM</span><span class="page__taxonomy-item">#<!-- -->Performance</span></div></footer></article></main><aside class="lg:w-80"><div class="sidebar sticky"><nav class="space-y-4"><div><h4 class="font-medium text-gray-900 mb-2">Backend</h4><ul class="space-y-1 ml-4"><li><a href="/backend/django/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Django</a></li><li><a href="/backend/logging/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Logging</a></li></ul></div><div><h4 class="font-medium text-gray-900 mb-2">Python</h4><ul class="space-y-1 ml-4"><li><a href="/python/pep/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">PEP</a></li></ul></div><div><h4 class="font-medium text-gray-900 mb-2">AI/ML</h4><ul class="space-y-1 ml-4"><li><a href="/ai/llm/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">LLM</a></li><li><a href="/ai/review/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Review</a></li></ul></div><div><h4 class="font-medium text-gray-900 mb-2">DevOps</h4><ul class="space-y-1 ml-4"><li><a href="/devops/nginx/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Nginx</a></li><li><a href="/devops/docker/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Docker</a></li><li><a href="/devops/safeline/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">SafeLine</a></li><li><a href="/devops/jenkins/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Jenkins</a></li><li><a href="/devops/github-actions/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">GitHub Actions</a></li><li><a href="/devops/aws/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">AWS</a></li></ul></div><div><h4 class="font-medium text-gray-900 mb-2">etc</h4><ul class="space-y-1 ml-4"><li><a href="/etc/me/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Me</a></li><li><a href="/etc/chrome-extension/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Chrome Extension</a></li></ul></div></nav></div></aside></div></div><div id="footer" class="page__footer"><footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><div class="text-center text-gray-500 text-sm"><p>© 2025 secrett2633. All rights reserved.</p></div></footer></div><!--/$--></main><div id="footer" class="page__footer"><footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><div class="text-center text-gray-500 text-sm"><p>© 2025 secrett2633. All rights reserved.</p></div></footer></div></div><script src="/_next/static/chunks/webpack-4bcb99d26e8ec64d.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/fd3b6909b9405577.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"2:I[5751,[],\"\"]\n5:I[9275,[],\"\"]\n7:I[1343,[],\"\"]\n8:I[9325,[\"231\",\"static/chunks/231-87925b9c7247c60f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-b477922462c615bf.js\"],\"default\"]\n9:I[231,[\"231\",\"static/chunks/231-87925b9c7247c60f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-b477922462c615bf.js\"],\"\"]\nb:I[6130,[],\"\"]\n6:[\"slug\",\"backend/django/prefetch-related\",\"c\"]\nc:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/fd3b6909b9405577.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L2\",null,{\"buildId\":\"ucidvW-jotunXd_-W91EG\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/backend/django/prefetch-related/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"backend/django/prefetch-related\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"backend\\\",\\\"django\\\",\\\"prefetch-related\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"backend/django/prefetch-related\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L3\",\"$L4\"],null],null]},[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$6\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"ko\",\"className\":\"no-js\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/favicon-32x32.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/favicon-16x16.png\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#ffc40d\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"#ffffff\"}]]}],[\"$\",\"body\",null,{\"className\":\"__className_f367f3 layout--default\",\"children\":[\"$\",\"div\",null,{\"className\":\"min-h-screen bg-gray-50\",\"children\":[[\"$\",\"$L8\",null,{}],[\"$\",\"main\",null,{\"className\":\"initial-content\",\"children\":[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"min-h-screen flex items-center justify-center bg-gray-50\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-md w-full bg-white rounded-lg shadow-md p-8 text-center\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-6xl font-bold text-primary-600 mb-4\",\"children\":\"404\"}],[\"$\",\"h2\",null,{\"className\":\"text-2xl font-semibold text-gray-900 mb-4\",\"children\":\"페이지를 찾을 수 없습니다\"}],[\"$\",\"p\",null,{\"className\":\"text-gray-600 mb-8\",\"children\":\"요청하신 페이지가 존재하지 않거나 이동되었을 수 있습니다.\"}],[\"$\",\"$L9\",null,{\"href\":\"/\",\"className\":\"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors\",\"children\":\"홈으로 돌아가기\"}]]}]}],\"notFoundStyles\":[],\"styles\":null}]}],[\"$\",\"div\",null,{\"id\":\"footer\",\"className\":\"page__footer\",\"children\":[\"$\",\"footer\",null,{\"className\":\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"text-center text-gray-500 text-sm\",\"children\":[\"$\",\"p\",null,{\"children\":\"© 2025 secrett2633. All rights reserved.\"}]}]}]}]]}]}]]}],null],[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-center min-h-screen\",\"children\":[\"$\",\"div\",null,{\"className\":\"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600\"}]}],[],[]]],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$La\"],\"globalErrorComponent\":\"$b\",\"missingSlots\":\"$Wc\"}]]\n"])</script><script>self.__next_f.push([1,"e:I[8573,[\"231\",\"static/chunks/231-87925b9c7247c60f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-b477922462c615bf.js\"],\"default\"]\nd:T12a6,"])</script><script>self.__next_f.push([1,"\u003cp\u003eDjango ORM에서 N+1 쿼리 문제를 해결하기 위한 \u003ccode\u003eprefetch_related\u003c/code\u003e에 대해 알아보겠습니다.\u003c/p\u003e\n\u003ch2\u003eprefetch_related란?\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eprefetch_related\u003c/code\u003e는 역참조 관계나 ManyToMany 관계에서 발생하는 N+1 쿼리 문제를 해결하는 Django ORM의 최적화 기능입니다.\u003c/p\u003e\n\u003ch2\u003e기본 사용법\u003c/h2\u003e\n\u003ch3\u003e1. 모델 정의\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003efrom django.db import models\r\n\r\nclass Author(models.Model):\r\n    name = models.CharField(max_length=100)\r\n    \r\n    def __str__(self):\r\n        return self.name\r\n\r\nclass Book(models.Model):\r\n    title = models.CharField(max_length=200)\r\n    author = models.ForeignKey(Author, on_delete=models.CASCADE)\r\n    published_date = models.DateField()\r\n    \r\n    def __str__(self):\r\n        return self.title\r\n\r\nclass Category(models.Model):\r\n    name = models.CharField(max_length=50)\r\n    books = models.ManyToManyField(Book)\r\n    \r\n    def __str__(self):\r\n        return self.name\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e2. N+1 문제 발생\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# N+1 문제가 발생하는 코드\r\nauthors = Author.objects.all()\r\nfor author in authors:\r\n    print(f\"{author.name}: {author.book_set.count()}권의 책\")\r\n    # 각 author마다 추가 쿼리가 실행됨\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e3. prefetch_related로 해결\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# prefetch_related로 최적화\r\nauthors = Author.objects.prefetch_related('book_set').all()\r\nfor author in authors:\r\n    print(f\"{author.name}: {author.book_set.count()}권의 책\")\r\n    # 추가 쿼리 없이 실행됨\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e다양한 사용법\u003c/h2\u003e\n\u003ch3\u003e1. 중첩된 관계 prefetch\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# 중첩된 관계도 prefetch 가능\r\nauthors = Author.objects.prefetch_related(\r\n    'book_set__category_set'\r\n).all()\r\n\r\nfor author in authors:\r\n    for book in author.book_set.all():\r\n        for category in book.category_set.all():\r\n            print(f\"{author.name} - {book.title} - {category.name}\")\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e2. Prefetch 객체 사용\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003efrom django.db.models import Prefetch\r\n\r\n# 특정 조건으로 prefetch\r\nauthors = Author.objects.prefetch_related(\r\n    Prefetch(\r\n        'book_set',\r\n        queryset=Book.objects.filter(published_date__year=2024)\r\n    )\r\n).all()\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e3. select_related와 함께 사용\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# ForeignKey는 select_related, 역참조는 prefetch_related\r\nbooks = Book.objects.select_related('author').prefetch_related('category_set').all()\r\n\r\nfor book in books:\r\n    print(f\"{book.title} by {book.author.name}\")\r\n    for category in book.category_set.all():\r\n        print(f\"  - {category.name}\")\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e성능 비교\u003c/h2\u003e\n\u003ch3\u003eBefore (N+1 문제)\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# 쿼리 수: 1 + N (N은 author 수)\r\nauthors = Author.objects.all()\r\nfor author in authors:\r\n    books = author.book_set.all()  # 각각 추가 쿼리\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eAfter (prefetch_related 사용)\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# 쿼리 수: 2 (고정)\r\nauthors = Author.objects.prefetch_related('book_set').all()\r\nfor author in authors:\r\n    books = author.book_set.all()  # 추가 쿼리 없음\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e실제 사용 예제\u003c/h2\u003e\n\u003ch3\u003e1. 블로그 포스트와 댓글\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003eclass Post(models.Model):\r\n    title = models.CharField(max_length=200)\r\n    content = models.TextField()\r\n    author = models.ForeignKey(User, on_delete=models.CASCADE)\r\n\r\nclass Comment(models.Model):\r\n    post = models.ForeignKey(Post, on_delete=models.CASCADE)\r\n    content = models.TextField()\r\n    author = models.ForeignKey(User, on_delete=models.CASCADE)\r\n\r\n# 최적화된 쿼리\r\nposts = Post.objects.select_related('author').prefetch_related('comment_set').all()\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e2. 쇼핑몰 상품과 리뷰\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003eclass Product(models.Model):\r\n    name = models.CharField(max_length=200)\r\n    price = models.DecimalField(max_digits=10, decimal_places=2)\r\n\r\nclass Review(models.Model):\r\n    product = models.ForeignKey(Product, on_delete=models.CASCADE)\r\n    rating = models.IntegerField()\r\n    comment = models.TextField()\r\n\r\n# 최적화된 쿼리\r\nproducts = Product.objects.prefetch_related('review_set').all()\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e주의사항\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e메모리 사용량 증가\u003c/strong\u003e: 모든 관련 객체를 메모리에 로드\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e적절한 사용\u003c/strong\u003e: 실제로 사용하는 관계만 prefetch\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e쿼리 분석\u003c/strong\u003e: Django Debug Toolbar로 쿼리 수 확인\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003ccode\u003eprefetch_related\u003c/code\u003e를 적절히 사용하면 Django 애플리케이션의 성능을 크게 향상시킬 수 있습니다!\u003c/p\u003e\n"])</script><script>self.__next_f.push([1,"4:[[\"$\",\"$L8\",null,{}],[\"$\",\"div\",null,{\"className\":\"initial-content\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col lg:flex-row gap-8\",\"children\":[[\"$\",\"main\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"article\",null,{\"className\":\"page\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"page__title\",\"children\":\"[Django] prefetch_related\"}],[\"$\",\"div\",null,{\"className\":\"page__meta\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2025-02-14 00:00:00+0900\",\"children\":\"2025년 2월 14일\"}],[\"$\",\"span\",null,{\"className\":\"ml-4\",\"children\":[\"수정: \",\"2025년 2월 14일\"]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"page__content\",\"children\":[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$d\"}}]}],[\"$\",\"footer\",null,{\"className\":\"page__meta mt-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"page__taxonomy mb-4\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"text-sm font-medium text-gray-900 mb-2\",\"children\":\"카테고리\"}],[[\"$\",\"span\",\"Django\",{\"className\":\"page__taxonomy-item\",\"children\":\"Django\"}]]]}],[\"$\",\"div\",null,{\"className\":\"page__taxonomy\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"text-sm font-medium text-gray-900 mb-2\",\"children\":\"태그\"}],[[\"$\",\"span\",\"Django\",{\"className\":\"page__taxonomy-item\",\"children\":[\"#\",\"Django\"]}],[\"$\",\"span\",\"ORM\",{\"className\":\"page__taxonomy-item\",\"children\":[\"#\",\"ORM\"]}],[\"$\",\"span\",\"Performance\",{\"className\":\"page__taxonomy-item\",\"children\":[\"#\",\"Performance\"]}]]]}]]}]]}]}],[\"$\",\"aside\",null,{\"className\":\"lg:w-80\",\"children\":[\"$\",\"$Le\",null,{}]}]]}]}],[\"$\",\"div\",null,{\"id\":\"footer\",\"className\":\"page__footer\",\"children\":[\"$\",\"footer\",null,{\"className\":\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"text-center text-gray-500 text-sm\",\"children\":[\"$\",\"p\",null,{\"children\":\"© 2025 secrett2633. All rights reserved.\"}]}]}]}]]\na:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"secrett2633's blog\"}],[\"$\",\"meta\""])</script><script>self.__next_f.push([1,",\"3\",{\"name\":\"description\",\"content\":\"기술 블로그\"}]]\n3:null\n"])</script></body></html>