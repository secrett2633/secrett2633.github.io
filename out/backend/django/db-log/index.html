<!DOCTYPE html><html lang="ko" class="no-js"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/fd3b6909b9405577.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-4bcb99d26e8ec64d.js"/><script src="/_next/static/chunks/fd9d1056-62aaf4b921c84028.js" async=""></script><script src="/_next/static/chunks/23-83259811f348ae3a.js" async=""></script><script src="/_next/static/chunks/main-app-6d0231ce06c8f62f.js" async=""></script><script src="/_next/static/chunks/231-87925b9c7247c60f.js" async=""></script><script src="/_next/static/chunks/app/%5B...slug%5D/page-b477922462c615bf.js" async=""></script><title>secrett2633&#x27;s blog</title><meta name="description" content="기술 블로그"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><meta name="msapplication-TileColor" content="#ffc40d"/><meta name="theme-color" content="#ffffff"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_f367f3 layout--default"><div class="min-h-screen bg-gray-50"><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav id="site-nav" class="greedy-nav"><a class="site-title" href="/">secrett2633&#x27;s blog</a><div class="flex items-center space-x-4"><ul class="visible-links"><li class="masthead__menu-item"><a href="https://github.com/secrett2633" target="_blank" rel="noopener noreferrer">GitHub</a></li></ul><button class="search__toggle" type="button"><svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16"><path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path></svg></button><button class="greedy-nav__toggle" type="button"><div class="navicon"></div></button></div><ul class="hidden-links hidden md:hidden"><li><a href="https://github.com/secrett2633" target="_blank" rel="noopener noreferrer" class="block py-2">GitHub</a></li></ul></nav></div></div></div><main class="initial-content"><!--$--><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav id="site-nav" class="greedy-nav"><a class="site-title" href="/">secrett2633&#x27;s blog</a><div class="flex items-center space-x-4"><ul class="visible-links"><li class="masthead__menu-item"><a href="https://github.com/secrett2633" target="_blank" rel="noopener noreferrer">GitHub</a></li></ul><button class="search__toggle" type="button"><svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16"><path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path></svg></button><button class="greedy-nav__toggle" type="button"><div class="navicon"></div></button></div><ul class="hidden-links hidden md:hidden"><li><a href="https://github.com/secrett2633" target="_blank" rel="noopener noreferrer" class="block py-2">GitHub</a></li></ul></nav></div></div></div><div class="initial-content"><div class="flex flex-col lg:flex-row gap-8"><main class="flex-1"><article class="page"><header class="mb-8"><h1 class="page__title">[Django] DB 로그 확인하기</h1><div class="page__meta"><time dateTime="2025-02-05 00:00:00+0900">2025년 2월 5일</time><span class="ml-4">수정: <!-- -->2025년 2월 5일</span></div></header><div class="page__content"><div><p>Django에서 데이터베이스 쿼리를 모니터링하고 로그를 확인하는 방법에 대해 알아보겠습니다.</p>
<h2>Django 설정에서 DB 로깅 활성화</h2>
<h3>1. settings.py 설정</h3>
<pre><code class="language-python"># settings.py
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        'file': {
            'level': 'DEBUG',
            'class': 'logging.FileHandler',
            'filename': 'django_queries.log',
        },
        'console': {
            'level': 'DEBUG',
            'class': 'logging.StreamHandler',
        },
    },
    'loggers': {
        'django.db.backends': {
            'handlers': ['file', 'console'],
            'level': 'DEBUG',
            'propagate': False,
        },
    },
}
</code></pre>
<h3>2. 개발 환경에서만 활성화</h3>
<pre><code class="language-python"># settings.py
if DEBUG:
    LOGGING = {
        'version': 1,
        'disable_existing_loggers': False,
        'handlers': {
            'console': {
                'level': 'DEBUG',
                'class': 'logging.StreamHandler',
            },
        },
        'loggers': {
            'django.db.backends': {
                'handlers': ['console'],
                'level': 'DEBUG',
                'propagate': False,
            },
        },
    }
</code></pre>
<h2>Django Debug Toolbar 사용</h2>
<h3>1. 설치</h3>
<pre><code class="language-bash">pip install django-debug-toolbar
</code></pre>
<h3>2. 설정</h3>
<pre><code class="language-python"># settings.py
INSTALLED_APPS = [
    # ...
    'debug_toolbar',
    # ...
]

MIDDLEWARE = [
    # ...
    'debug_toolbar.middleware.DebugToolbarMiddleware',
    # ...
]

INTERNAL_IPS = [
    '127.0.0.1',
]

# urls.py
if settings.DEBUG:
    import debug_toolbar
    urlpatterns = [
        path('__debug__/', include(debug_toolbar.urls)),
    ] + urlpatterns
</code></pre>
<h2>코드에서 쿼리 모니터링</h2>
<h3>1. connection.queries 사용</h3>
<pre><code class="language-python">from django.db import connection
from django.test.utils import override_settings

def monitor_queries():
    # 쿼리 초기화
    connection.queries.clear()
    
    # ORM 쿼리 실행
    users = User.objects.all()
    for user in users:
        posts = user.post_set.all()
    
    # 실행된 쿼리 확인
    print(f"총 쿼리 수: {len(connection.queries)}")
    for query in connection.queries:
        print(f"SQL: {query['sql']}")
        print(f"시간: {query['time']}초")
        print("-" * 50)
</code></pre>
<h3>2. contextlib 사용</h3>
<pre><code class="language-python">from contextlib import contextmanager
from django.db import connection

@contextmanager
def query_counter():
    initial_queries = len(connection.queries)
    yield
    final_queries = len(connection.queries)
    print(f"실행된 쿼리 수: {final_queries - initial_queries}")

# 사용 예제
with query_counter():
    users = User.objects.all()
    for user in users:
        posts = user.post_set.all()
</code></pre>
<h2>커스텀 미들웨어로 쿼리 로깅</h2>
<h3>1. 미들웨어 생성</h3>
<pre><code class="language-python"># middleware.py
import time
from django.db import connection
from django.utils.deprecation import MiddlewareMixin

class QueryLoggingMiddleware(MiddlewareMixin):
    def process_request(self, request):
        request._start_time = time.time()
        connection.queries.clear()
    
    def process_response(self, request, response):
        if hasattr(request, '_start_time'):
            duration = time.time() - request._start_time
            query_count = len(connection.queries)
            
            if query_count > 10:  # 쿼리가 많을 때만 로깅
                print(f"경로: {request.path}")
                print(f"쿼리 수: {query_count}")
                print(f"실행 시간: {duration:.2f}초")
                
                # 느린 쿼리 확인
                slow_queries = [q for q in connection.queries if float(q['time']) > 0.1]
                if slow_queries:
                    print("느린 쿼리:")
                    for query in slow_queries:
                        print(f"  {query['sql'][:100]}... ({query['time']}초)")
        
        return response
</code></pre>
<h3>2. 미들웨어 등록</h3>
<pre><code class="language-python"># settings.py
MIDDLEWARE = [
    # ...
    'myapp.middleware.QueryLoggingMiddleware',
    # ...
]
</code></pre>
<h2>프로덕션 환경에서의 쿼리 모니터링</h2>
<h3>1. Sentry 사용</h3>
<pre><code class="language-python"># sentry 설정
import sentry_sdk
from sentry_sdk.integrations.django import DjangoIntegration

sentry_sdk.init(
    dsn="YOUR_SENTRY_DSN",
    integrations=[DjangoIntegration()],
    traces_sample_rate=1.0,
)
</code></pre>
<h3>2. APM 도구 사용</h3>
<pre><code class="language-python"># New Relic, DataDog 등 APM 도구 설정
# 각 도구의 문서를 참조하여 설정
</code></pre>
<h2>쿼리 최적화 팁</h2>
<h3>1. select_related와 prefetch_related 사용</h3>
<pre><code class="language-python"># N+1 문제 해결
users = User.objects.select_related('profile').prefetch_related('posts').all()
</code></pre>
<h3>2. 쿼리셋 캐싱</h3>
<pre><code class="language-python"># 쿼리셋을 변수에 저장하여 재사용
users = User.objects.all()
user_list = list(users)  # 쿼리 실행
</code></pre>
<h3>3. 불필요한 쿼리 제거</h3>
<pre><code class="language-python"># 나쁜 예
if User.objects.filter(email=email).exists():
    user = User.objects.get(email=email)

# 좋은 예
try:
    user = User.objects.get(email=email)
except User.DoesNotExist:
    user = None
</code></pre>
<p>적절한 쿼리 모니터링과 최적화로 Django 애플리케이션의 성능을 크게 향상시킬 수 있습니다!</p>
</div></div><footer class="page__meta mt-8"><div class="page__taxonomy mb-4"><h4 class="text-sm font-medium text-gray-900 mb-2">카테고리</h4><span class="page__taxonomy-item">Django</span></div><div class="page__taxonomy"><h4 class="text-sm font-medium text-gray-900 mb-2">태그</h4><span class="page__taxonomy-item">#<!-- -->Django</span><span class="page__taxonomy-item">#<!-- -->Database</span><span class="page__taxonomy-item">#<!-- -->Logging</span></div></footer></article></main><aside class="lg:w-80"><div class="sidebar sticky"><nav class="space-y-4"><div><h4 class="font-medium text-gray-900 mb-2">Backend</h4><ul class="space-y-1 ml-4"><li><a href="/backend/django/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Django</a></li><li><a href="/backend/logging/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Logging</a></li></ul></div><div><h4 class="font-medium text-gray-900 mb-2">Python</h4><ul class="space-y-1 ml-4"><li><a href="/python/pep/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">PEP</a></li></ul></div><div><h4 class="font-medium text-gray-900 mb-2">AI/ML</h4><ul class="space-y-1 ml-4"><li><a href="/ai/llm/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">LLM</a></li><li><a href="/ai/review/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Review</a></li></ul></div><div><h4 class="font-medium text-gray-900 mb-2">DevOps</h4><ul class="space-y-1 ml-4"><li><a href="/devops/nginx/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Nginx</a></li><li><a href="/devops/docker/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Docker</a></li><li><a href="/devops/safeline/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">SafeLine</a></li><li><a href="/devops/jenkins/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Jenkins</a></li><li><a href="/devops/github-actions/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">GitHub Actions</a></li><li><a href="/devops/aws/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">AWS</a></li></ul></div><div><h4 class="font-medium text-gray-900 mb-2">etc</h4><ul class="space-y-1 ml-4"><li><a href="/etc/me/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Me</a></li><li><a href="/etc/chrome-extension/" class="text-sm text-gray-600 hover:text-primary-600 block py-1">Chrome Extension</a></li></ul></div></nav></div></aside></div></div><div id="footer" class="page__footer"><footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><div class="text-center text-gray-500 text-sm"><p>© 2025 secrett2633. All rights reserved.</p></div></footer></div><!--/$--></main><div id="footer" class="page__footer"><footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><div class="text-center text-gray-500 text-sm"><p>© 2025 secrett2633. All rights reserved.</p></div></footer></div></div><script src="/_next/static/chunks/webpack-4bcb99d26e8ec64d.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/fd3b6909b9405577.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"2:I[5751,[],\"\"]\n5:I[9275,[],\"\"]\n7:I[1343,[],\"\"]\n8:I[9325,[\"231\",\"static/chunks/231-87925b9c7247c60f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-b477922462c615bf.js\"],\"default\"]\n9:I[231,[\"231\",\"static/chunks/231-87925b9c7247c60f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-b477922462c615bf.js\"],\"\"]\nb:I[6130,[],\"\"]\n6:[\"slug\",\"backend/django/db-log\",\"c\"]\nc:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/fd3b6909b9405577.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L2\",null,{\"buildId\":\"ucidvW-jotunXd_-W91EG\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/backend/django/db-log/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"backend/django/db-log\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"backend\\\",\\\"django\\\",\\\"db-log\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"backend/django/db-log\",\"c\"],{\"children\":[\"__PAGE__\",{},[[\"$L3\",\"$L4\"],null],null]},[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$6\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"ko\",\"className\":\"no-js\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/favicon-32x32.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/favicon-16x16.png\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#ffc40d\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"#ffffff\"}]]}],[\"$\",\"body\",null,{\"className\":\"__className_f367f3 layout--default\",\"children\":[\"$\",\"div\",null,{\"className\":\"min-h-screen bg-gray-50\",\"children\":[[\"$\",\"$L8\",null,{}],[\"$\",\"main\",null,{\"className\":\"initial-content\",\"children\":[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"min-h-screen flex items-center justify-center bg-gray-50\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-md w-full bg-white rounded-lg shadow-md p-8 text-center\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-6xl font-bold text-primary-600 mb-4\",\"children\":\"404\"}],[\"$\",\"h2\",null,{\"className\":\"text-2xl font-semibold text-gray-900 mb-4\",\"children\":\"페이지를 찾을 수 없습니다\"}],[\"$\",\"p\",null,{\"className\":\"text-gray-600 mb-8\",\"children\":\"요청하신 페이지가 존재하지 않거나 이동되었을 수 있습니다.\"}],[\"$\",\"$L9\",null,{\"href\":\"/\",\"className\":\"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors\",\"children\":\"홈으로 돌아가기\"}]]}]}],\"notFoundStyles\":[],\"styles\":null}]}],[\"$\",\"div\",null,{\"id\":\"footer\",\"className\":\"page__footer\",\"children\":[\"$\",\"footer\",null,{\"className\":\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"text-center text-gray-500 text-sm\",\"children\":[\"$\",\"p\",null,{\"children\":\"© 2025 secrett2633. All rights reserved.\"}]}]}]}]]}]}]]}],null],[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-center min-h-screen\",\"children\":[\"$\",\"div\",null,{\"className\":\"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600\"}]}],[],[]]],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$La\"],\"globalErrorComponent\":\"$b\",\"missingSlots\":\"$Wc\"}]]\n"])</script><script>self.__next_f.push([1,"e:I[8573,[\"231\",\"static/chunks/231-87925b9c7247c60f.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-b477922462c615bf.js\"],\"default\"]\nd:T1750,"])</script><script>self.__next_f.push([1,"\u003cp\u003eDjango에서 데이터베이스 쿼리를 모니터링하고 로그를 확인하는 방법에 대해 알아보겠습니다.\u003c/p\u003e\n\u003ch2\u003eDjango 설정에서 DB 로깅 활성화\u003c/h2\u003e\n\u003ch3\u003e1. settings.py 설정\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# settings.py\r\nLOGGING = {\r\n    'version': 1,\r\n    'disable_existing_loggers': False,\r\n    'handlers': {\r\n        'file': {\r\n            'level': 'DEBUG',\r\n            'class': 'logging.FileHandler',\r\n            'filename': 'django_queries.log',\r\n        },\r\n        'console': {\r\n            'level': 'DEBUG',\r\n            'class': 'logging.StreamHandler',\r\n        },\r\n    },\r\n    'loggers': {\r\n        'django.db.backends': {\r\n            'handlers': ['file', 'console'],\r\n            'level': 'DEBUG',\r\n            'propagate': False,\r\n        },\r\n    },\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e2. 개발 환경에서만 활성화\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# settings.py\r\nif DEBUG:\r\n    LOGGING = {\r\n        'version': 1,\r\n        'disable_existing_loggers': False,\r\n        'handlers': {\r\n            'console': {\r\n                'level': 'DEBUG',\r\n                'class': 'logging.StreamHandler',\r\n            },\r\n        },\r\n        'loggers': {\r\n            'django.db.backends': {\r\n                'handlers': ['console'],\r\n                'level': 'DEBUG',\r\n                'propagate': False,\r\n            },\r\n        },\r\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eDjango Debug Toolbar 사용\u003c/h2\u003e\n\u003ch3\u003e1. 설치\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003epip install django-debug-toolbar\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e2. 설정\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# settings.py\r\nINSTALLED_APPS = [\r\n    # ...\r\n    'debug_toolbar',\r\n    # ...\r\n]\r\n\r\nMIDDLEWARE = [\r\n    # ...\r\n    'debug_toolbar.middleware.DebugToolbarMiddleware',\r\n    # ...\r\n]\r\n\r\nINTERNAL_IPS = [\r\n    '127.0.0.1',\r\n]\r\n\r\n# urls.py\r\nif settings.DEBUG:\r\n    import debug_toolbar\r\n    urlpatterns = [\r\n        path('__debug__/', include(debug_toolbar.urls)),\r\n    ] + urlpatterns\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e코드에서 쿼리 모니터링\u003c/h2\u003e\n\u003ch3\u003e1. connection.queries 사용\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003efrom django.db import connection\r\nfrom django.test.utils import override_settings\r\n\r\ndef monitor_queries():\r\n    # 쿼리 초기화\r\n    connection.queries.clear()\r\n    \r\n    # ORM 쿼리 실행\r\n    users = User.objects.all()\r\n    for user in users:\r\n        posts = user.post_set.all()\r\n    \r\n    # 실행된 쿼리 확인\r\n    print(f\"총 쿼리 수: {len(connection.queries)}\")\r\n    for query in connection.queries:\r\n        print(f\"SQL: {query['sql']}\")\r\n        print(f\"시간: {query['time']}초\")\r\n        print(\"-\" * 50)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e2. contextlib 사용\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003efrom contextlib import contextmanager\r\nfrom django.db import connection\r\n\r\n@contextmanager\r\ndef query_counter():\r\n    initial_queries = len(connection.queries)\r\n    yield\r\n    final_queries = len(connection.queries)\r\n    print(f\"실행된 쿼리 수: {final_queries - initial_queries}\")\r\n\r\n# 사용 예제\r\nwith query_counter():\r\n    users = User.objects.all()\r\n    for user in users:\r\n        posts = user.post_set.all()\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e커스텀 미들웨어로 쿼리 로깅\u003c/h2\u003e\n\u003ch3\u003e1. 미들웨어 생성\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# middleware.py\r\nimport time\r\nfrom django.db import connection\r\nfrom django.utils.deprecation import MiddlewareMixin\r\n\r\nclass QueryLoggingMiddleware(MiddlewareMixin):\r\n    def process_request(self, request):\r\n        request._start_time = time.time()\r\n        connection.queries.clear()\r\n    \r\n    def process_response(self, request, response):\r\n        if hasattr(request, '_start_time'):\r\n            duration = time.time() - request._start_time\r\n            query_count = len(connection.queries)\r\n            \r\n            if query_count \u003e 10:  # 쿼리가 많을 때만 로깅\r\n                print(f\"경로: {request.path}\")\r\n                print(f\"쿼리 수: {query_count}\")\r\n                print(f\"실행 시간: {duration:.2f}초\")\r\n                \r\n                # 느린 쿼리 확인\r\n                slow_queries = [q for q in connection.queries if float(q['time']) \u003e 0.1]\r\n                if slow_queries:\r\n                    print(\"느린 쿼리:\")\r\n                    for query in slow_queries:\r\n                        print(f\"  {query['sql'][:100]}... ({query['time']}초)\")\r\n        \r\n        return response\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e2. 미들웨어 등록\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# settings.py\r\nMIDDLEWARE = [\r\n    # ...\r\n    'myapp.middleware.QueryLoggingMiddleware',\r\n    # ...\r\n]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e프로덕션 환경에서의 쿼리 모니터링\u003c/h2\u003e\n\u003ch3\u003e1. Sentry 사용\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# sentry 설정\r\nimport sentry_sdk\r\nfrom sentry_sdk.integrations.django import DjangoIntegration\r\n\r\nsentry_sdk.init(\r\n    dsn=\"YOUR_SENTRY_DSN\",\r\n    integrations=[DjangoIntegration()],\r\n    traces_sample_rate=1.0,\r\n)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e2. APM 도구 사용\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# New Relic, DataDog 등 APM 도구 설정\r\n# 각 도구의 문서를 참조하여 설정\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e쿼리 최적화 팁\u003c/h2\u003e\n\u003ch3\u003e1. select_related와 prefetch_related 사용\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# N+1 문제 해결\r\nusers = User.objects.select_related('profile').prefetch_related('posts').all()\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e2. 쿼리셋 캐싱\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# 쿼리셋을 변수에 저장하여 재사용\r\nusers = User.objects.all()\r\nuser_list = list(users)  # 쿼리 실행\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e3. 불필요한 쿼리 제거\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e# 나쁜 예\r\nif User.objects.filter(email=email).exists():\r\n    user = User.objects.get(email=email)\r\n\r\n# 좋은 예\r\ntry:\r\n    user = User.objects.get(email=email)\r\nexcept User.DoesNotExist:\r\n    user = None\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e적절한 쿼리 모니터링과 최적화로 Django 애플리케이션의 성능을 크게 향상시킬 수 있습니다!\u003c/p\u003e\n"])</script><script>self.__next_f.push([1,"4:[[\"$\",\"$L8\",null,{}],[\"$\",\"div\",null,{\"className\":\"initial-content\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col lg:flex-row gap-8\",\"children\":[[\"$\",\"main\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"article\",null,{\"className\":\"page\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"page__title\",\"children\":\"[Django] DB 로그 확인하기\"}],[\"$\",\"div\",null,{\"className\":\"page__meta\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2025-02-05 00:00:00+0900\",\"children\":\"2025년 2월 5일\"}],[\"$\",\"span\",null,{\"className\":\"ml-4\",\"children\":[\"수정: \",\"2025년 2월 5일\"]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"page__content\",\"children\":[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$d\"}}]}],[\"$\",\"footer\",null,{\"className\":\"page__meta mt-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"page__taxonomy mb-4\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"text-sm font-medium text-gray-900 mb-2\",\"children\":\"카테고리\"}],[[\"$\",\"span\",\"Django\",{\"className\":\"page__taxonomy-item\",\"children\":\"Django\"}]]]}],[\"$\",\"div\",null,{\"className\":\"page__taxonomy\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"text-sm font-medium text-gray-900 mb-2\",\"children\":\"태그\"}],[[\"$\",\"span\",\"Django\",{\"className\":\"page__taxonomy-item\",\"children\":[\"#\",\"Django\"]}],[\"$\",\"span\",\"Database\",{\"className\":\"page__taxonomy-item\",\"children\":[\"#\",\"Database\"]}],[\"$\",\"span\",\"Logging\",{\"className\":\"page__taxonomy-item\",\"children\":[\"#\",\"Logging\"]}]]]}]]}]]}]}],[\"$\",\"aside\",null,{\"className\":\"lg:w-80\",\"children\":[\"$\",\"$Le\",null,{}]}]]}]}],[\"$\",\"div\",null,{\"id\":\"footer\",\"className\":\"page__footer\",\"children\":[\"$\",\"footer\",null,{\"className\":\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"text-center text-gray-500 text-sm\",\"children\":[\"$\",\"p\",null,{\"children\":\"© 2025 secrett2633. All rights reserved.\"}]}]}]}]]\na:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"secrett2633's blog\"}],[\"$\","])</script><script>self.__next_f.push([1,"\"meta\",\"3\",{\"name\":\"description\",\"content\":\"기술 블로그\"}]]\n3:null\n"])</script></body></html>