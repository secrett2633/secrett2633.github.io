<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.22.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ko" class="no-js">
  <head>
    <style> 
      ::-webkit-scrollbar{ 
        width: 10px;
        height: 10px;
      }

      ::-webkit-scrollbar-track {
        width: 0px;
        background-color: #626262;
        /* border-radius: 5px; */
      }

      ::-webkit-scrollbar-thumb {
        width: 0px;
        background-color: #E2E2E2;
        border-radius: 5px;
      }

      ::-webkit-scrollbar-thumb:hover {
        width: 10px;
        height: 20px;
        /* background-color: rgba(190, 190, 190, 0.2); */
        background-color: #A2A2A2;
        border-radius: 5px;
      }

      ::-webkit-scrollbar-track:hover {
        width: 10px;
        /* background-color: rgba(150, 150, 150, 0.1); */
        background-color: #626262;
        border-radius: 5px;
        /* background: transparent; */
        /* border-radius: 10px; */
      }

      ::-webkit-scrollbar-button:start:decrement,::-webkit-scrollbar-button:end:increment {
          width:0px;
          height: 0px;
          /* background-color: rgb(14, 221, 24); */
          /* border-radius: 50%; */
      }
    </style>
    
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>[Final] PEP 343 - The “with” Statement | secrett2633</title>
<meta name="description" content="Python Enhancement Proposal 343: ‘The “with” Statement’에 대한 한국어 번역입니다.">


  <meta name="author" content="secrett2633">
  
  <meta property="article:author" content="secrett2633">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="ko_KR">
<meta property="og:site_name" content="secrett2633's blog">
<meta property="og:title" content="[Final] PEP 343 - The “with” Statement">
<meta property="og:url" content="http://localhost:4000/python/pep/343/">


  <meta property="og:description" content="Python Enhancement Proposal 343: ‘The “with” Statement’에 대한 한국어 번역입니다.">







  <meta property="article:published_time" content="2025-09-27T01:01:20+09:00">



  <meta property="article:modified_time" content="2025-09-27T01:01:20+09:00">



  

  


<link rel="canonical" href="http://localhost:4000/python/pep/343/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "secrett2633",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="secrett2633's blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->


    <link rel="icon" type="image/png" sizes="32x32" href="https://secrett2633.github.io/assets/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://secrett2633.github.io/assets/images/favicon/favicon-16x16.png">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          secrett2633's blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://github.com/secrett2633">GitHub</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <!-- 2022.02.17 author content hidden -->
  <!-- <div class="author__content">
    
      <h3 class="author__name" itemprop="name">secrett2633</h3>
    
    
  </div> -->

  <div class="author__urls-wrapper">
    <!-- <button class="btn btn--inverse">Follow</button> -->
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <!-- title -->
              <span class="nav__sub-title">Backend</span>
              <hr>
        

        
        <ul>
          
            <li><a href="/backend/django/">Django</a></li>
          
            <li><a href="/backend/logging/">Logging</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <!-- title -->
              <span class="nav__sub-title">Python</span>
              <hr>
        

        
        <ul>
          
            <li><a href="/python/pep/">PEP</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <!-- title -->
              <span class="nav__sub-title">AI/ML</span>
              <hr>
        

        
        <ul>
          
            <li><a href="/ai/llm/">LLM</a></li>
          
            <li><a href="/ai/review/">Review</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <!-- title -->
              <span class="nav__sub-title">DevOps</span>
              <hr>
        

        
        <ul>
          
            <li><a href="/devops/nginx/">Nginx</a></li>
          
            <li><a href="/devops/docker/">Docker</a></li>
          
            <li><a href="/devops/safeline/">SafeLine</a></li>
          
            <li><a href="/devops/jenkins/">Jenkins</a></li>
          
            <li><a href="/devops/github-actions/">GitHub Actions</a></li>
          
            <li><a href="/devops/aws/">AWS</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <!-- title -->
              <span class="nav__sub-title">etc</span>
              <hr>
        

        
        <ul>
          
            <li><a href="/etc/me/">Me</a></li>
          
            <li><a href="/etc/chrome-extension/">Chrome Extension</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="[Final] PEP 343 - The “with” Statement">
    <meta itemprop="description" content="Python Enhancement Proposal 343: ‘The “with” Statement’에 대한 한국어 번역입니다.">
    <meta itemprop="datePublished" content="2025-09-27T01:01:20+09:00">
    <meta itemprop="dateModified" content="2025-09-27T01:01:20+09:00">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">[Final] PEP 343 - The “with” Statement
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        <time datetime="2025-09-27T01:01:20+09:00">September 27, 2025</time>
      </span>
    

    

    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#pep-343--with-문">PEP 343 – with 문</a><ul><li><a href="#초록-abstract">초록 (Abstract)</a></li><li><a href="#작성자-주-authors-note">작성자 주 (Author’s Note)</a></li><li><a href="#서론-introduction">서론 (Introduction)</a></li><li><a href="#동기-및-요약-motivation-and-summary">동기 및 요약 (Motivation and Summary)</a></li><li><a href="#사용-사례-use-cases">사용 사례 (Use Cases)</a></li><li><a href="#사양-with-문-specification-the-with-statement">사양: with 문 (Specification: The ‘with’ Statement)</a></li><li><a href="#전환-계획-transition-plan">전환 계획 (Transition Plan)</a></li><li><a href="#제너레이터-데코레이터-generator-decorator">제너레이터 데코레이터 (Generator Decorator)</a></li><li><a href="#표준-라이브러리의-컨텍스트-매니저-context-managers-in-the-standard-library">표준 라이브러리의 컨텍스트 매니저 (Context Managers in the Standard Library)</a></li><li><a href="#표준-용어-standard-terminology">표준 용어 (Standard Terminology)</a></li><li><a href="#컨텍스트-매니저-캐싱-caching-context-managers">컨텍스트 매니저 캐싱 (Caching Context Managers)</a></li><li><a href="#해결된-문제-resolved-issues">해결된 문제 (Resolved Issues)</a></li><li><a href="#거부된-옵션-rejected-options">거부된 옵션 (Rejected Options)</a></li><li><a href="#예시-examples">예시 (Examples)</a></li><li><a href="#참조-구현-reference-implementation">참조 구현 (Reference Implementation)</a></li><li><a href="#감사의-글-acknowledgements">감사의 글 (Acknowledgements)</a></li><li><a href="#참조-references">참조 (References)</a></li><li><a href="#저작권-copyright">저작권 (Copyright)</a></li></ul></li></ul>

            </nav>
          </aside>
        
        <blockquote>
  <p><strong>원문 링크:</strong> <a href="https://peps.python.org/pep-0343/">PEP 343 - The “with” Statement</a></p>

  <table>
    <tbody>
      <tr>
        <td><strong>상태:</strong> Final</td>
        <td><strong>유형:</strong> Standards Track</td>
        <td><strong>작성일:</strong> 13-May-2005</td>
      </tr>
    </tbody>
  </table>
</blockquote>

<h2 id="pep-343--with-문">PEP 343 – <code class="language-plaintext highlighter-rouge">with</code> 문</h2>

<h3 id="초록-abstract">초록 (Abstract)</h3>
<p>이 PEP(Python Enhancement Proposal)는 Python 언어에 새로운 <code class="language-plaintext highlighter-rouge">with</code> 문을 추가하여, <code class="language-plaintext highlighter-rouge">try/finally</code> 문의 표준적인 사용 패턴을 간결하게 만들 수 있도록 합니다.
<code class="language-plaintext highlighter-rouge">with</code> 문 내에서, <strong>컨텍스트 매니저(context manager)</strong>는 <code class="language-plaintext highlighter-rouge">with</code> 문 본문으로 진입하고 종료할 때 호출되는 <code class="language-plaintext highlighter-rouge">__enter__()</code> 및 <code class="language-plaintext highlighter-rouge">__exit__()</code> 메서드를 제공합니다.</p>

<h3 id="작성자-주-authors-note">작성자 주 (Author’s Note)</h3>
<p>이 PEP는 원래 Guido van Rossum에 의해 작성되었으며, 이후 python-dev에서 논의된 내용을 반영하여 Alyssa (Nick) Coghlan이 업데이트했습니다. Python 2.5 알파 릴리스 주기 동안 이 PEP의 용어와 관련 문서 및 구현에서 문제점이 발견되었고, 첫 번째 Python 2.5 베타 릴리스 시점에 PEP가 안정화되었습니다.</p>

<h3 id="서론-introduction">서론 (Introduction)</h3>
<p>PEP 340 및 대안에 대한 많은 논의 끝에, Guido는 PEP 340을 철회하고 PEP 310의 약간 수정된 버전을 제안했습니다. 추가 논의 후, 일시 중지된 제너레이터(generator)에서 예외를 발생시키기 위한 <code class="language-plaintext highlighter-rouge">throw()</code> 메서드와 새로운 <code class="language-plaintext highlighter-rouge">GeneratorExit</code> 예외를 발생시키는 <code class="language-plaintext highlighter-rouge">close()</code> 메서드가 다시 추가되었습니다. 이 변경 사항들은 python-dev에서 처음 제안되어 만장일치로 승인되었습니다. 또한, 키워드가 <code class="language-plaintext highlighter-rouge">with</code>로 변경되었습니다.</p>

<p>이 PEP가 채택된 후, 다음과 같은 PEP들은 중복으로 인해 기각되었습니다.</p>
<ul>
  <li><strong>PEP 310, Reliable Acquisition/Release Pairs:</strong> <code class="language-plaintext highlighter-rouge">with</code> 문에 대한 원래 제안이었습니다.</li>
  <li><strong>PEP 319, Python Synchronize/Asynchronize Block:</strong> 이 PEP의 사용 사례는 적절한 <code class="language-plaintext highlighter-rouge">with</code> 문 컨트롤러를 제공함으로써 처리될 수 있습니다.</li>
</ul>

<p>PEP 340 및 PEP 346도 이 PEP와 중복되었으나, 이 PEP가 제출되면서 자발적으로 철회되었습니다.</p>

<h3 id="동기-및-요약-motivation-and-summary">동기 및 요약 (Motivation and Summary)</h3>
<p>PEP 340(<code class="language-plaintext highlighter-rouge">Anonymous Block Statements</code>)은 제너레이터를 블록 템플릿으로 사용하고, 예외 처리 및 마무리(finalization) 기능을 제너레이터에 추가하는 등 여러 강력한 아이디어를 결합했습니다. 그러나 이는 내부적으로 잠재적인 반복(looping) 구조라는 점 때문에 많은 반대에 부딪혔습니다. 이는 <code class="language-plaintext highlighter-rouge">break</code>와 <code class="language-plaintext highlighter-rouge">continue</code>가 블록 문 내에서 사용될 경우, 자원 관리 도구로 사용되더라도 블록 문을 깨거나 계속 진행시킬 수 있음을 의미했습니다.</p>

<p>결정적인 계기는 Raymond Chen의 흐름 제어 매크로에 대한 비판을 읽은 후였습니다. Raymond는 매크로에 흐름 제어를 숨기는 것이 코드를 이해하기 어렵게 만든다고 주장했으며, Guido는 이 주장이 C뿐만 아니라 Python에도 적용된다고 생각했습니다. PEP 340 템플릿이 모든 종류의 제어 흐름을 숨길 수 있음을 깨달은 것입니다.</p>

<p>반면, PEP 310의 <code class="language-plaintext highlighter-rouge">with</code> 문은 흐름 제어를 숨기지 않습니다. <code class="language-plaintext highlighter-rouge">finally</code> 스위트(suite)가 일시적으로 흐름을 중단시키더라도, 결국에는 <code class="language-plaintext highlighter-rouge">finally</code> 스위트가 없었던 것처럼 흐름이 재개됩니다.</p>

<p>PEP 310은 대략 다음과 같은 구문을 제안했습니다. ( <code class="language-plaintext highlighter-rouge">VAR =</code> 부분은 선택 사항입니다.)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">VAR</span> <span class="o">=</span> <span class="n">EXPR</span><span class="p">:</span>
    <span class="n">BLOCK</span>
</code></pre></div></div>
<p>이는 대략 다음과 같이 번역됩니다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">VAR</span> <span class="o">=</span> <span class="n">EXPR</span>
<span class="n">VAR</span><span class="p">.</span><span class="nf">__enter__</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">BLOCK</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">VAR</span><span class="p">.</span><span class="nf">__exit__</span><span class="p">()</span>
</code></pre></div></div>

<p>이러한 접근 방식은 <code class="language-plaintext highlighter-rouge">BLOCK</code> 내에서 예외가 발생하거나 <code class="language-plaintext highlighter-rouge">break</code>, <code class="language-plaintext highlighter-rouge">continue</code>, <code class="language-plaintext highlighter-rouge">return</code>과 같은 비지역적 <code class="language-plaintext highlighter-rouge">goto</code>가 실행될 경우, <code class="language-plaintext highlighter-rouge">finally</code> 절이 여전히 실행되도록 보장합니다.</p>

<p>이 아이디어는 Guido가 PEP 310을 지지하도록 이끌었지만, PEP 340의 제너레이터를 ‘템플릿’으로 사용하여 잠금 획득 및 해제 또는 파일 열기 및 닫기와 같은 추상화를 구현하는 강력한 아이디어를 포기할 수 없었습니다.</p>

<p>Phillip Eby의 PEP 340에 대한 반대 제안에 영감을 받아, 적절한 제너레이터를 필요한 <code class="language-plaintext highlighter-rouge">__enter__()</code> 및 <code class="language-plaintext highlighter-rouge">__exit__()</code> 메서드를 가진 객체로 변환하는 데코레이터를 만들려고 시도했습니다. 여기서 문제에 부딪혔는데, 잠금(locking) 예시에서는 어렵지 않았지만, 파일 열기 예시에서는 불가능했습니다.</p>

<p>해결책은 <code class="language-plaintext highlighter-rouge">VAR</code>가 <code class="language-plaintext highlighter-rouge">__enter__()</code> 메서드 호출의 결과를 받도록 하고, <code class="language-plaintext highlighter-rouge">EXPR</code>의 값을 저장하여 나중에 <code class="language-plaintext highlighter-rouge">__exit__()</code> 메서드를 호출하는 방식으로 번역을 약간 변경하는 것이었습니다. 이렇게 하면 제너레이터를 컨텍스트 매니저로 변환하는 데코레이터를 쉽게 작성할 수 있게 됩니다.</p>

<p>이후 <code class="language-plaintext highlighter-rouge">with VAR = EXPR:</code> 구문이 <code class="language-plaintext highlighter-rouge">VAR</code>가 <code class="language-plaintext highlighter-rouge">EXPR</code>의 값을 직접 받지 않는다는 점에서 오해의 소지가 있다는 논의가 있었습니다. PEP 340에서 아이디어를 빌려와 <code class="language-plaintext highlighter-rouge">with EXPR as VAR:</code> 구문이 채택되었습니다.</p>

<p>추가 논의를 통해, 제너레이터 내에서 예외를 ‘볼’ 수 있는 기능(<code class="language-plaintext highlighter-rouge">throw()</code> 메서드)이 중요하다고 판단되었습니다. 이는 <code class="language-plaintext highlighter-rouge">with</code> 문이 루프처럼 사용되는 것을 방지하면서도 예외 로깅 등을 가능하게 합니다. 또한, 제너레이터가 가비지 컬렉션될 때 자동으로 호출되는 <code class="language-plaintext highlighter-rouge">close()</code> 메서드도 제안되었으며, 이는 특별한 <code class="language-plaintext highlighter-rouge">GeneratorExit</code> 예외를 발생시킵니다.</p>

<p>이러한 변경 사항들을 통해 <code class="language-plaintext highlighter-rouge">try-finally</code> 문 내에서 <code class="language-plaintext highlighter-rouge">yield</code> 문을 허용할 수 있게 되었고, <code class="language-plaintext highlighter-rouge">finally</code> 절이 (결국) 실행될 것을 보장할 수 있게 되었습니다. (제너레이터에 대한 자세한 변경 사항은 PEP 342에서 다룹니다.)</p>

<h3 id="사용-사례-use-cases">사용 사례 (Use Cases)</h3>
<p>자세한 내용은 마지막의 “예시” 섹션을 참조하십시오.</p>

<h3 id="사양-with-문-specification-the-with-statement">사양: <code class="language-plaintext highlighter-rouge">with</code> 문 (Specification: The ‘with’ Statement)</h3>
<p>다음과 같은 구문의 새로운 문이 제안됩니다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">EXPR</span> <span class="k">as</span> <span class="n">VAR</span><span class="p">:</span>
    <span class="n">BLOCK</span>
</code></pre></div></div>
<p>여기서 <code class="language-plaintext highlighter-rouge">with</code>와 <code class="language-plaintext highlighter-rouge">as</code>는 새로운 키워드입니다. <code class="language-plaintext highlighter-rouge">EXPR</code>은 임의의 표현식이며, <code class="language-plaintext highlighter-rouge">VAR</code>는 단일 할당 대상입니다. <code class="language-plaintext highlighter-rouge">VAR</code>는 쉼표로 구분된 변수 시퀀스가 될 수 없지만, 괄호로 묶인 쉼표로 구분된 변수 시퀀스는 가능합니다. (<code class="language-plaintext highlighter-rouge">as VAR</code> 부분은 선택 사항입니다.)</p>

<p>위 문의 번역은 다음과 같습니다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mgr</span> <span class="o">=</span> <span class="p">(</span><span class="n">EXPR</span><span class="p">)</span>
<span class="nb">exit</span> <span class="o">=</span> <span class="nf">type</span><span class="p">(</span><span class="n">mgr</span><span class="p">).</span><span class="n">__exit__</span> <span class="c1"># 아직 호출하지 않음
</span><span class="n">value</span> <span class="o">=</span> <span class="nf">type</span><span class="p">(</span><span class="n">mgr</span><span class="p">).</span><span class="nf">__enter__</span><span class="p">(</span><span class="n">mgr</span><span class="p">)</span>
<span class="n">exc</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">VAR</span> <span class="o">=</span> <span class="n">value</span> <span class="c1"># "as VAR"가 있는 경우에만
</span>        <span class="n">BLOCK</span>
    <span class="k">except</span><span class="p">:</span> <span class="c1"># 예외 발생 시 처리
</span>        <span class="n">exc</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nf">exit</span><span class="p">(</span><span class="n">mgr</span><span class="p">,</span> <span class="o">*</span><span class="n">sys</span><span class="p">.</span><span class="nf">exc_info</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="c1"># exit()가 True를 반환하면 예외는 삼켜짐
</span>    <span class="k">finally</span><span class="p">:</span> <span class="c1"># 정상 및 비지역적 goto의 경우 처리
</span>        <span class="k">if</span> <span class="n">exc</span><span class="p">:</span>
            <span class="nf">exit</span><span class="p">(</span><span class="n">mgr</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>
<p>여기서 소문자 변수(mgr, exit, value, exc)는 내부 변수이며 사용자에게는 접근할 수 없습니다. 이는 주로 특별한 레지스터 또는 스택 위치로 구현될 것입니다.</p>

<p><code class="language-plaintext highlighter-rouge">mgr.__exit__()</code>의 호출 규칙은 다음과 같습니다.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">BLOCK</code>의 정상 완료 또는 비지역적 <code class="language-plaintext highlighter-rouge">goto</code>(<code class="language-plaintext highlighter-rouge">break</code>, <code class="language-plaintext highlighter-rouge">continue</code>, <code class="language-plaintext highlighter-rouge">return</code>)를 통해 <code class="language-plaintext highlighter-rouge">finally</code> 스위트에 도달한 경우, <code class="language-plaintext highlighter-rouge">mgr.__exit__()</code>는 세 개의 <code class="language-plaintext highlighter-rouge">None</code> 인자와 함께 호출됩니다.</li>
  <li><code class="language-plaintext highlighter-rouge">BLOCK</code>에서 발생한 예외를 통해 <code class="language-plaintext highlighter-rouge">finally</code> 스위트에 도달한 경우, <code class="language-plaintext highlighter-rouge">mgr.__exit__()</code>는 예외 유형, 값, 트레이스백을 나타내는 세 개의 인자와 함께 호출됩니다.</li>
</ul>

<p><strong>중요:</strong> <code class="language-plaintext highlighter-rouge">mgr.__exit__()</code>가 “참(true)” 값을 반환하면 예외는 “삼켜집니다(swallowed)”. 즉, <code class="language-plaintext highlighter-rouge">with</code> 문 내에서 예외가 발생했더라도 <code class="language-plaintext highlighter-rouge">exit()</code>가 <code class="language-plaintext highlighter-rouge">True</code>를 반환하면 <code class="language-plaintext highlighter-rouge">with</code> 문 다음 문에서 실행이 계속됩니다. 그러나 <code class="language-plaintext highlighter-rouge">with</code> 문이 비지역적 <code class="language-plaintext highlighter-rouge">goto</code>(<code class="language-plaintext highlighter-rouge">break</code>, <code class="language-plaintext highlighter-rouge">continue</code>, <code class="language-plaintext highlighter-rouge">return</code>)를 통해 종료된 경우, <code class="language-plaintext highlighter-rouge">mgr.__exit__()</code>의 반환 값과 관계없이 이 비지역적 반환이 재개됩니다. 이는 <code class="language-plaintext highlighter-rouge">mgr.__exit__()</code>가 예외를 삼킬 수 있도록 하면서도, 기본 반환 값인 <code class="language-plaintext highlighter-rouge">None</code>이 거짓(false)이므로 예외가 다시 발생하도록 하여 예외 삼키기를 너무 쉽게 만들지 않기 위함입니다.</p>

<p><code class="language-plaintext highlighter-rouge">__exit__()</code>에 예외 세부 정보를 전달하는 동기는 트랜잭션(<code class="language-plaintext highlighter-rouge">transactional()</code>) 사용 사례(아래 예시 3)에서 비롯되었습니다. 이 예시의 템플릿은 예외 발생 여부에 따라 트랜잭션을 커밋하거나 롤백해야 합니다.</p>

<p><code class="language-plaintext highlighter-rouge">__exit__()</code> 메서드는 전달된 오류를 다시 발생시키지 않아야 합니다. 오류를 다시 발생시키는 것은 항상 <code class="language-plaintext highlighter-rouge">__exit__()</code> 메서드를 호출하는 호출자의 책임입니다.</p>

<h3 id="전환-계획-transition-plan">전환 계획 (Transition Plan)</h3>
<p>Python 2.5에서는 <code class="language-plaintext highlighter-rouge">from __future__ import with_statement</code> 미래 문이 있을 경우에만 새로운 구문이 인식됩니다. 이 경우 <code class="language-plaintext highlighter-rouge">with</code>와 <code class="language-plaintext highlighter-rouge">as</code>가 키워드가 됩니다. 미래 문이 없으면 <code class="language-plaintext highlighter-rouge">with</code> 또는 <code class="language-plaintext highlighter-rouge">as</code>를 식별자로 사용하면 <code class="language-plaintext highlighter-rouge">stderr</code>에 경고가 발행됩니다.
Python 2.6에서는 새로운 구문이 항상 인식되며, <code class="language-plaintext highlighter-rouge">with</code>와 <code class="language-plaintext highlighter-rouge">as</code>는 항상 키워드입니다.</p>

<h3 id="제너레이터-데코레이터-generator-decorator">제너레이터 데코레이터 (Generator Decorator)</h3>
<p>PEP 342가 채택되면서, 정확히 한 번 <code class="language-plaintext highlighter-rouge">yield</code>하는 제너레이터를 사용하여 <code class="language-plaintext highlighter-rouge">with</code> 문을 제어하는 데코레이터를 작성할 수 있게 되었습니다. <code class="language-plaintext highlighter-rouge">GeneratorContextManager</code> 클래스를 사용하여 제너레이터 함수를 컨텍스트 매니저 팩토리로 변환하는 <code class="language-plaintext highlighter-rouge">contextmanager</code> 데코레이터를 구현할 수 있습니다.</p>

<p>강력한 구현은 표준 라이브러리의 일부가 될 것입니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># GeneratorContextManager 및 contextmanager 데코레이터의 스케치
</span><span class="k">class</span> <span class="nc">GeneratorContextManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">gen</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">gen</span> <span class="o">=</span> <span class="n">gen</span>
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">gen</span><span class="p">.</span><span class="nf">next</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">RuntimeError</span><span class="p">(</span><span class="sh">"</span><span class="s">generator didn</span><span class="sh">'</span><span class="s">t yield</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">gen</span><span class="p">.</span><span class="nf">next</span><span class="p">()</span>
            <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">RuntimeError</span><span class="p">(</span><span class="sh">"</span><span class="s">generator didn</span><span class="sh">'</span><span class="s">t stop</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">gen</span><span class="p">.</span><span class="nf">throw</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span>
                <span class="k">raise</span> <span class="nc">RuntimeError</span><span class="p">(</span><span class="sh">"</span><span class="s">generator didn</span><span class="sh">'</span><span class="s">t stop after throw()</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># throw() 프로토콜과 __exit__() 프로토콜 간의 불일치 해결
</span>                <span class="c1"># __exit__() 자체에 실패하지 않는 한 예외를 발생시키지 않아야 함
</span>                <span class="k">pass</span> <span class="c1"># (원문에는 주석 처리된 raise 조건이 있으나, 스케치이므로 간략화)
</span>
<span class="k">def</span> <span class="nf">contextmanager</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">helper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">return</span> <span class="nc">GeneratorContextManager</span><span class="p">(</span><span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">helper</span>
</code></pre></div></div>
<p>이 데코레이터는 다음과 같이 사용될 수 있습니다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">opening</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">f</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="표준-라이브러리의-컨텍스트-매니저-context-managers-in-the-standard-library">표준 라이브러리의 컨텍스트 매니저 (Context Managers in the Standard Library)</h3>
<p>파일, 소켓, 잠금(lock)과 같은 특정 객체에 <code class="language-plaintext highlighter-rouge">__enter__()</code> 및 <code class="language-plaintext highlighter-rouge">__exit__()</code> 메서드를 부여하여 직접 <code class="language-plaintext highlighter-rouge">with</code> 문에서 사용할 수 있도록 할 수 있습니다.
예를 들어, <code class="language-plaintext highlighter-rouge">with locking(myLock): BLOCK</code> 대신 <code class="language-plaintext highlighter-rouge">with myLock: BLOCK</code>와 같이 작성할 수 있습니다.</p>

<p>그러나 이러한 방식은 <code class="language-plaintext highlighter-rouge">f = open(filename); with f: BLOCK1; with f: BLOCK2</code>와 같이 <code class="language-plaintext highlighter-rouge">f</code>가 <code class="language-plaintext highlighter-rouge">BLOCK2</code>에 진입하기 전에 닫히는 오해를 불러일으킬 수 있으므로 주의해야 합니다. 이러한 실수는 쉽게 진단할 수 있습니다.</p>

<p>Python 2.5에서는 다음 유형들이 컨텍스트 매니저로 식별되었습니다.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">file</code></li>
  <li><code class="language-plaintext highlighter-rouge">thread.LockType</code></li>
  <li><code class="language-plaintext highlighter-rouge">threading.Lock</code></li>
  <li><code class="language-plaintext highlighter-rouge">threading.RLock</code></li>
  <li><code class="language-plaintext highlighter-rouge">threading.Condition</code></li>
  <li><code class="language-plaintext highlighter-rouge">threading.Semaphore</code></li>
  <li><code class="language-plaintext highlighter-rouge">threading.BoundedSemaphore</code></li>
</ul>

<p><code class="language-plaintext highlighter-rouge">decimal</code> 모듈에도 <code class="language-plaintext highlighter-rouge">with</code> 문 본문 내에서 지역 십진수 산술 컨텍스트를 지원하고, <code class="language-plaintext highlighter-rouge">with</code> 문을 종료할 때 원래 컨텍스트를 자동으로 복원하는 컨텍스트 매니저가 추가될 것입니다.</p>

<h3 id="표준-용어-standard-terminology">표준 용어 (Standard Terminology)</h3>
<p>이 PEP는 <code class="language-plaintext highlighter-rouge">__enter__()</code> 및 <code class="language-plaintext highlighter-rouge">__exit__()</code> 메서드로 구성된 프로토콜을 “<strong>컨텍스트 관리 프로토콜(context management protocol)</strong>“이라고 부르고, 이 프로토콜을 구현하는 객체를 “<strong>컨텍스트 매니저(context manager)</strong>“라고 부를 것을 제안합니다.</p>

<p><code class="language-plaintext highlighter-rouge">with</code> 키워드 바로 뒤에 오는 표현식은 “컨텍스트 표현식(context expression)”이며, 이는 <code class="language-plaintext highlighter-rouge">with</code> 문 본문 기간 동안 컨텍스트 매니저가 설정하는 런타임 환경에 대한 주요 단서를 제공합니다.</p>

<h3 id="컨텍스트-매니저-캐싱-caching-context-managers">컨텍스트 매니저 캐싱 (Caching Context Managers)</h3>
<p>많은 컨텍스트 매니저(예: 파일 및 제너레이터 기반 컨텍스트)는 한 번만 사용되는 객체입니다. <code class="language-plaintext highlighter-rouge">__exit__()</code> 메서드가 호출되면 컨텍스트 매니저는 더 이상 사용 가능한 상태가 아닙니다.</p>

<p>각 <code class="language-plaintext highlighter-rouge">with</code> 문마다 새로운 매니저 객체를 요구하는 것이 멀티스레드 코드 및 중첩된 <code class="language-plaintext highlighter-rouge">with</code> 문에서 동일한 컨텍스트 매니저를 사용하려 할 때 발생하는 문제를 피하는 가장 쉬운 방법입니다. 재사용을 지원하는 모든 표준 라이브러리 컨텍스트 매니저가 <code class="language-plaintext highlighter-rouge">threading</code> 모듈에서 비롯되었다는 것은 우연이 아닙니다.</p>

<h3 id="해결된-문제-resolved-issues">해결된 문제 (Resolved Issues)</h3>
<p>다음 문제들은 BDFL(Benevolent Dictator For Life)의 승인과 python-dev에서의 주요 반대 의견 부족으로 해결되었습니다.</p>
<ul>
  <li><strong>제너레이터-이터레이터가 오작동할 때 <code class="language-plaintext highlighter-rouge">GeneratorContextManager</code>는 어떤 예외를 발생시켜야 하는가?</strong> Guido는 이 경우와 PEP 342의 제너레이터 <code class="language-plaintext highlighter-rouge">close()</code> 메서드 모두에 대해 <code class="language-plaintext highlighter-rouge">RuntimeError</code>를 선택했습니다. <code class="language-plaintext highlighter-rouge">RuntimeError</code>는 프로그래머가 코드를 수정하도록 유도하는 데 적합하며, 무한 재귀 감지 등 핵심 Python 코드에서 이미 사용되는 선례가 있습니다.</li>
  <li><code class="language-plaintext highlighter-rouge">with</code> 문에 관련된 클래스에 해당 메서드가 없을 경우 <code class="language-plaintext highlighter-rouge">TypeError</code> 대신 <code class="language-plaintext highlighter-rouge">AttributeError</code>를 발생시키는 것이 허용됩니다.</li>
  <li><code class="language-plaintext highlighter-rouge">__enter__/__exit__</code> 메서드를 가진 객체는 “컨텍스트 매니저”라고 불리며, 제너레이터 함수를 컨텍스트 매니저 팩토리로 변환하는 데코레이터는 <code class="language-plaintext highlighter-rouge">contextlib.contextmanager</code>입니다.</li>
</ul>

<h3 id="거부된-옵션-rejected-options">거부된 옵션 (Rejected Options)</h3>
<ul>
  <li><strong>예외 억제 금지:</strong> 초기에는 숨겨진 흐름 제어를 피하기 위해 예외 억제가 금지되었으나, 구현상의 어려움으로 인해 Guido는 예외 억제 기능을 복원했습니다.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">__context__()</code> 메서드:</strong> 이터러블의 <code class="language-plaintext highlighter-rouge">__iter__()</code> 메서드와 유사한 <code class="language-plaintext highlighter-rouge">__context__()</code> 메서드를 추가하자는 제안이 있었으나, 설명 및 작동 방식에 대한 지속적인 문제로 인해 Guido는 이 개념을 완전히 제거했습니다.</li>
  <li><strong>PEP 342 제너레이터 API 직접 사용:</strong> <code class="language-plaintext highlighter-rouge">with</code> 문 정의에 PEP 342의 향상된 제너레이터 API를 직접 사용하자는 아이디어도 잠시 고려되었으나, 제너레이터 기반이 아닌 컨텍스트 매니저 작성을 너무 어렵게 만든다는 이유로 빠르게 기각되었습니다.</li>
</ul>

<h3 id="예시-examples">예시 (Examples)</h3>
<p>제너레이터 기반 예시는 PEP 342에 의존합니다. 또한, 일부 예시는 <code class="language-plaintext highlighter-rouge">threading.RLock</code>와 같은 적절한 객체가 <code class="language-plaintext highlighter-rouge">with</code> 문에서 직접 사용될 수 있으므로 실제로는 필요하지 않을 수 있습니다.</p>

<p>예시 컨텍스트의 이름에 사용된 시제는 임의적이지 않습니다. <code class="language-plaintext highlighter-rouge">__enter__</code> 메서드에서 수행되고 <code class="language-plaintext highlighter-rouge">__exit__</code> 메서드에서 되돌려지는 동작을 나타낼 때는 과거 시제(“ -ed “)가 사용됩니다. <code class="language-plaintext highlighter-rouge">__exit__</code> 메서드에서 수행될 동작을 나타낼 때는 현재 진행형 시제(“ -ing “)가 사용됩니다.</p>

<p><strong>1. 잠금(Lock) 보장:</strong> 블록 시작 시 획득한 잠금이 블록을 벗어날 때 해제되도록 보장하는 템플릿입니다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">locked</span><span class="p">(</span><span class="n">lock</span><span class="p">):</span>
    <span class="n">lock</span><span class="p">.</span><span class="nf">acquire</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">lock</span><span class="p">.</span><span class="nf">release</span><span class="p">()</span>

<span class="c1"># 사용 예시:
</span><span class="k">with</span> <span class="nf">locked</span><span class="p">(</span><span class="n">myLock</span><span class="p">):</span>
    <span class="c1"># 이 코드 블록은 myLock이 획득된 상태에서 실행됩니다.
</span>    <span class="c1"># 블록을 벗어날 때 (return 또는 잡히지 않은 예외를 통해서도)
</span>    <span class="c1"># 잠금은 해제되는 것이 보장됩니다.
</span></code></pre></div></div>

<p><strong>2. 파일 열기 및 닫기 보장:</strong> 블록을 벗어날 때 파일이 닫히도록 보장하는 템플릿입니다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">opened</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">f</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

<span class="c1"># 사용 예시:
</span><span class="k">with</span> <span class="nf">opened</span><span class="p">(</span><span class="sh">"</span><span class="s">/etc/passwd</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="nf">rstrip</span><span class="p">())</span>
</code></pre></div></div>

<p><strong>3. 데이터베이스 트랜잭션 커밋 또는 롤백:</strong> 데이터베이스 트랜잭션을 커밋하거나 롤백하는 템플릿입니다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">transaction</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">db</span><span class="p">.</span><span class="nf">begin</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="bp">None</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">db</span><span class="p">.</span><span class="nf">rollback</span><span class="p">()</span>
        <span class="k">raise</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">db</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>4. <code class="language-plaintext highlighter-rouge">locked</code> 예시를 제너레이터 없이 재작성:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">locked</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lock</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">lock</span>
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">lock</span><span class="p">.</span><span class="nf">acquire</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">lock</span><span class="p">.</span><span class="nf">release</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>5. 표준 출력(stdout) 일시적으로 리디렉션:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">stdout_redirected</span><span class="p">(</span><span class="n">new_stdout</span><span class="p">):</span>
    <span class="n">save_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">new_stdout</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="bp">None</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">save_stdout</span>

<span class="c1"># 사용 예시:
</span><span class="k">with</span> <span class="nf">opened</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">with</span> <span class="nf">stdout_redirected</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Hello world</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>6. 오류 조건도 반환하는 <code class="language-plaintext highlighter-rouge">opened()</code> 변형:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">opened_w_error</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">IOError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">yield</span> <span class="bp">None</span><span class="p">,</span> <span class="n">err</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">f</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

<span class="c1"># 사용 예시:
</span><span class="k">with</span> <span class="nf">opened_w_error</span><span class="p">(</span><span class="sh">"</span><span class="s">/etc/passwd</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">)</span> <span class="nf">as </span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">err</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">IOError:</span><span class="sh">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="s">guido::0:0::/:/bin/sh</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>7. <code class="language-plaintext highlighter-rouge">decimal</code> 모듈의 추가 정밀도 컨텍스트:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">decimal</span>
<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">extra_precision</span><span class="p">(</span><span class="n">places</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">decimal</span><span class="p">.</span><span class="nf">getcontext</span><span class="p">()</span>
    <span class="n">saved_prec</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">prec</span>
    <span class="n">c</span><span class="p">.</span><span class="n">prec</span> <span class="o">+=</span> <span class="n">places</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="bp">None</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">c</span><span class="p">.</span><span class="n">prec</span> <span class="o">=</span> <span class="n">saved_prec</span>

<span class="c1"># 사용 예시:
</span><span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">with</span> <span class="nf">extra_precision</span><span class="p">():</span>
        <span class="c1"># ... 사인 계산 로직 ...
</span>        <span class="k">return</span> <span class="o">+</span><span class="n">s</span>
</code></pre></div></div>

<p><strong>8. <code class="language-plaintext highlighter-rouge">decimal</code> 모듈의 지역 컨텍스트 매니저:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">decimal</span> <span class="kn">import</span> <span class="n">localcontext</span><span class="p">,</span> <span class="n">ExtendedContext</span>
<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">localcontext</span><span class="p">(</span><span class="n">ctx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Set a new local decimal context for the block</span><span class="sh">"""</span>
    <span class="c1"># ... 구현 ...
</span>
<span class="c1"># 사용 예시:
</span><span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">with</span> <span class="nf">localcontext</span><span class="p">()</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
        <span class="n">ctx</span><span class="p">.</span><span class="n">prec</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="c1"># ... 사인 계산 로직 ...
</span>        <span class="k">return</span> <span class="o">+</span><span class="n">s</span>
</code></pre></div></div>

<p><strong>9. 제네릭 “객체 닫기” 컨텍스트 매니저 (<code class="language-plaintext highlighter-rouge">closing</code>):</strong> <code class="language-plaintext highlighter-rouge">close</code> 메서드를 가진 모든 객체를 확정적으로 닫는 데 사용됩니다. (Python 2.5의 <code class="language-plaintext highlighter-rouge">contextlib</code> 모듈에 이 컨텍스트 매니저 버전이 포함되어 있습니다.)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">closing</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">obj</span>
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="n">exc_info</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">close_it</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">obj</span><span class="p">.</span><span class="n">close</span>
        <span class="k">except</span> <span class="nb">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">close_it</span><span class="p">()</span>

<span class="c1"># 사용 예시:
</span><span class="k">with</span> <span class="nf">closing</span><span class="p">(</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">argument.txt</span><span class="sh">"</span><span class="p">))</span> <span class="k">as</span> <span class="n">contradiction</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contradiction</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>10. 잠금을 일시적으로 해제하는 <code class="language-plaintext highlighter-rouge">released()</code> 컨텍스트:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">released</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lock</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">lock</span>
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">lock</span><span class="p">.</span><span class="nf">release</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">lock</span><span class="p">.</span><span class="nf">acquire</span><span class="p">()</span>

<span class="c1"># 사용 예시:
</span><span class="k">with</span> <span class="n">my_lock</span><span class="p">:</span>
    <span class="c1"># 잠금이 획득된 상태에서의 작업
</span>    <span class="k">with</span> <span class="nf">released</span><span class="p">(</span><span class="n">my_lock</span><span class="p">):</span>
        <span class="c1"># 잠금 없이 작업
</span>        <span class="c1"># 예: 블로킹 I/O
</span>    <span class="c1"># 잠금이 다시 획득된 상태
</span></code></pre></div></div>

<p><strong>11. 여러 컨텍스트를 자동으로 중첩하는 <code class="language-plaintext highlighter-rouge">nested</code> 컨텍스트 매니저:</strong> 과도한 들여쓰기를 피하기 위해 제공된 컨텍스트를 왼쪽에서 오른쪽으로 자동 중첩합니다. (Python 2.5의 <code class="language-plaintext highlighter-rouge">contextlib</code> 모듈에 이 컨텍스트 매니저 버전이 포함되어 있습니다.)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">nested</span><span class="p">(</span><span class="o">*</span><span class="n">contexts</span><span class="p">):</span>
    <span class="c1"># ... 구현 ...
</span>
<span class="c1"># 사용 예시:
</span><span class="k">with</span> <span class="nf">nested</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="nf">as </span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="c1"># 작업 수행
</span>
<span class="c1"># 위 코드는 다음 코드와 동일합니다.
</span><span class="k">with</span> <span class="n">a</span> <span class="k">as</span> <span class="n">x</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">b</span> <span class="k">as</span> <span class="n">y</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">c</span> <span class="k">as</span> <span class="n">z</span><span class="p">:</span>
            <span class="c1"># 작업 수행
</span></code></pre></div></div>

<h3 id="참조-구현-reference-implementation">참조 구현 (Reference Implementation)</h3>
<p>이 PEP는 2005년 6월 27일 EuroPython 기조연설에서 Guido에 의해 처음 수락되었습니다. <code class="language-plaintext highlighter-rouge">__context__</code> 메서드가 추가된 후 다시 수락되었습니다. 이 PEP는 Python 2.5a1을 위해 Subversion에 구현되었고, <code class="language-plaintext highlighter-rouge">__context__()</code> 메서드는 Python 2.5b1에서 제거되었습니다.</p>

<h3 id="감사의-글-acknowledgements">감사의 글 (Acknowledgements)</h3>
<p>PEP 340 및 PEP 346의 감사의 글에 언급된 모든 사람들을 포함하여, 이 PEP의 아이디어와 개념에 많은 사람들이 기여했습니다. 추가적으로 Paul Moore, Phillip J. Eby, Greg Ewing, Jason Orendorff, Michael Hudson, Raymond Hettinger, Walter Dörwald, Aahz, Georg Brandl, Terry Reedy, A.M. Kuchling, Brett Cannon, 그리고 python-dev 토론에 참여한 모든 사람들에게 감사드립니다.</p>

<h3 id="참조-references">참조 (References)</h3>
<p>Raymond Chen의 숨겨진 흐름 제어에 대한 글 (https://devblogs.microsoft.com/oldnewthing/20050106-00/?p=36783)
 Guido가 PEP 342에 포함된 제너레이터 변경 사항을 제안 (https://mail.python.org/pipermail/python-dev/2005-May/053885.html)
 PEP 343에 대한 위키 토론 (http://wiki.python.org/moin/WithStatement)
… (이하 생략)</p>

<h3 id="저작권-copyright">저작권 (Copyright)</h3>
<p>이 문서는 퍼블릭 도메인에 공개되었습니다.</p>

<blockquote>
  <p>⚠️ <strong>알림:</strong> 이 문서는 AI를 활용하여 번역되었으며, 기술적 정확성을 보장하지 않습니다. 정확한 내용은 반드시 원문을 확인하시기 바랍니다.</p>
</blockquote>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#pep" class="page__taxonomy-item" rel="tag">PEP</a><span class="sep">, </span>
    
      <a href="/tags/#python" class="page__taxonomy-item" rel="tag">Python</a><span class="sep">, </span>
    
      <a href="/tags/#translation" class="page__taxonomy-item" rel="tag">Translation</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#pep" class="page__taxonomy-item" rel="tag">PEP</a><span class="sep">, </span>
    
      <a href="/categories/#python" class="page__taxonomy-item" rel="tag">Python</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2025-09-27">September 27, 2025</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/python/pep/335/" class="pagination--pager" title="[Rejected] PEP 335 - Overloadable Boolean Operators
">Previous</a>
    
    
      <a href="/python/pep/355/" class="pagination--pager" title="[Rejected] PEP 355 - Path - Object oriented filesystem paths
">Next</a>
    
  </nav>


    </div>

    
  </article>

</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 secrett2633. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    <script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'secrett2633/secrett2633.github.io');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  





  </body>
</html>
