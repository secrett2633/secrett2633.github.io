<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.22.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ko" class="no-js">
  <head>
    <style> 
      ::-webkit-scrollbar{ 
        width: 10px;
        height: 10px;
      }

      ::-webkit-scrollbar-track {
        width: 0px;
        background-color: #626262;
        /* border-radius: 5px; */
      }

      ::-webkit-scrollbar-thumb {
        width: 0px;
        background-color: #E2E2E2;
        border-radius: 5px;
      }

      ::-webkit-scrollbar-thumb:hover {
        width: 10px;
        height: 20px;
        /* background-color: rgba(190, 190, 190, 0.2); */
        background-color: #A2A2A2;
        border-radius: 5px;
      }

      ::-webkit-scrollbar-track:hover {
        width: 10px;
        /* background-color: rgba(150, 150, 150, 0.1); */
        background-color: #626262;
        border-radius: 5px;
        /* background: transparent; */
        /* border-radius: 10px; */
      }

      ::-webkit-scrollbar-button:start:decrement,::-webkit-scrollbar-button:end:increment {
          width:0px;
          height: 0px;
          /* background-color: rgb(14, 221, 24); */
          /* border-radius: 50%; */
      }
    </style>
    
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>[Rejected] PEP 510 - Specialize functions with guards | secrett2633</title>
<meta name="description" content="Python Enhancement Proposal 510: ‘Specialize functions with guards’에 대한 한국어 번역입니다.">


  <meta name="author" content="secrett2633">
  
  <meta property="article:author" content="secrett2633">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="ko_KR">
<meta property="og:site_name" content="secrett2633's blog">
<meta property="og:title" content="[Rejected] PEP 510 - Specialize functions with guards">
<meta property="og:url" content="http://localhost:4000/python/pep/510/">


  <meta property="og:description" content="Python Enhancement Proposal 510: ‘Specialize functions with guards’에 대한 한국어 번역입니다.">







  <meta property="article:published_time" content="2025-09-26T22:55:51+09:00">



  <meta property="article:modified_time" content="2025-09-26T22:55:51+09:00">



  

  


<link rel="canonical" href="http://localhost:4000/python/pep/510/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "secrett2633",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="secrett2633's blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->


    <link rel="icon" type="image/png" sizes="32x32" href="https://secrett2633.github.io/assets/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://secrett2633.github.io/assets/images/favicon/favicon-16x16.png">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          secrett2633's blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://github.com/secrett2633">GitHub</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <!-- 2022.02.17 author content hidden -->
  <!-- <div class="author__content">
    
      <h3 class="author__name" itemprop="name">secrett2633</h3>
    
    
  </div> -->

  <div class="author__urls-wrapper">
    <!-- <button class="btn btn--inverse">Follow</button> -->
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
      
    
    
      <nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    <!-- Backend -->
    <li>
      <span class="nav__sub-title">Backend</span>
      <hr>
      <ul>
        <li><a href="/backend/django/">Django</a></li>
        <li><a href="/backend/logging/">Logging</a></li>
      </ul>
    </li>

    <!-- Python -->
    <li>
      <span class="nav__sub-title">Python</span>
      <hr>
      <ul>
        <li><a href="/python/pep/">PEP</a></li>
      </ul>
    </li>

    <!-- AI/ML -->
    <li>
      <span class="nav__sub-title">AI/ML</span>
      <hr>
      <ul>
        <li><a href="/ai/llm/">LLM</a></li>
        <li><a href="/ai/review/">Review</a></li>
      </ul>
    </li>

    <!-- DevOps -->
    <li>
      <span class="nav__sub-title">DevOps</span>
      <hr>
      <ul>
        <li><a href="/devops/nginx/">Nginx</a></li>
        <li><a href="/devops/docker/">Docker</a></li>
        <li><a href="/devops/safeline/">SafeLine</a></li>
        <li><a href="/devops/jenkins/">Jenkins</a></li>
        <li><a href="/devops/github-actions/">GitHub Actions</a></li>
        <li><a href="/devops/aws/">AWS</a></li>
      </ul>
    </li>

    <!-- etc -->
    <li>
      <span class="nav__sub-title">etc</span>
      <hr>
      <ul>
        <li><a href="/etc/me/">Me</a></li>
        <li><a href="/etc/chrome-extension/">Chrome Extension</a></li>
      </ul>
    </li>
  </ul>
</nav>
    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="[Rejected] PEP 510 - Specialize functions with guards">
    <meta itemprop="description" content="Python Enhancement Proposal 510: ‘Specialize functions with guards’에 대한 한국어 번역입니다.">
    <meta itemprop="datePublished" content="2025-09-26T22:55:51+09:00">
    <meta itemprop="dateModified" content="2025-09-26T22:55:51+09:00">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">[Rejected] PEP 510 - Specialize functions with guards
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        <time datetime="2025-09-26T22:55:51+09:00">September 26, 2025</time>
      </span>
    

    

    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#pep-510--가드guards를-통한-함수-특수화-specialize-functions-with-guards">PEP 510 – 가드(Guards)를 통한 함수 특수화 (Specialize functions with guards)</a><ul><li><a href="#거부-통지-rejection-notice">거부 통지 (Rejection Notice)</a></li><li><a href="#요약-abstract">요약 (Abstract)</a></li><li><a href="#제안-배경-rationale">제안 배경 (Rationale)</a><ul><li><a href="#python의-의미론-python-semantics">Python의 의미론 (Python semantics)</a></li><li><a href="#왜-jit-컴파일러jit-compiler가-아닌가">왜 JIT 컴파일러(JIT compiler)가 아닌가?</a></li></ul></li><li><a href="#예시-examples">예시 (Examples)</a><ul><li><a href="#가상의-myoptimizer-모듈-hypothetical-myoptimizer-module">가상의 myoptimizer 모듈 (Hypothetical myoptimizer module)</a></li><li><a href="#바이트코드-사용-using-bytecode">바이트코드 사용 (Using bytecode)</a></li><li><a href="#내장-함수-사용-using-builtin-function">내장 함수 사용 (Using builtin function)</a></li><li><a href="#특수화된-코드-선택-choose-the-specialized-code">특수화된 코드 선택 (Choose the specialized code)</a></li></ul></li><li><a href="#변경-사항-changes">변경 사항 (Changes)</a><ul><li><a href="#함수-가드-function-guard">함수 가드 (Function guard)</a></li><li><a href="#특수화된-코드-specialized-code">특수화된 코드 (Specialized code)</a></li><li><a href="#함수-메서드-function-methods">함수 메서드 (Function methods)</a></li></ul></li><li><a href="#벤치마크-benchmark">벤치마크 (Benchmark)</a></li><li><a href="#구현-implementation">구현 (Implementation)</a></li><li><a href="#다른-python-구현체-other-implementations-of-python">다른 Python 구현체 (Other implementations of Python)</a></li><li><a href="#논의-discussion">논의 (Discussion)</a></li><li><a href="#저작권-copyright">저작권 (Copyright)</a></li></ul></li></ul>

            </nav>
          </aside>
        
        <blockquote>
  <p><strong>원문 링크:</strong> <a href="https://peps.python.org/pep-0510/">PEP 510 - Specialize functions with guards</a></p>

  <table>
    <tbody>
      <tr>
        <td><strong>상태:</strong> Rejected</td>
        <td><strong>유형:</strong> Standards Track</td>
        <td><strong>작성일:</strong> 04-Jan-2016</td>
      </tr>
    </tbody>
  </table>
</blockquote>

<h2 id="pep-510--가드guards를-통한-함수-특수화-specialize-functions-with-guards">PEP 510 – 가드(Guards)를 통한 함수 특수화 (Specialize functions with guards)</h2>

<ul>
  <li><strong>작성자</strong>: Victor Stinner</li>
  <li><strong>상태</strong>: <strong>거부됨 (Rejected)</strong></li>
  <li><strong>유형</strong>: Standards Track</li>
  <li><strong>작성일</strong>: 2016년 1월 4일</li>
  <li><strong>Python 버전</strong>: 3.6</li>
</ul>

<hr />

<h3 id="거부-통지-rejection-notice">거부 통지 (Rejection Notice)</h3>

<p>이 PEP는 저자에 의해 거부되었습니다. 제안된 설계가 눈에 띄는 속도 향상을 보여주지 못했으며, 가장 발전되고 복잡한 최적화를 구현할 시간이 부족했기 때문입니다.</p>

<h3 id="요약-abstract">요약 (Abstract)</h3>

<p>이 PEP는 순수 Python 함수를 특수화(specialize)하기 위해 Python C API에 함수를 추가하는 것을 제안합니다. 이는 가드(guards)를 사용하여 특수화된 코드(specialized codes)를 추가하는 것으로, Python의 의미론(semantics)을 준수하면서 정적 최적화 도구를 구현할 수 있게 합니다.</p>

<h3 id="제안-배경-rationale">제안 배경 (Rationale)</h3>

<h4 id="python의-의미론-python-semantics">Python의 의미론 (Python semantics)</h4>

<p>Python은 거의 모든 것이 변경 가능(mutable)하기 때문에 최적화하기 어렵습니다. 내장 함수(builtin functions), 함수 코드, 전역 변수(global variables), 지역 변수(local variables) 등이 런타임에 수정될 수 있습니다. Python의 의미론을 존중하면서 최적화를 구현하려면 “무언가가 변경되었을 때”를 감지해야 하며, 이러한 검사를 “가드(guards)”라고 부릅니다.</p>

<p>이 PEP는 함수에 가드를 가진 특수화된 코드를 추가하기 위한 공개 API를 Python C API에 추가할 것을 제안합니다. 함수가 호출될 때, 아무것도 변경되지 않았다면 특수화된 코드가 사용되고, 그렇지 않으면 원래의 바이트코드(bytecode)가 사용됩니다.</p>

<p>가드가 Python의 의미론 대부분을 준수하는 데 도움이 되지만, 정확한 동작에 미묘한 변경 없이 Python을 최적화하기는 어렵습니다. CPython은 오랜 역사를 가지고 있으며 많은 애플리케이션이 구현 세부 사항에 의존하고 있습니다. “모든 것이 변경 가능”이라는 특성과 성능 사이에서 타협점을 찾아야 합니다.</p>

<p>옵티마이저(optimizer)를 작성하는 것은 이 PEP의 범위를 벗어납니다.</p>

<h4 id="왜-jit-컴파일러jit-compiler가-아닌가">왜 JIT 컴파일러(JIT compiler)가 아닌가?</h4>

<p>현재 활발히 개발 중인 여러 Python JIT 컴파일러가 있습니다:</p>
<ul>
  <li>PyPy</li>
  <li>Pyston</li>
  <li>Numba</li>
  <li>Pyjion</li>
</ul>

<p>Numba는 수치 계산에 특화되어 있습니다. Pyston과 Pyjion은 아직 초기 단계입니다. PyPy는 가장 완벽한 Python 인터프리터로, 일반적으로 마이크로-벤치마크와 많은 매크로-벤치마크에서 CPython보다 빠르며 CPython과의 호환성이 매우 좋습니다 (Python 의미론을 존중합니다). 그럼에도 불구하고 Python JIT 컴파일러에는 CPython 대신 널리 사용되지 못하게 하는 문제점들이 있습니다.</p>

<p>numpy, PyGTK, PyQt, PySide, wxPython과 같은 많은 인기 라이브러리는 C 또는 C++로 구현되었으며 Python C API를 사용합니다. 작은 메모리 사용량(memory footprint)과 더 나은 성능을 위해, Python JIT 컴파일러는 더 빠른 가비지 컬렉터(garbage collector)를 사용하기 위해 레퍼런스 카운팅(reference counting)을 사용하지 않으며, CPython 객체의 C 구조체를 사용하지 않고 메모리 할당을 다르게 관리합니다. PyPy는 Python C API를 에뮬레이션하는 <code class="language-plaintext highlighter-rouge">cpyext</code> 모듈을 가지고 있지만, CPython보다 성능이 떨어지고 전체 Python C API를 지원하지 않습니다.</p>

<p>새로운 기능은 CPython에서 먼저 개발됩니다. 2016년 1월 기준으로, 최신 CPython 안정 버전은 3.5인 반면, PyPy는 Python 2.7과 3.2만 지원하고, Pyston은 Python 2.7만 지원합니다.</p>

<p>PyPy가 Python과 매우 좋은 호환성을 가지고 있음에도 불구하고, 일부 모듈은 여전히 PyPy와 호환되지 않습니다 (PyPy 호환성 Wiki 참조). Python C API의 불완전한 지원이 이 문제의 일부입니다. 또한 PyPy와 CPython 사이에는 레퍼런스 카운팅과 같은 미묘한 차이가 있습니다. 예를 들어, 객체 소멸자(destructors)는 PyPy에서 항상 호출되지만, CPython보다 “나중에” 호출될 수 있습니다. 컨텍스트 매니저(context managers)를 사용하면 리소스 해제 시점을 제어하는 데 도움이 됩니다.</p>

<p>PyPy가 광범위한 벤치마크에서 CPython보다 훨씬 빠르지만, 일부 사용자는 특정 사용 사례에서 CPython보다 성능이 떨어지거나 불안정한 성능을 보고하기도 합니다.</p>

<p>Python이 1분 미만으로 실행되는 프로그램의 스크립팅 언어로 사용될 때, JIT 컴파일러는 시작 시간이 더 길고 코드를 최적화하는 데 시간이 걸리기 때문에 더 느릴 수 있습니다. 예를 들어, 대부분의 Mercurial 명령어는 몇 초밖에 걸리지 않습니다.</p>

<p>Numba는 이제 선행 컴파일(ahead of time compilation)을 지원하지만, 인자(arguments) 타입을 지정하기 위해 데코레이터(decorator)가 필요하며 수치 타입만 지원합니다.</p>

<p>CPython 3.5는 거의 최적화가 없습니다. 피프홀 옵티마이저(peephole optimizer)는 기본적인 최적화만 구현합니다. 정적 컴파일러(static compiler)는 CPython 3.5와 PyPy 사이의 타협점입니다.</p>

<p><em>참고: Unladen Swallow 프로젝트도 있었지만, 2011년에 중단되었습니다.</em></p>

<h3 id="예시-examples">예시 (Examples)</h3>

<p>이 예시들은 중요한 속도 향상을 약속하는 강력한 최적화를 보여주기 위함이 아니라, 원리를 설명하기 위해 짧고 이해하기 쉽게 작성되었습니다.</p>

<h4 id="가상의-myoptimizer-모듈-hypothetical-myoptimizer-module">가상의 <code class="language-plaintext highlighter-rouge">myoptimizer</code> 모듈 (Hypothetical myoptimizer module)</h4>

<p>이 PEP의 예시들은 다음 함수와 타입을 제공하는 가상의 <code class="language-plaintext highlighter-rouge">myoptimizer</code> 모듈을 사용합니다:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">specialize(func, code, guards)</code>: 함수 <code class="language-plaintext highlighter-rouge">func</code>에 가드 <code class="language-plaintext highlighter-rouge">guards</code>를 가진 특수화된 코드 <code class="language-plaintext highlighter-rouge">code</code>를 추가합니다.</li>
  <li><code class="language-plaintext highlighter-rouge">get_specialized(func)</code>: 특수화된 코드 목록을 <code class="language-plaintext highlighter-rouge">(code, guards)</code> 튜플 리스트로 가져옵니다. 여기서 <code class="language-plaintext highlighter-rouge">code</code>는 호출 가능(callable) 객체 또는 코드 객체이며, <code class="language-plaintext highlighter-rouge">guards</code>는 가드 리스트입니다.</li>
  <li><code class="language-plaintext highlighter-rouge">GuardBuiltins(name)</code>: <code class="language-plaintext highlighter-rouge">builtins.__dict__[name]</code>과 <code class="language-plaintext highlighter-rouge">globals()[name]</code>을 감시하는 가드입니다. <code class="language-plaintext highlighter-rouge">builtins.__dict__[name]</code>이 교체되거나 <code class="language-plaintext highlighter-rouge">globals()[name]</code>이 설정되면 가드는 실패합니다.</li>
</ul>

<h4 id="바이트코드-사용-using-bytecode">바이트코드 사용 (Using bytecode)</h4>

<p>순수 내장 함수 <code class="language-plaintext highlighter-rouge">chr(65)</code>에 대한 호출을 결과인 <code class="language-plaintext highlighter-rouge">"A"</code>로 대체하는 특수화된 바이트코드를 추가하는 예시입니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">myoptimizer</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">chr</span><span class="p">(</span><span class="mi">65</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fast_func</span><span class="p">():</span>
    <span class="k">return</span> <span class="sh">"</span><span class="s">A</span><span class="sh">"</span>

<span class="n">myoptimizer</span><span class="p">.</span><span class="nf">specialize</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">fast_func</span><span class="p">.</span><span class="n">__code__</span><span class="p">,</span> <span class="p">[</span><span class="n">myoptimizer</span><span class="p">.</span><span class="nc">GuardBuiltins</span><span class="p">(</span><span class="sh">"</span><span class="s">chr</span><span class="sh">"</span><span class="p">)])</span>
<span class="k">del</span> <span class="n">fast_func</span>
</code></pre></div></div>
<p>가드의 동작을 보여주는 예시:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">func(): %s</span><span class="sh">"</span> <span class="o">%</span> <span class="nf">func</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">#specialized: %s</span><span class="sh">"</span> <span class="o">%</span> <span class="nf">len</span><span class="p">(</span><span class="n">myoptimizer</span><span class="p">.</span><span class="nf">get_specialized</span><span class="p">(</span><span class="n">func</span><span class="p">)))</span>

<span class="kn">import</span> <span class="n">builtins</span>
<span class="n">builtins</span><span class="p">.</span><span class="nb">chr</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="sh">"</span><span class="s">mock</span><span class="sh">"</span> <span class="c1"># builtins.chr 변경
</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">func(): %s</span><span class="sh">"</span> <span class="o">%</span> <span class="nf">func</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">#specialized: %s</span><span class="sh">"</span> <span class="o">%</span> <span class="nf">len</span><span class="p">(</span><span class="n">myoptimizer</span><span class="p">.</span><span class="nf">get_specialized</span><span class="p">(</span><span class="n">func</span><span class="p">)))</span>
</code></pre></div></div>
<p>출력:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func(): A
#specialized: 1

func(): mock
#specialized: 0
</code></pre></div></div>
<p>첫 번째 호출은 문자열 <code class="language-plaintext highlighter-rouge">"A"</code>를 반환하는 특수화된 바이트코드를 사용합니다. 두 번째 호출은 내장 <code class="language-plaintext highlighter-rouge">chr()</code> 함수가 교체되었기 때문에 특수화된 코드를 제거하고, <code class="language-plaintext highlighter-rouge">chr(65)</code>를 호출하는 원래 바이트코드를 실행합니다.</p>

<p>마이크로-벤치마크에서 특수화된 바이트코드 호출은 88 ns가 걸렸고, 원본 함수는 145 ns (+57 ns)가 걸렸습니다. 즉, 1.6배 빨랐습니다.</p>

<h4 id="내장-함수-사용-using-builtin-function">내장 함수 사용 (Using builtin function)</h4>

<p><code class="language-plaintext highlighter-rouge">chr(obj)</code>를 호출하는 바이트코드 대신 C 내장 <code class="language-plaintext highlighter-rouge">chr()</code> 함수를 특수화된 코드로 추가하는 예시입니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">myoptimizer</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">chr</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

<span class="n">myoptimizer</span><span class="p">.</span><span class="nf">specialize</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">chr</span><span class="p">,</span> <span class="p">[</span><span class="n">myoptimizer</span><span class="p">.</span><span class="nc">GuardBuiltins</span><span class="p">(</span><span class="sh">"</span><span class="s">chr</span><span class="sh">"</span><span class="p">)])</span>
</code></pre></div></div>
<p>가드의 동작을 보여주는 예시:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">func(65): %s</span><span class="sh">"</span> <span class="o">%</span> <span class="nf">func</span><span class="p">(</span><span class="mi">65</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">#specialized: %s</span><span class="sh">"</span> <span class="o">%</span> <span class="nf">len</span><span class="p">(</span><span class="n">myoptimizer</span><span class="p">.</span><span class="nf">get_specialized</span><span class="p">(</span><span class="n">func</span><span class="p">)))</span>

<span class="kn">import</span> <span class="n">builtins</span>
<span class="n">builtins</span><span class="p">.</span><span class="nb">chr</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="sh">"</span><span class="s">mock</span><span class="sh">"</span> <span class="c1"># builtins.chr 변경
</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">func(65): %s</span><span class="sh">"</span> <span class="o">%</span> <span class="nf">func</span><span class="p">(</span><span class="mi">65</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">#specialized: %s</span><span class="sh">"</span> <span class="o">%</span> <span class="nf">len</span><span class="p">(</span><span class="n">myoptimizer</span><span class="p">.</span><span class="nf">get_specialized</span><span class="p">(</span><span class="n">func</span><span class="p">)))</span>
</code></pre></div></div>
<p>출력:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func(): A
#specialized: 1

func(): mock
#specialized: 0
</code></pre></div></div>
<p>첫 번째 호출은 C 내장 <code class="language-plaintext highlighter-rouge">chr()</code> 함수를 호출합니다 (Python 프레임을 생성하지 않음). 두 번째 호출은 내장 <code class="language-plaintext highlighter-rouge">chr()</code> 함수가 교체되었기 때문에 특수화된 코드를 제거하고 원래 바이트코드를 실행합니다.</p>

<p>마이크로-벤치마크에서 C 내장 함수 호출은 95 ns가 걸렸고, 원래 바이트코드는 155 ns (+60 ns)가 걸렸습니다. 즉, 1.6배 빨랐습니다. <code class="language-plaintext highlighter-rouge">chr(65)</code>를 직접 호출하는 것은 76 ns가 걸립니다.</p>

<h4 id="특수화된-코드-선택-choose-the-specialized-code">특수화된 코드 선택 (Choose the specialized code)</h4>

<p>순수 Python 함수를 호출하기 위해 특수화된 코드를 선택하는 의사 코드(pseudo-code):</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">call_func</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
    <span class="n">specialized</span> <span class="o">=</span> <span class="n">myoptimizer</span><span class="p">.</span><span class="nf">get_specialized</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="n">nspecialized</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">specialized</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">nspecialized</span><span class="p">:</span>
        <span class="n">specialized_code</span><span class="p">,</span> <span class="n">guards</span> <span class="o">=</span> <span class="n">specialized</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">guard</span> <span class="ow">in</span> <span class="n">guards</span><span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="nf">guard</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">check</span><span class="p">:</span> <span class="c1"># 모든 가드가 성공: 특수화된 코드를 사용
</span>            <span class="k">return</span> <span class="n">specialized_code</span>
        <span class="k">elif</span> <span class="n">check</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># 가드가 일시적으로 실패: 다음 특수화된 코드를 시도
</span>            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># assert check == 2: 가드가 항상 실패: 특수화된 코드를 제거
</span>            <span class="k">del</span> <span class="n">specialized</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="c1"># 각 특수화된 코드의 가드가 실패했거나, 함수에 특수화된 코드가 없는 경우,
</span>    <span class="c1"># 원래 바이트코드 사용
</span>    <span class="n">code</span> <span class="o">=</span> <span class="n">func</span><span class="p">.</span><span class="n">__code__</span>
    <span class="c1"># ...
</span></code></pre></div></div>

<h3 id="변경-사항-changes">변경 사항 (Changes)</h3>

<p>Python C API에 대한 변경 사항은 다음과 같습니다:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">PyFuncGuardObject</code> 객체와 <code class="language-plaintext highlighter-rouge">PyFuncGuard_Type</code> 타입을 추가합니다.</li>
  <li><code class="language-plaintext highlighter-rouge">PySpecializedCode</code> 구조체를 추가합니다.</li>
  <li><code class="language-plaintext highlighter-rouge">PyFunctionObject</code> 구조체에 다음 필드를 추가합니다:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Py_ssize_t nb_specialized;</code></li>
      <li><code class="language-plaintext highlighter-rouge">PySpecializedCode *specialized;</code></li>
    </ul>
  </li>
  <li>다음 함수 메서드를 추가합니다:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">PyFunction_Specialize()</code></li>
      <li><code class="language-plaintext highlighter-rouge">PyFunction_GetSpecializedCodes()</code></li>
      <li><code class="language-plaintext highlighter-rouge">PyFunction_GetSpecializedCode()</code></li>
      <li><code class="language-plaintext highlighter-rouge">PyFunction_RemoveSpecialized()</code></li>
      <li><code class="language-plaintext highlighter-rouge">PyFunction_RemoveAllSpecialized()</code></li>
    </ul>
  </li>
</ul>

<p>이러한 함수와 타입 중 Python 레벨에 노출되는 것은 없습니다. 이 모든 추가 사항은 안정적인 ABI(stable ABI)에서 명시적으로 제외됩니다.</p>

<p>함수 코드가 교체될 때 (<code class="language-plaintext highlighter-rouge">func.__code__ = new_code</code>), 모든 특수화된 코드와 가드는 제거됩니다.</p>

<h4 id="함수-가드-function-guard">함수 가드 (Function guard)</h4>

<p>함수 가드 객체를 추가합니다:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">PyObject</span> <span class="n">ob_base</span><span class="p">;</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">init</span><span class="p">)</span> <span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">guard</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">func</span><span class="p">);</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">check</span><span class="p">)</span> <span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">guard</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">**</span><span class="n">stack</span><span class="p">,</span> <span class="kt">int</span> <span class="n">na</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nk</span><span class="p">);</span>
<span class="p">}</span> <span class="n">PyFuncGuardObject</span><span class="p">;</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">init()</code> 함수는 가드를 초기화합니다:</p>
<ul>
  <li>성공 시 0을 반환합니다.</li>
  <li>가드가 항상 실패할 경우 1을 반환합니다: <code class="language-plaintext highlighter-rouge">PyFunction_Specialize()</code>는 특수화된 코드를 무시해야 합니다.</li>
  <li>오류 발생 시 예외를 발생시키고 -1을 반환합니다.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">check()</code> 함수는 가드를 검사합니다:</p>
<ul>
  <li>성공 시 0을 반환합니다.</li>
  <li>가드가 일시적으로 실패한 경우 1을 반환합니다.</li>
  <li>가드가 항상 실패할 경우 2를 반환합니다: 특수화된 코드를 제거해야 합니다.</li>
  <li>오류 발생 시 예외를 발생시키고 -1을 반환합니다.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">stack</code>은 인자(arguments)의 배열입니다: 인덱스된 인자들 다음에 키워드 인자들의 <code class="language-plaintext highlighter-rouge">(key, value)</code> 쌍이 옵니다. <code class="language-plaintext highlighter-rouge">na</code>는 인덱스된 인자들의 개수입니다. <code class="language-plaintext highlighter-rouge">nk</code>는 키워드 인자들의 개수입니다 ( <code class="language-plaintext highlighter-rouge">(key, value)</code> 쌍의 개수). <code class="language-plaintext highlighter-rouge">stack</code>은 <code class="language-plaintext highlighter-rouge">na + nk * 2</code>개의 객체를 포함합니다.</p>

<h4 id="특수화된-코드-specialized-code">특수화된 코드 (Specialized code)</h4>

<p>특수화된 코드 구조체를 추가합니다:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">code</span><span class="p">;</span> <span class="cm">/* 호출 가능(callable) 객체 또는 코드 객체 */</span>
    <span class="n">Py_ssize_t</span> <span class="n">nb_guard</span><span class="p">;</span>
    <span class="n">PyObject</span> <span class="o">**</span><span class="n">guards</span><span class="p">;</span> <span class="cm">/* PyFuncGuardObject 객체들 */</span>
<span class="p">}</span> <span class="n">PySpecializedCode</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="함수-메서드-function-methods">함수 메서드 (Function methods)</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">PyFunction_Specialize(PyObject *func, PyObject *code, PyObject *guards)</code>
함수를 특수화하고, 가드를 가진 특수화된 코드를 추가하는 함수 메서드입니다.
<code class="language-plaintext highlighter-rouge">code</code>가 Python 함수인 경우, <code class="language-plaintext highlighter-rouge">code</code> 함수의 코드 객체가 특수화된 코드로 사용됩니다. 특수화된 Python 함수는 동일한 기본 매개변수(parameter defaults)와 키워드 매개변수 기본값을 가져야 하며, 특수화된 코드를 가져서는 안 됩니다.
<code class="language-plaintext highlighter-rouge">code</code>가 Python 함수 또는 코드 객체인 경우, 새로운 코드 객체가 생성되고 <code class="language-plaintext highlighter-rouge">func</code>의 코드 객체의 코드 이름과 첫 번째 줄 번호가 복사됩니다. 특수화된 코드는 동일한 Cell 변수(cell variables)와 Free 변수(free variables)를 가져야 합니다.
결과:
    <ul>
      <li>성공 시 0을 반환합니다.</li>
      <li>특수화가 무시된 경우 1을 반환합니다.</li>
      <li>오류 발생 시 예외를 발생시키고 -1을 반환합니다.</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">PyFunction_GetSpecializedCodes(PyObject *func)</code>
특수화된 코드 목록을 가져오는 함수 메서드입니다.
<code class="language-plaintext highlighter-rouge">code</code>가 호출 가능 객체 또는 코드 객체이고 <code class="language-plaintext highlighter-rouge">guards</code>가 <code class="language-plaintext highlighter-rouge">PyFuncGuard</code> 객체 목록인 <code class="language-plaintext highlighter-rouge">(code, guards)</code> 튜플 리스트를 반환합니다. 오류 발생 시 예외를 발생시키고 <code class="language-plaintext highlighter-rouge">NULL</code>을 반환합니다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">PyFunction_GetSpecializedCode(PyObject *func, PyObject **stack, int na, int nk)</code>
가드를 검사하여 특수화된 코드를 선택하는 함수 메서드입니다.
<code class="language-plaintext highlighter-rouge">stack</code>, <code class="language-plaintext highlighter-rouge">na</code>, <code class="language-plaintext highlighter-rouge">nk</code> 인자에 대해서는 가드의 <code class="language-plaintext highlighter-rouge">check()</code> 함수를 참조하십시오. 성공 시 호출 가능 객체 또는 코드 객체를 반환합니다. 오류 발생 시 예외를 발생시키고 <code class="language-plaintext highlighter-rouge">NULL</code>을 반환합니다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">PyFunction_RemoveSpecialized(PyObject *func, Py_ssize_t index)</code>
인덱스로 특수화된 코드와 해당 가드를 제거하는 함수 메서드입니다.
성공 시 또는 인덱스가 존재하지 않을 경우 0을 반환합니다. 오류 발생 시 예외를 발생시키고 -1을 반환합니다.</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">PyFunction_RemoveAllSpecialized(PyObject *func)</code>
함수의 모든 특수화된 코드와 가드를 제거하는 함수 메서드입니다.
성공 시 0을 반환합니다. <code class="language-plaintext highlighter-rouge">func</code>가 함수가 아닐 경우 예외를 발생시키고 -1을 반환합니다.</li>
</ul>

<h3 id="벤치마크-benchmark">벤치마크 (Benchmark)</h3>

<p><code class="language-plaintext highlighter-rouge">python3.6 -m timeit -s 'def f(): pass' 'f()'</code> 에 대한 마이크로-벤치마크 (3회 실행 중 최적):</p>
<ul>
  <li>원본 Python: 79 ns</li>
  <li>패치된 Python: 79 ns</li>
</ul>

<p>이 마이크로-벤치마크에 따르면, 특수화 없이 Python 함수를 호출하는 데는 오버헤드가 없습니다.</p>

<h3 id="구현-implementation">구현 (Implementation)</h3>

<p>이 PEP를 구현하는 패치는 이슈 #26098: PEP 510: Specialize functions with guards에 포함되어 있습니다.</p>

<h3 id="다른-python-구현체-other-implementations-of-python">다른 Python 구현체 (Other implementations of Python)</h3>

<p>이 PEP는 Python C API에 대한 변경 사항만 포함하며, Python API는 변경되지 않습니다. 다른 Python 구현체는 새로운 추가 사항을 구현하지 않거나, 추가된 함수를 <code class="language-plaintext highlighter-rouge">no-op</code> (아무 작업도 하지 않는)으로 구현할 자유가 있습니다. 예를 들면 다음과 같습니다:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">PyFunction_Specialize()</code>: 항상 1을 반환합니다 (특수화가 무시됨).</li>
  <li><code class="language-plaintext highlighter-rouge">PyFunction_GetSpecializedCodes()</code>: 항상 빈 리스트를 반환합니다.</li>
  <li><code class="language-plaintext highlighter-rouge">PyFunction_GetSpecializedCode()</code>: 기존의 <code class="language-plaintext highlighter-rouge">PyFunction_GET_CODE()</code> 매크로처럼 함수 코드 객체를 반환합니다.</li>
</ul>

<h3 id="논의-discussion">논의 (Discussion)</h3>

<p><code class="language-plaintext highlighter-rouge">python-ideas</code> 메일링 리스트의 스레드: RFC: PEP: Specialized functions with guards.</p>

<h3 id="저작권-copyright">저작권 (Copyright)</h3>

<p>이 문서는 퍼블릭 도메인(public domain)에 있습니다.</p>

<blockquote>
  <p>⚠️ <strong>알림:</strong> 이 문서는 AI를 활용하여 번역되었으며, 기술적 정확성을 보장하지 않습니다. 정확한 내용은 반드시 원문을 확인하시기 바랍니다.</p>
</blockquote>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#pep" class="page__taxonomy-item" rel="tag">PEP</a><span class="sep">, </span>
    
      <a href="/tags/#python" class="page__taxonomy-item" rel="tag">Python</a><span class="sep">, </span>
    
      <a href="/tags/#translation" class="page__taxonomy-item" rel="tag">Translation</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#pep" class="page__taxonomy-item" rel="tag">PEP</a><span class="sep">, </span>
    
      <a href="/categories/#python" class="page__taxonomy-item" rel="tag">Python</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2025-09-26">September 26, 2025</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/python/pep/509/" class="pagination--pager" title="[Superseded] PEP 509 - Add a private version to dict
">Previous</a>
    
    
      <a href="/python/pep/511/" class="pagination--pager" title="[Rejected] PEP 511 - API for code transformers
">Next</a>
    
  </nav>


    </div>

    
  </article>

</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 secrett2633. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    <script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'secrett2633/secrett2633.github.io');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  





  </body>
</html>
